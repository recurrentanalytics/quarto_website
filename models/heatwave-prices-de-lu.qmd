---
title: "Heatwaves and Day-Ahead Prices: DE-LU, Summer 2019"
date: 2025-12-12
categories: [energy, extremes, time-series]
---

## Why this note exists

This is a deliberately small empirical note. It documents one operational definition of a heatwave and traces how that definition propagates through a data pipeline, culminating in descriptive comparisons of day-ahead electricity prices during heatwave versus non-heatwave periods.

This is not a causal analysis. No identification strategy is claimed, and the pipeline is meant to be inspectable rather than "correct" in any final sense.

## Data

Public datasets from Open Power System Data (OPSD):

- DE-LU day-ahead prices from `time_series_60min_singleindex.csv`
- German temperature from `weather_data.csv`

The code below expects those CSVs in `data/raw/`. Download from:

- [Time series](https://data.open-power-system-data.org/time_series/)
- [Weather data](https://data.open-power-system-data.org/weather_data/)

## Build processed inputs (hourly parquet)

```python
import pandas as pd

from src.data_download import save_prices_from_opsd, save_weather_de_from_opsd

START = "2015-01-01"
END_PRICES  = "2020-07-01"
END_WEATHER = "2020-01-01"

save_prices_from_opsd(start=START, end=END_PRICES)
save_weather_de_from_opsd(start=START, end=END_WEATHER)

prices  = pd.read_parquet("data/processed/prices_de_lu_clean.parquet")
weather = pd.read_parquet("data/processed/weather_de_agg.parquet")

prices.head(), weather.head()
```

## Heatwave definition

Operational definition used here (chosen for clarity, not optimality):

* daily maximum temperature ≥ 30°C
* at least 3 consecutive days

This is one modelling choice among many. The point is to make it explicit and inspect its implications.

## Flag heatwaves and merge with prices

```python
import matplotlib.pyplot as plt

from src.heatwave_defs import (
    restrict_common_period,
    compute_daily_max_temp,
    flag_heatwaves,
    expand_heatwave_flag_to_hourly,
    merge_price_and_weather,
)

prices_c, weather_c = restrict_common_period(prices, weather)

daily_temp  = compute_daily_max_temp(weather_c)
daily_flags = flag_heatwaves(daily_temp, threshold=30.0, min_duration=3)

# Attach daily flag back to hourly weather and merge with hourly prices
weather_hw = expand_heatwave_flag_to_hourly(weather_c, daily_flags)
merged = merge_price_and_weather(prices_c, weather_hw)

merged.head()
```

## Temperature with heatwave days highlighted (Summer 2019)

```python
hw_2019 = daily_flags["2019-06-01":"2019-08-31"]

fig, ax = plt.subplots(figsize=(12, 4))
ax.plot(hw_2019.index, hw_2019["t2m_daily_max_c"], label="Daily max temp")
ax.scatter(
    hw_2019.index[hw_2019["is_heatwave_day"]],
    hw_2019["t2m_daily_max_c"][hw_2019["is_heatwave_day"]],
    s=35,
    label="Heatwave days",
)
ax.set_ylabel("°C")
ax.set_title("Daily max temperature with heatwave days highlighted (Summer 2019)")
ax.legend()
plt.show()
```

## Summer 2019: prices and temperature (heatwave days shaded)

```python
summer = merged.set_index("datetime_utc")["2019-06-01":"2019-08-31"]

fig, ax1 = plt.subplots(figsize=(12, 5))
ax2 = ax1.twinx()

ax1.plot(summer.index, summer["price_eur_mwh"], label="Price (EUR/MWh)")
ax2.plot(summer.index, summer["t2m_mean_c"], alpha=0.7, linestyle="--", label="Temperature (°C)")

# Shade heatwave days
for day in summer.index.normalize().unique():
    day_mask = (summer.index.normalize() == day)
    if summer.loc[day_mask, "is_heatwave_day"].any():
        ax1.axvspan(day, day + pd.Timedelta(days=1), alpha=0.12)

ax1.set_ylabel("Price [EUR/MWh]")
ax2.set_ylabel("Temperature [°C]")
ax1.set_title("Summer 2019: DE-LU day-ahead prices and DE temperature (heatwave days shaded)")
fig.tight_layout()
plt.show()
```

## Peak hours: price distributions on heatwave vs non-heatwave days

```python
peak = merged[(merged["hour"] >= 8) & (merged["hour"] <= 20)].copy()

hw = peak[peak["is_heatwave_day"]]
normal = peak[~peak["is_heatwave_day"]]

summary = pd.DataFrame({
    "normal_peak_hours": normal["price_eur_mwh"].describe(),
    "heatwave_peak_hours": hw["price_eur_mwh"].describe(),
})
summary
```

```python
fig, ax = plt.subplots(figsize=(8, 5))

ax.hist(normal["price_eur_mwh"], bins=60, alpha=0.6, density=True, label="Normal days (peak hours)")
ax.hist(hw["price_eur_mwh"],     bins=60, alpha=0.6, density=True, label="Heatwave days (peak hours)")

ax.set_xlabel("Day-ahead price (EUR/MWh)")
ax.set_ylabel("Density")
ax.set_title("DE-LU prices: heatwave vs normal days (2015–2019, peak hours)")
ax.legend()
plt.show()
```

## Limitations and extensions

This note is intentionally descriptive. It does not claim causality and does not control for drivers such as load, renewables, outages, fuels, or cross-border flows.

Natural extensions include:

* alternative heatwave definitions (percentiles, regionalised thresholds)
* adding load and renewable generation as covariates
* multi-year comparisons focusing on the stability of patterns across summers
