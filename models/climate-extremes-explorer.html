<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2025-12-15">
<meta name="description" content="Comprehensive interactive analysis of climate extremes using synthetic climate data. Demonstrates methods for identifying, analyzing, and visualizing extreme climate events including heatwaves, cold snaps, and extreme precipitation. Features return period analysis, event clustering, and multi-variable correlation analysis.">

<title>Climate Extremes Explorer – re:current_analytics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../assets/favicon.svg" rel="icon" type="image/svg+xml">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-707d8167ce6003fca903bfe2be84ab7f.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-453edaec89a67b4aaf50980fc95ba5b8.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-ec8d78f0ebbe7cd36fa017e241e46b34.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../site_libs/bootstrap/bootstrap-453edaec89a67b4aaf50980fc95ba5b8.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<!-- IBM Plex Sans Font -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500&amp;display=swap" rel="stylesheet">

<!-- IBM Plex Mono Font for code blocks -->
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@0,400;0,500;0,600;1,400&amp;display=swap" rel="stylesheet">

<!-- Plausible analytics -->
<script defer="" data-domain="recurrentanalytics.com" src="https://plausible.io/js/script.js"></script>

<!-- D3.js for network graph -->
<script src="https://d3js.org/d3.v7.min.js"></script>

<!-- Hero drift effect -->
<style>
  .rac-hero {
    position: relative; padding: 5rem 0 4rem; text-align:center;
    overflow: hidden;
  }
  .rac-hero h1 { font-weight: 800; letter-spacing: .5px; }
  .rac-hero .drift {
    position: absolute; left: -10%; right:-10%; bottom: -40px; height: 120px;
    background: radial-gradient(100% 60% at 50% 40%, var(--bs-secondary-bg) 0%, transparent 70%);
    animation: slowfloat 14s ease-in-out infinite alternate;
    opacity:.7; filter: blur(10px);
  }
  @keyframes slowfloat { from { transform: translateY(0px);} to {transform: translateY(16px);} }
</style>

<!-- Reading progress bar, keyboard shortcuts -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Hide page title and reading time on index page
  const path = window.location.pathname;
  const isHomePage = path === '/' || path === '/index.html' || path.endsWith('/index.html');
  
  if (isHomePage) {
    document.body.classList.add('index-page');
    // Hide page title block
    const titleBlock = document.querySelector('.quarto-title-block');
    if (titleBlock) {
      titleBlock.style.display = 'none';
    }
    // Remove any reading time that might have been added
    const readingTime = document.querySelector('.reading-time');
    if (readingTime) {
      readingTime.remove();
    }
  }
  
  // Hide title block on section index pages (projects, notes, reading, tipping-points)
  // These pages have empty titles in YAML and use headings in content instead
  const isSectionIndex = path.match(/\/(projects|notes|reading|tipping-points)\/?$/);
  if (isSectionIndex) {
    const titleBlock = document.querySelector('.quarto-title-block');
    if (titleBlock) {
      titleBlock.style.display = 'none';
    }
    // Also remove reading time on section pages
    const readingTime = document.querySelector('.reading-time');
    if (readingTime) {
      readingTime.remove();
    }
  }
  
  // Breadcrumb navigation
  function createBreadcrumbs() {
    const path = window.location.pathname;
    if (path === '/' || path === '/index.html') return;
    
    const pathParts = path.split('/').filter(p => p && p !== 'index.html');
    const breadcrumbContainer = document.createElement('nav');
    breadcrumbContainer.className = 'breadcrumb-nav';
    breadcrumbContainer.setAttribute('aria-label', 'Breadcrumb');
    
    let breadcrumbHTML = '<ol class="breadcrumb-list">';
    breadcrumbHTML += '<li class="breadcrumb-item"><a href="/">Home</a></li>';
    
    let currentPath = '';
    pathParts.forEach((part, index) => {
      const isLast = index === pathParts.length - 1;
      
      // Special handling for "models" - link to projects page instead
      if (part === 'models' && !isLast) {
        breadcrumbHTML += '<li class="breadcrumb-item"><a href="/projects/">Projects</a></li>';
        return; // Skip adding to currentPath
      }
      
      // Skip "models" in breadcrumb if it's not the last part
      if (part === 'models') {
        return;
      }
      
      currentPath += '/' + part;
      const label = part.replace(/\.html$/, '').replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
      
      if (isLast) {
        breadcrumbHTML += `<li class="breadcrumb-item active" aria-current="page">${label}</li>`;
      } else {
        breadcrumbHTML += `<li class="breadcrumb-item"><a href="${currentPath}/">${label}</a></li>`;
      }
    });
    
    breadcrumbHTML += '</ol>';
    breadcrumbContainer.innerHTML = breadcrumbHTML;
    
    const contentArea = document.querySelector('#quarto-document-content, .content, main, article');
    if (contentArea) {
      contentArea.insertBefore(breadcrumbContainer, contentArea.firstChild);
    }
  }
  
  createBreadcrumbs();
  
  // Reading progress bar
  const progressBar = document.createElement('div');
  progressBar.className = 'reading-progress';
  document.body.appendChild(progressBar);
  
  window.addEventListener('scroll', function() {
    const scrollTop = window.scrollY;
    const docHeight = document.documentElement.scrollHeight - window.innerHeight;
    const progress = docHeight > 0 ? (scrollTop / docHeight) * 100 : 0;
    progressBar.style.width = progress + '%';
  });

  // Focus mode for distraction-free reading
  let focusMode = false;
  function toggleFocusMode() {
    focusMode = !focusMode;
    document.body.classList.toggle('focus-mode', focusMode);
    
    // Hide/show elements
    const elementsToHide = document.querySelectorAll('.navbar, .nav-footer, .sidebar, #TOC, #quarto-margin-sidebar, .quarto-back-to-top-link, .mobile-graph-btn, .sidebar-graph');
    elementsToHide.forEach(el => {
      if (el) el.style.display = focusMode ? 'none' : '';
    });
    
    // Update hint
    const hint = document.querySelector('.keyboard-hint');
    if (hint) {
      hint.innerHTML = focusMode 
        ? 'Press f to exit focus mode · Escape to close'
        : '⌘K palette · / search · j/k navigate · f focus · ? hints';
    }
  }

  // Keyboard shortcuts
  const noteLinks = Array.from(document.querySelectorAll('.quarto-listing-default a, .sidebar-item a'));
  let currentIndex = -1;

  document.addEventListener('keydown', function(e) {
    if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
    
    // f to toggle focus mode
    if (e.key === 'f' && !e.ctrlKey && !e.metaKey) {
      e.preventDefault();
      toggleFocusMode();
      return;
    }
    
    // / to focus search
    if (e.key === '/' && !e.ctrlKey && !e.metaKey) {
      e.preventDefault();
      const searchInput = document.querySelector('#quarto-search input, .aa-Input');
      if (searchInput) searchInput.focus();
    }
    
    // j/k to navigate notes (on listing pages)
    if (noteLinks.length > 0) {
      if (e.key === 'j') {
        currentIndex = Math.min(currentIndex + 1, noteLinks.length - 1);
        noteLinks[currentIndex]?.focus();
      }
      if (e.key === 'k') {
        currentIndex = Math.max(currentIndex - 1, 0);
        noteLinks[currentIndex]?.focus();
      }
    }
    
    // ? to show keyboard hints
    if (e.key === '?') {
      const hint = document.querySelector('.keyboard-hint');
      if (hint) hint.classList.toggle('visible');
    }
  });

  // Add keyboard hint element
  const hint = document.createElement('div');
  hint.className = 'keyboard-hint';
  hint.innerHTML = '⌘K palette · / search · j/k navigate · f focus · ? hints';
  document.body.appendChild(hint);

  // Command Palette (Cmd+K / Ctrl+K)
  const pages = [
    { title: 'Home', path: '/' },
    { title: 'About & Contact', path: '/about.html' },
    { title: 'Notes & Knowledge Base', path: '/notes/' },
    { title: 'Projects', path: '/projects/' },
    { title: 'Reading', path: '/reading/' },
    { title: 'Tipping Points', path: '/tipping-points/' },
    { title: 'Design Notes', path: '/tipping-points/design-notes/' },
    { title: 'Hello, Lab', path: '/notes/2025-hello-world.html' },
    { title: 'Risk Modelling Part 1: Foundations', path: '/notes/risk-series-1.html' },
    { title: 'Risk Modelling Part 2: Data', path: '/notes/risk-series-2.html' },
    { title: 'Risk Modelling Part 3: Implementation', path: '/notes/risk-series-3.html' },
    { title: 'Heatwaves and Day-Ahead Prices', path: '/models/heatwave-prices-de-lu.html' }
  ];

  const overlay = document.createElement('div');
  overlay.className = 'cmd-palette-overlay';
  overlay.innerHTML = `
    <div class="cmd-palette">
      <input type="text" class="cmd-palette-input" placeholder="Jump to page...">
      <div class="cmd-palette-results"></div>
    </div>
  `;
  document.body.appendChild(overlay);

  const input = overlay.querySelector('.cmd-palette-input');
  const results = overlay.querySelector('.cmd-palette-results');
  let selectedIndex = 0;

  // Simple fuzzy search function
  function fuzzyMatch(pattern, text) {
    pattern = pattern.toLowerCase();
    text = text.toLowerCase();
    
    // Exact match gets highest score
    if (text.includes(pattern)) return 100;
    
    // Check if all pattern characters appear in order
    let patternIdx = 0;
    let score = 0;
    for (let i = 0; i < text.length && patternIdx < pattern.length; i++) {
      if (text[i] === pattern[patternIdx]) {
        patternIdx++;
        score += 10;
      }
    }
    
    if (patternIdx === pattern.length) {
      return score;
    }
    
    // Check individual word matches
    const words = text.split(/\s+/);
    let wordMatches = 0;
    pattern.split(/\s+/).forEach(pWord => {
      if (words.some(w => w.startsWith(pWord) || w.includes(pWord))) {
        wordMatches++;
      }
    });
    
    return wordMatches * 5;
  }

  function renderResults(filter = '') {
    if (!filter.trim()) {
      const filtered = pages.slice(0, 10);
    results.innerHTML = filtered.map((p, i) => `
      <a href="${p.path}" class="cmd-palette-item ${i === selectedIndex ? 'selected' : ''}">
        <div class="cmd-palette-item-title">${p.title}</div>
        <div class="cmd-palette-item-path">${p.path}</div>
      </a>
    `).join('');
    return filtered;
    }
    
    // Score and sort by relevance
    const scored = pages.map(p => ({
      page: p,
      score: Math.max(
        fuzzyMatch(filter, p.title),
        fuzzyMatch(filter, p.path)
      )
    })).filter(item => item.score > 0)
      .sort((a, b) => b.score - a.score)
      .slice(0, 10);
    
    results.innerHTML = scored.map((item, i) => `
      <a href="${item.page.path}" class="cmd-palette-item ${i === selectedIndex ? 'selected' : ''}">
        <div class="cmd-palette-item-title">${item.page.title}</div>
        <div class="cmd-palette-item-path">${item.page.path}</div>
      </a>
    `).join('');
    return scored.map(item => item.page);
  }

  function openPalette() {
    overlay.classList.add('active');
    input.value = '';
    selectedIndex = 0;
    renderResults();
    setTimeout(() => input.focus(), 50);
  }

  function closePalette() {
    overlay.classList.remove('active');
  }

  overlay.addEventListener('click', (e) => {
    if (e.target === overlay) closePalette();
  });

  input.addEventListener('input', () => {
    selectedIndex = 0;
    renderResults(input.value);
  });

  input.addEventListener('keydown', (e) => {
    const items = results.querySelectorAll('.cmd-palette-item');
    if (e.key === 'ArrowDown') {
      e.preventDefault();
      selectedIndex = Math.min(selectedIndex + 1, items.length - 1);
      renderResults(input.value);
    } else if (e.key === 'ArrowUp') {
      e.preventDefault();
      selectedIndex = Math.max(selectedIndex - 1, 0);
      renderResults(input.value);
    } else if (e.key === 'Enter') {
      e.preventDefault();
      if (items[selectedIndex]) items[selectedIndex].click();
    } else if (e.key === 'Escape') {
      closePalette();
    }
  });

  document.addEventListener('keydown', (e) => {
    if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
      e.preventDefault();
      if (overlay.classList.contains('active')) {
        closePalette();
      } else {
        openPalette();
      }
    }
    if (e.key === 'Escape' && overlay.classList.contains('active')) {
      closePalette();
    }
  });

  // Reading time - add to article pages (but not on index/home page, notes index, or about page)
  // Reuse path from earlier in the scope
  const isHomePageForReading = path === '/' || path === '/index.html' || path.endsWith('/index.html');
  const isNotesIndex = path === '/notes/' || path === '/notes/index.html' || path.endsWith('/notes/index.html');
  const isAboutPage = path === '/about.html' || path.endsWith('/about.html');
  
  if (!isHomePageForReading && !isNotesIndex && !isAboutPage) {
  const articleBody = document.querySelector('.quarto-title-block, #quarto-document-content');
  const contentArea = document.querySelector('#quarto-document-content, .content, main');
  if (articleBody && contentArea) {
    const text = contentArea.innerText || '';
    const wordCount = text.trim().split(/\s+/).length;
    const readingTime = Math.max(1, Math.ceil(wordCount / 200));
    const timeSpan = document.createElement('span');
    timeSpan.className = 'reading-time';
    timeSpan.textContent = readingTime + ' min read';
    const titleMeta = document.querySelector('.quarto-title-meta, .quarto-title');
    if (titleMeta) {
      titleMeta.appendChild(document.createTextNode(' · '));
      titleMeta.appendChild(timeSpan);
    }
  }
  }


  // Network Graph visualization
  console.log('Starting graph navigation setup...');
  const graphData = {
    nodes: [
      { id: 'home', label: 'Home', path: '/', cat: 'nav' },
      { id: 'about', label: 'About & Contact', path: '/about.html', cat: 'nav' },
      { id: 'notes', label: 'Notes', path: '/notes/', cat: 'nav' },
      { id: 'hello', label: 'Hello, Lab', path: '/notes/2025-hello-world.html', cat: 'notes' },
      { id: 'risk-1', label: 'Risk Part 1', path: '/notes/risk-series-1.html', cat: 'notes' },
      { id: 'risk-2', label: 'Risk Part 2', path: '/notes/risk-series-2.html', cat: 'notes' },
      { id: 'risk-3', label: 'Risk Part 3', path: '/notes/risk-series-3.html', cat: 'notes' },
      { id: 'heatwave', label: 'Heatwave Prices', path: '/models/heatwave-prices-de-lu.html', cat: 'projects' },
      { id: 'climate-extremes', label: 'Climate Extremes Explorer', path: '/models/climate-extremes-explorer.html', cat: 'projects' },
      { id: 'projects', label: 'Projects', path: '/projects/', cat: 'nav' },
      { id: 'tipping-points', label: 'Tipping Points', path: '/tipping-points/', cat: 'nav' },
      { id: 'design-notes', label: 'Design Notes', path: '/tipping-points/design-notes/', cat: 'tipping-points' },
      { id: 'playtest-1', label: 'Playtest Session 1', path: '/tipping-points/design-notes/2025-01-15-playtest-session-1.html', cat: 'tipping-points' },
      { id: 'mechanics-2', label: 'Mechanics Iteration 2', path: '/tipping-points/design-notes/2025-01-10-mechanics-iteration-2.html', cat: 'tipping-points' },
      { id: 'heatwave-card', label: 'Card Design: Heatwave', path: '/tipping-points/design-notes/2025-01-05-card-design-heatwave.html', cat: 'tipping-points' }
    ],
    links: [
      { source: 'home', target: 'notes' },
      { source: 'home', target: 'projects' },
      { source: 'home', target: 'tipping-points' },
      { source: 'home', target: 'about' },
      { source: 'tipping-points', target: 'design-notes' },
      { source: 'design-notes', target: 'playtest-1' },
      { source: 'design-notes', target: 'mechanics-2' },
      { source: 'design-notes', target: 'heatwave-card' },
      { source: 'playtest-1', target: 'mechanics-2' },
      { source: 'mechanics-2', target: 'playtest-1' },
      { source: 'heatwave-card', target: 'design-notes' },
      { source: 'notes', target: 'hello' },
      { source: 'notes', target: 'risk-1' },
      { source: 'risk-1', target: 'risk-2' },
      { source: 'risk-2', target: 'risk-1' },
      { source: 'risk-2', target: 'risk-3' },
      { source: 'risk-2', target: 'heatwave' },
      { source: 'risk-3', target: 'risk-1' },
      { source: 'risk-3', target: 'risk-2' },
      { source: 'projects', target: 'heatwave' },
      { source: 'projects', target: 'climate-extremes' },
      { source: 'heatwave', target: 'risk-2' },
      { source: 'climate-extremes', target: 'risk-2' },
    ]
  };
  
  // Category colors for graph nodes
  const catColors = {
    nav: 'var(--bs-secondary)',
    notes: 'var(--bs-info)',
    projects: 'var(--bs-success)',
    'tipping-points': '#9b59b6'  // Purple for game design content
  };

  // Create sidebar mini-graph widget - always add to body to ensure it's on all pages
  const sidebarGraph = document.createElement('div');
  sidebarGraph.className = 'sidebar-graph';
  sidebarGraph.title = 'Click to expand';
  sidebarGraph.innerHTML = `
    <div class="sidebar-graph-header">
      <span class="sidebar-graph-title">Connections</span>
      <span class="sidebar-graph-expand">expand</span>
    </div>
    <div class="sidebar-graph-container" id="mini-graph-container"></div>
  `;
  
  // Try to add to sidebar first, but always ensure it's in the DOM
  console.log('Appending sidebar graph to DOM...');
  const sidebar = document.querySelector('#quarto-margin-sidebar, .sidebar, #TOC');
  if (sidebar) {
    console.log('Sidebar found, appending to sidebar');
    sidebar.appendChild(sidebarGraph);
  } else {
    // If no sidebar, add as fixed element to body
    console.log('No sidebar found, appending to body as fixed element');
    document.body.appendChild(sidebarGraph);
    sidebarGraph.style.position = 'fixed';
    sidebarGraph.style.bottom = '1rem';
    sidebarGraph.style.right = '1rem';
    sidebarGraph.style.width = '200px';
    sidebarGraph.style.zIndex = '100';
  }
  console.log('Sidebar graph in DOM:', document.body.contains(sidebarGraph) || (sidebar && sidebar.contains(sidebarGraph)));
  
  // Ensure sidebar graph is always accessible even if sidebar is hidden
  // Add a fallback fixed position version if sidebar doesn't exist
  if (!sidebar) {
    sidebarGraph.style.display = 'block';
    sidebarGraph.style.visibility = 'visible';
  }
  
  // Force visibility
  sidebarGraph.style.display = 'block';
  sidebarGraph.style.visibility = 'visible';
  sidebarGraph.style.opacity = '1';
  
  // Ensure sidebarGraph is clickable - attach handler after it's in DOM
  setTimeout(function() {
    const graphEl = document.querySelector('.sidebar-graph');
    if (graphEl && !graphEl.hasAttribute('data-click-handler-attached')) {
      graphEl.setAttribute('data-click-handler-attached', 'true');
      graphEl.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        if (typeof window.openGraphNavigation === 'function') {
          window.openGraphNavigation();
        }
      });
    }
  }, 100);

  // Create modal FIRST - before any D3 checks
  console.log('Creating graph modal element...');
  const graphModal = document.createElement('div');
  graphModal.className = 'graph-modal-overlay';
  graphModal.innerHTML = `
    <div class="graph-modal">
      <div class="graph-modal-header">
        <span class="graph-modal-title">Note Connections</span>
        <button class="graph-modal-close">&times;</button>
      </div>
      <div class="graph-modal-controls">
        <input type="text" class="graph-search-input" placeholder="Search nodes..." id="graph-search">
        <div class="graph-category-filters">
          <button class="graph-filter-btn active" data-cat="all">All</button>
          <button class="graph-filter-btn" data-cat="nav">Nav</button>
          <button class="graph-filter-btn" data-cat="notes">Notes</button>
          <button class="graph-filter-btn" data-cat="projects">Projects</button>
          <button class="graph-filter-btn" data-cat="tipping-points">Tipping Points</button>
        </div>
        <div class="graph-zoom-controls">
          <button class="graph-zoom-btn" id="zoom-in" title="Zoom in">+</button>
          <button class="graph-zoom-btn" id="zoom-out" title="Zoom out">−</button>
          <button class="graph-zoom-btn" id="zoom-reset" title="Reset zoom">⌂</button>
        </div>
      </div>
      <div class="graph-container" id="graph-container"></div>
    </div>
  `;
  document.body.appendChild(graphModal);

  function getCurrentPageId() {
    const path = window.location.pathname;
    const node = graphData.nodes.find(n => path.endsWith(n.path) || path === n.path || 
      (n.path === '/' && (path === '/' || path === '/index.html' || path.endsWith('/index.html'))));
    return node ? node.id : null;
  }
  
  // Make getCurrentPageId and graphData available globally
  window.getCurrentPageId = getCurrentPageId;
  window.graphData = graphData;

  function openGraph() {
    console.log('openGraph called', { graphModal: !!graphModal, inDOM: graphModal && document.body.contains(graphModal) });
    
    // Ensure graph modal exists
    if (!graphModal) {
      console.error('Graph modal not found!');
      return;
    }
    
    if (!document.body.contains(graphModal)) {
      console.warn('Graph modal not in DOM, appending...');
      document.body.appendChild(graphModal);
    }
    
    // Ensure modal is visible
    graphModal.style.display = 'flex';
    graphModal.style.visibility = 'visible';
    graphModal.classList.add('active');
    
    // Initialize graph if not already done
    if (typeof initGraph === 'function') {
    initGraph();
    } else {
      console.error('initGraph function not found');
    }
    
    // Focus trap - prevent body scroll when modal is open
    document.body.style.overflow = 'hidden';
  }

  function closeGraph() {
    if (graphModal) {
    graphModal.classList.remove('active');
      // Restore body scroll
      document.body.style.overflow = '';
    }
  }
  
  // Make openGraph globally available so it can be called from anywhere
  window.openGraphNavigation = openGraph;

  // Ensure event listeners are attached after elements are created
  // Use event delegation to handle clicks on sidebar graph
  if (sidebarGraph && sidebarGraph.parentNode) {
    sidebarGraph.addEventListener('click', function(e) {
      e.preventDefault();
      e.stopPropagation();
      if (typeof openGraph === 'function') {
      openGraph();
      } else if (typeof window.openGraphNavigation === 'function') {
        window.openGraphNavigation();
    }
  });
  } else {
    // If sidebarGraph isn't in DOM yet, wait and retry
    setTimeout(function() {
      const graph = document.querySelector('.sidebar-graph');
      if (graph) {
        graph.addEventListener('click', function(e) {
          e.preventDefault();
          e.stopPropagation();
          if (typeof window.openGraphNavigation === 'function') {
            window.openGraphNavigation();
          }
        });
      }
    }, 500);
  }
  
  const closeBtn = graphModal.querySelector('.graph-modal-close');
  if (closeBtn) {
    closeBtn.addEventListener('click', function(e) {
      e.preventDefault();
      e.stopPropagation();
      closeGraph();
    });
  }
  
  graphModal.addEventListener('click', function(e) {
    if (e.target === graphModal) {
      closeGraph();
    }
  });
  
  // Global keyboard shortcut - attach to document, not just inside DOMContentLoaded
  function handleGraphKeyboard(e) {
    // Escape to close graph modal
    if (e.key === 'Escape' && graphModal && graphModal.classList.contains('active')) {
      closeGraph();
      return;
    }
    // 'g' key to open graph - works everywhere except in input fields
    if ((e.key === 'g' || e.key === 'G') && 
        e.target.tagName !== 'INPUT' && 
        e.target.tagName !== 'TEXTAREA' && 
        !e.ctrlKey && 
        !e.metaKey && 
        !e.altKey &&
        !e.shiftKey) {
      e.preventDefault();
      e.stopPropagation();
      openGraph();
    }
  }
  
  console.log('Attaching keyboard handler...');
  document.addEventListener('keydown', handleGraphKeyboard);
  console.log('Keyboard handler attached to document');
  
  // Also attach to window for extra reliability
  window.addEventListener('keydown', handleGraphKeyboard);
  console.log('Keyboard handler attached to window');
  
  // Test: Try calling openGraph directly to verify it works
  console.log('openGraph function available:', typeof openGraph);
  console.log('window.openGraphNavigation available:', typeof window.openGraphNavigation);

  // Render mini-graph in sidebar immediately using D3-force
  function renderMiniGraph() {
    const container = document.getElementById('mini-graph-container');
    if (!container || typeof d3 === 'undefined') return;
    
    const width = container.clientWidth || 180;
    const height = container.clientHeight || 150;
    const currentId = getCurrentPageId();

    const svg = d3.select(container).append('svg')
      .attr('viewBox', `0 0 ${width} ${height}`);

    const nodes = graphData.nodes.map(d => ({...d}));
    const links = graphData.links.map(d => ({source: d.source, target: d.target}));

    const connectedNodes = new Set();
    graphData.links.forEach(l => {
      if (l.source === currentId || l.target === currentId) {
        connectedNodes.add(l.source);
        connectedNodes.add(l.target);
      }
    });

    // Find current node and center it
    const currentNode = nodes.find(n => n.id === currentId);
    const centerX = width / 2;
    const centerY = height / 2;
    
    if (currentNode) {
      // Set current node to center
      currentNode.fx = centerX;
      currentNode.fy = centerY;
    }

    // D3 force simulation for mini graph
    const simulation = d3.forceSimulation(nodes)
      .force('link', d3.forceLink(links).id(d => d.id).distance(30))
      .force('charge', d3.forceManyBody().strength(-60))
      .force('center', d3.forceCenter(centerX, centerY))
      .force('collision', d3.forceCollide().radius(10))
      .stop();

    // Run simulation synchronously for static layout
    for (let i = 0; i < 100; i++) simulation.tick();

    // Clamp positions (except current node which stays fixed)
    nodes.forEach(n => {
      if (n.id !== currentId) {
      n.x = Math.max(15, Math.min(width - 15, n.x));
      n.y = Math.max(15, Math.min(height - 15, n.y));
      }
    });
    
    // Release fixed position after simulation
    if (currentNode) {
      currentNode.fx = null;
      currentNode.fy = null;
    }

    // Draw links
    svg.selectAll('line')
      .data(links)
      .join('line')
      .attr('x1', d => d.source.x)
      .attr('y1', d => d.source.y)
      .attr('x2', d => d.target.x)
      .attr('y2', d => d.target.y)
      .attr('class', d => 'graph-link' + (connectedNodes.has(d.source.id) && connectedNodes.has(d.target.id) ? ' connected' : ''));

    // Draw nodes with hover tooltip
    const nodeGroups = svg.selectAll('g.mini-node')
      .data(nodes)
      .join('g')
      .attr('class', 'mini-node')
      .attr('transform', d => `translate(${d.x},${d.y})`);

    nodeGroups.append('circle')
      .attr('r', d => d.id === currentId ? 6 : (connectedNodes.has(d.id) ? 4 : 3))
      .attr('fill', d => d.id === currentId ? 'var(--bs-primary)' : (catColors[d.cat] || 'var(--bs-secondary)'))
      .attr('class', d => 'graph-node' + (d.id === currentId ? ' current' : ''));

    // Tooltip on hover
    const tooltip = d3.select(container).append('div')
      .attr('class', 'mini-graph-tooltip')
      .style('opacity', 0);

    nodeGroups
      .on('mouseenter', (event, d) => {
        tooltip.text(d.label)
          .style('left', (d.x + 10) + 'px')
          .style('top', (d.y - 5) + 'px')
          .style('opacity', 1);
      })
      .on('mouseleave', () => tooltip.style('opacity', 0));
  }
  
  // Render mini graph - ensure it runs
  function tryRenderMiniGraph() {
    const container = document.getElementById('mini-graph-container');
    if (!container) {
      console.warn('Mini graph container not found');
      return false;
    }
    if (typeof d3 === 'undefined') {
      console.warn('D3.js not loaded yet');
      return false;
    }
    if (!graphData) {
      console.warn('Graph data not available');
      return false;
    }
    try {
  renderMiniGraph();
      console.log('Mini graph rendered successfully');
      return true;
    } catch (error) {
      console.error('Error rendering mini graph:', error);
      return false;
    }
  }
  
  // Try immediately
  if (!tryRenderMiniGraph()) {
    // Wait for D3 to load
    let attempts = 0;
    const checkD3 = setInterval(() => {
      attempts++;
      if (tryRenderMiniGraph() || attempts > 50) {
        clearInterval(checkD3);
      }
    }, 100);
  }

  // Mobile floating graph button - always available as fallback
  const mobileGraphBtn = document.createElement('button');
  mobileGraphBtn.className = 'mobile-graph-btn';
  mobileGraphBtn.innerHTML = '&#x1F578;'; // spider web emoji as graph icon
  mobileGraphBtn.title = 'View connections (or press g)';
  mobileGraphBtn.setAttribute('aria-label', 'Open connection graph');
  mobileGraphBtn.type = 'button'; // Prevent form submission
  mobileGraphBtn.addEventListener('click', function(e) {
    e.preventDefault();
    e.stopPropagation();
    openGraph();
  });
  document.body.appendChild(mobileGraphBtn);
  
  // Ensure mobile button is always in DOM and accessible
  mobileGraphBtn.style.display = 'none'; // Hidden by default, shown via CSS on mobile
  
  // Debug: Log that graph navigation is initialized
  console.log('Graph navigation initialized:', {
    sidebarGraph: !!sidebarGraph,
    graphModal: !!graphModal,
    mobileGraphBtn: !!mobileGraphBtn,
    openGraph: typeof openGraph,
    graphData: !!graphData,
    d3Loaded: typeof d3 !== 'undefined',
    sidebarGraphElement: document.querySelector('.sidebar-graph'),
    miniGraphContainer: document.getElementById('mini-graph-container')
  });
  
  // Ensure sidebar graph is visible
  if (sidebarGraph) {
    console.log('Sidebar graph element created:', sidebarGraph);
    sidebarGraph.style.display = 'block';
    sidebarGraph.style.visibility = 'visible';
    sidebarGraph.style.opacity = '1';
  }
  
  // Test: Make sure openGraph is callable
  console.log('Testing openGraph function:', typeof openGraph);
  if (typeof openGraph === 'function') {
    console.log('openGraph is a function - good!');
  } else {
    console.error('openGraph is not a function!', openGraph);
  }
  
  // Test: Make sure keyboard handler is attached
  console.log('Keyboard handler attached:', typeof handleGraphKeyboard);
  
  // Test: Try to manually trigger openGraph after a short delay to verify it works
  setTimeout(() => {
    console.log('Testing graph system after 1 second...');
    const testModal = document.querySelector('.graph-modal-overlay');
    const testSidebar = document.querySelector('.sidebar-graph');
    const testBtn = document.querySelector('.mobile-graph-btn');
    console.log('Elements found:', {
      modal: !!testModal,
      sidebar: !!testSidebar,
      button: !!testBtn
    });
  }, 1000);

  let graphInitialized = false;
  let currentGraphState = { nodes: [], links: [], svg: null, simulation: null };
  let activeCategory = 'all';
  let searchFilter = '';
  
  let zoomBehavior = null;
  let currentTransform = d3.zoomIdentity;
  
  function initGraph() {
    console.log('initGraph called', { graphInitialized, d3Loaded: typeof d3 !== 'undefined' });
    if (graphInitialized || typeof d3 === 'undefined') {
      console.warn('initGraph skipped:', { graphInitialized, d3Loaded: typeof d3 !== 'undefined' });
      return;
    }
    graphInitialized = true;
    console.log('Rendering full graph...');
    renderGraph();
    
    // Setup search and filters
    const searchInput = document.getElementById('graph-search');
    if (searchInput) {
      searchInput.addEventListener('input', (e) => {
        searchFilter = e.target.value.toLowerCase();
        renderGraph();
      });
    }
    
    const filterBtns = document.querySelectorAll('.graph-filter-btn');
    filterBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        filterBtns.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        activeCategory = btn.dataset.cat;
        renderGraph();
      });
    });
    
    // Setup zoom controls
    const zoomInBtn = document.getElementById('zoom-in');
    const zoomOutBtn = document.getElementById('zoom-out');
    const zoomResetBtn = document.getElementById('zoom-reset');
    
    if (zoomInBtn) {
      zoomInBtn.addEventListener('click', () => {
    const container = document.getElementById('graph-container');
        const svg = d3.select(container).select('svg');
        if (svg && zoomBehavior) {
          svg.transition().call(zoomBehavior.scaleBy, 1.5);
        }
      });
    }
    
    if (zoomOutBtn) {
      zoomOutBtn.addEventListener('click', () => {
        const container = document.getElementById('graph-container');
        const svg = d3.select(container).select('svg');
        if (svg && zoomBehavior) {
          svg.transition().call(zoomBehavior.scaleBy, 1 / 1.5);
        }
      });
    }
    
    if (zoomResetBtn) {
      zoomResetBtn.addEventListener('click', () => {
        const container = document.getElementById('graph-container');
        const svg = d3.select(container).select('svg');
        if (svg && zoomBehavior) {
          svg.transition().call(zoomBehavior.transform, d3.zoomIdentity);
        }
      });
    }
  }
  
  function renderGraph() {
    const container = document.getElementById('graph-container');
    if (!container) return;
    
    // Clear existing graph
    d3.select(container).selectAll('*').remove();
    
    const width = container.clientWidth;
    const height = container.clientHeight;
    const currentId = getCurrentPageId();

    const svg = d3.select(container).append('svg')
      .attr('width', width)
      .attr('height', height);

    // Create a group for all graph elements (for zoom/pan)
    const g = svg.append('g');
    
    // Create zoom behavior
    zoomBehavior = d3.zoom()
      .scaleExtent([0.3, 3])
      .on('zoom', function(event) {
        currentTransform = event.transform;
        g.attr('transform', event.transform);
      });

    // Apply zoom to svg
    svg.call(zoomBehavior);

    // Filter nodes by category and search
    let filteredNodes = graphData.nodes.map(d => ({
      ...d,
      id: String(d.id)  // Ensure all node IDs are strings
    }));
    if (activeCategory !== 'all') {
      filteredNodes = filteredNodes.filter(n => n.cat === activeCategory);
    }
    if (searchFilter) {
      filteredNodes = filteredNodes.filter(n => 
        n.label.toLowerCase().includes(searchFilter) || 
        n.path.toLowerCase().includes(searchFilter)
      );
    }
    
    const nodeIds = new Set(filteredNodes.map(n => String(n.id)));
    
    // Filter links to only include filtered nodes
    // Create new link objects with string IDs for D3 forceLink
    const filteredLinks = graphData.links
      .filter(l => {
        const sourceId = typeof l.source === 'object' ? l.source.id : l.source;
        const targetId = typeof l.target === 'object' ? l.target.id : l.target;
        return nodeIds.has(sourceId) && nodeIds.has(targetId);
      })
      .map(l => {
        // Create new objects with string IDs (don't reference original)
        const sourceId = typeof l.source === 'object' ? l.source.id : l.source;
        const targetId = typeof l.target === 'object' ? l.target.id : l.target;
        return {source: String(sourceId), target: String(targetId)};
      });

    // Find connected nodes and paths
    const connectedNodes = new Set();
    const paths = new Map();
    
    graphData.links.forEach(l => {
      const sourceId = typeof l.source === 'object' ? l.source.id : l.source;
      const targetId = typeof l.target === 'object' ? l.target.id : l.target;
      
      if (sourceId === currentId || targetId === currentId) {
        connectedNodes.add(sourceId);
        connectedNodes.add(targetId);
      }
      
      // Build path map for highlighting
      if (!paths.has(sourceId)) paths.set(sourceId, new Set());
      paths.get(sourceId).add(targetId);
      if (!paths.has(targetId)) paths.set(targetId, new Set());
      paths.get(targetId).add(sourceId);
    });
    
    // Find all nodes in paths from current
    function findPathNodes(startId, visited = new Set()) {
      if (visited.has(startId)) return visited;
      visited.add(startId);
      const neighbors = paths.get(startId) || new Set();
      neighbors.forEach(neighbor => {
        if (nodeIds.has(neighbor)) {
          findPathNodes(neighbor, visited);
      }
    });
      return visited;
    }
    
    const pathNodes = currentId ? findPathNodes(currentId) : new Set();

    // Find current node and center it
    const currentNode = filteredNodes.find(n => String(n.id) === String(currentId));
    const centerX = width / 2;
    const centerY = height / 2;
    
    if (currentNode) {
      // Set current node to center and fix it there
      currentNode.fx = centerX;
      currentNode.fy = centerY;
    }

    // D3 force simulation for full graph - centered on current node
    // Create a map for quick node lookup by ID
    const nodeMap = new Map(filteredNodes.map(n => [String(n.id), n]));
    
    // Ensure all links reference valid node IDs (filteredLinks already has string IDs)
    const validLinks = filteredLinks.filter(l => {
      const sourceId = String(l.source);
      const targetId = String(l.target);
      return nodeMap.has(sourceId) && nodeMap.has(targetId);
    }).map(l => ({
      // Create fresh objects to avoid mutation issues
      source: String(l.source),
      target: String(l.target)
    }));
    
    const simulation = d3.forceSimulation(filteredNodes)
      .force('link', d3.forceLink(validLinks).id(d => String(d.id)).distance(80))
      .force('charge', d3.forceManyBody().strength(-200))
      .force('center', d3.forceCenter(centerX, centerY))
      .force('collision', d3.forceCollide().radius(25))
      .stop();

    // Run simulation synchronously
    for (let i = 0; i < 150; i++) simulation.tick();

    // Clamp positions (except current node which stays fixed at center)
    filteredNodes.forEach(n => {
      if (String(n.id) !== String(currentId)) {
      n.x = Math.max(50, Math.min(width - 50, n.x));
      n.y = Math.max(50, Math.min(height - 50, n.y));
      }
    });
    
    // Keep current node at center (don't release fixed position)
    // This ensures it stays centered even if simulation continues
    if (currentNode) {
      currentNode.fx = centerX;
      currentNode.fy = centerY;
    }

    // Draw links with path highlighting (inside the g group for zoom/pan)
    // After simulation, D3 mutates validLinks: source/target are now node objects
    g.selectAll('line.graph-link')
      .data(validLinks)
      .join('line')
      .attr('class', 'graph-link')
      .attr('x1', d => {
        // After simulation, source/target are node objects with x/y properties
        if (d.source && typeof d.source === 'object' && typeof d.source.x === 'number') {
          return d.source.x;
        }
        // Fallback: find node by ID if source is still a string
        const sourceId = typeof d.source === 'object' ? d.source.id : d.source;
        const sourceNode = filteredNodes.find(n => String(n.id) === String(sourceId));
        return sourceNode && typeof sourceNode.x === 'number' ? sourceNode.x : 0;
      })
      .attr('y1', d => {
        if (d.source && typeof d.source === 'object' && typeof d.source.y === 'number') {
          return d.source.y;
        }
        const sourceId = typeof d.source === 'object' ? d.source.id : d.source;
        const sourceNode = filteredNodes.find(n => String(n.id) === String(sourceId));
        return sourceNode && typeof sourceNode.y === 'number' ? sourceNode.y : 0;
      })
      .attr('x2', d => {
        if (d.target && typeof d.target === 'object' && typeof d.target.x === 'number') {
          return d.target.x;
        }
        const targetId = typeof d.target === 'object' ? d.target.id : d.target;
        const targetNode = filteredNodes.find(n => String(n.id) === String(targetId));
        return targetNode && typeof targetNode.x === 'number' ? targetNode.x : 0;
      })
      .attr('y2', d => {
        if (d.target && typeof d.target === 'object' && typeof d.target.y === 'number') {
          return d.target.y;
        }
        const targetId = typeof d.target === 'object' ? d.target.id : d.target;
        const targetNode = filteredNodes.find(n => String(n.id) === String(targetId));
        return targetNode && typeof targetNode.y === 'number' ? targetNode.y : 0;
      })
      .attr('class', d => {
        // Get IDs from node objects (after simulation) or fallback to string IDs
        const sourceId = d.source && typeof d.source === 'object' ? String(d.source.id) : String(d.source);
        const targetId = d.target && typeof d.target === 'object' ? String(d.target.id) : String(d.target);
        const bothConnected = connectedNodes.has(sourceId) && connectedNodes.has(targetId);
        const bothInPath = pathNodes.has(sourceId) && pathNodes.has(targetId);
        return 'graph-link' + (bothConnected ? ' connected' : '') + (bothInPath ? ' path' : '');
      });

    // Draw nodes with labels (inside the g group for zoom/pan)
    const nodeGroups = g.selectAll('g.graph-node')
      .data(filteredNodes)
      .join('g')
      .attr('class', d => {
        const isCurrent = d.id === currentId;
        const isConnected = connectedNodes.has(d.id);
        const isInPath = pathNodes.has(d.id);
        return 'graph-node' + 
          (isCurrent ? ' current' : '') + 
          (isConnected ? ' connected' : '') +
          (isInPath ? ' path' : '');
      })
      .attr('transform', d => `translate(${d.x},${d.y})`)
      .style('cursor', 'pointer')
      .on('click', (event, d) => { window.location.href = d.path; });

    nodeGroups.append('circle')
      .attr('r', d => {
        if (d.id === currentId) return 10;
        if (connectedNodes.has(d.id)) return 8;
        if (pathNodes.has(d.id)) return 7;
        return 6;
      })
      .attr('fill', d => {
        if (d.id === currentId) return '#20B2AA';  /* True Teal */
        if (connectedNodes.has(d.id)) return catColors[d.cat] || 'var(--bs-secondary)';
        if (pathNodes.has(d.id)) return catColors[d.cat] || 'var(--bs-secondary)';
        return catColors[d.cat] || 'var(--bs-secondary)';
      })
      .attr('opacity', d => {
        if (d.id === currentId) return 1;
        if (connectedNodes.has(d.id)) return 1;
        if (pathNodes.has(d.id)) return 0.8;
        return 0.5;
      });

    nodeGroups.append('text')
      .attr('y', 20)
      .text(d => d.label);
    
    currentGraphState = { nodes: filteredNodes, links: filteredLinks, svg, simulation };
  }
});
</script>

<!-- Image Lightbox/Modal for clickable enlargements -->
<style>
/* Lightbox overlay */
.image-lightbox {
  display: none;
  position: fixed;
  z-index: 10000;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.9);
  cursor: pointer;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.image-lightbox.active {
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 1;
}

.image-lightbox-content {
  max-width: 95%;
  max-height: 95%;
  margin: auto;
  display: block;
  object-fit: contain;
  cursor: default;
}

.image-lightbox-close {
  position: absolute;
  top: 20px;
  right: 35px;
  color: #f1f1f1;
  font-size: 40px;
  font-weight: bold;
  cursor: pointer;
  z-index: 10001;
  line-height: 1;
  transition: color 0.2s;
}

.image-lightbox-close:hover,
.image-lightbox-close:focus {
  color: #fff;
  text-decoration: none;
}

/* Make figures and images clickable */
.quarto-figure,
figure,
.cell-output-display img,
.cell-output-display svg,
.quarto-plot img,
img[src*=".png"],
img[src*=".jpg"],
img[src*=".jpeg"],
img[src*=".svg"] {
  cursor: pointer;
  transition: opacity 0.2s;
}

.quarto-figure:hover,
figure:hover,
.cell-output-display img:hover,
.cell-output-display svg:hover,
.quarto-plot img:hover,
img[src*=".png"]:hover,
img[src*=".jpg"]:hover,
img[src*=".jpeg"]:hover,
img[src*=".svg"]:hover {
  opacity: 0.9;
}

/* Exclude icons and small images */
.navbar img,
.nav-footer img,
img[width][width<100],
img[height][height<100] {
  cursor: default;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Create lightbox element
  const lightbox = document.createElement('div');
  lightbox.className = 'image-lightbox';
  lightbox.innerHTML = '<span class="image-lightbox-close">&times;</span><img class="image-lightbox-content" src="" alt="">';
  document.body.appendChild(lightbox);

  const lightboxImg = lightbox.querySelector('img');
  const lightboxClose = lightbox.querySelector('.image-lightbox-close');

  // Function to open lightbox
  function openLightbox(imgSrc, imgAlt) {
    lightboxImg.src = imgSrc;
    lightboxImg.alt = imgAlt || '';
    lightbox.classList.add('active');
    document.body.style.overflow = 'hidden';
  }

  // Function to close lightbox
  function closeLightbox() {
    lightbox.classList.remove('active');
    document.body.style.overflow = '';
  }

  // Close on X click
  lightboxClose.addEventListener('click', closeLightbox);

  // Close on overlay click
  lightbox.addEventListener('click', function(e) {
    if (e.target === lightbox) {
      closeLightbox();
    }
  });

  // Close on Escape key
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape' && lightbox.classList.contains('active')) {
      closeLightbox();
    }
  });

  // Make all figures and images clickable
  const selectors = [
    '.quarto-figure img',
    'figure img',
    '.cell-output-display img',
    '.cell-output-display svg',
    '.quarto-plot img',
    '.quarto-figure svg',
    'figure svg'
  ];

  selectors.forEach(selector => {
    document.querySelectorAll(selector).forEach(img => {
      // Skip small images (likely icons)
      if (img.width && img.width < 100) return;
      if (img.height && img.height < 100) return;
      
      // Skip navbar/footer images
      if (img.closest('.navbar') || img.closest('.nav-footer')) return;

      img.style.cursor = 'pointer';
      img.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        const src = this.src || this.getAttribute('data-src') || this.href;
        if (src) {
          openLightbox(src, this.alt || '');
        }
      });
    });
  });

  // Also handle figure containers
  document.querySelectorAll('.quarto-figure, figure').forEach(figure => {
    const img = figure.querySelector('img, svg');
    if (img && !img.closest('.navbar') && !img.closest('.nav-footer')) {
      figure.style.cursor = 'pointer';
      figure.addEventListener('click', function(e) {
        if (e.target.tagName !== 'IMG' && e.target.tagName !== 'SVG') {
          const img = this.querySelector('img, svg');
          if (img) {
            e.preventDefault();
            e.stopPropagation();
            const src = img.src || img.getAttribute('data-src') || img.href;
            if (src) {
              openLightbox(src, img.alt || '');
            }
          }
        }
      });
    }
  });

  // Back to top button
  (function() {
    const backToTopBtn = document.createElement('button');
    backToTopBtn.className = 'back-to-top-btn';
    backToTopBtn.innerHTML = '↑';
    backToTopBtn.setAttribute('aria-label', 'Back to top');
    backToTopBtn.setAttribute('title', 'Back to top');
    backToTopBtn.type = 'button';
    
    if (document.body) {
      document.body.appendChild(backToTopBtn);
    } else {
      // Wait for body if not ready
      setTimeout(function() {
        document.body.appendChild(backToTopBtn);
      }, 100);
    }

    function updateBackToTopVisibility() {
      if (!backToTopBtn.parentNode) return;
      const scrollY = window.pageYOffset || document.documentElement.scrollTop || window.scrollY || 0;
      if (scrollY > 300) {
        backToTopBtn.classList.add('visible');
      } else {
        backToTopBtn.classList.remove('visible');
      }
    }

    // Use both scroll events for better compatibility
    window.addEventListener('scroll', updateBackToTopVisibility, { passive: true });
    document.addEventListener('scroll', updateBackToTopVisibility, { passive: true });
    updateBackToTopVisibility(); // Check on load

    backToTopBtn.addEventListener('click', function(e) {
      e.preventDefault();
      e.stopPropagation();
      // Try multiple scroll methods for compatibility
      if (window.scrollTo) {
        window.scrollTo({
          top: 0,
          behavior: 'smooth'
        });
      } else if (document.documentElement.scrollTo) {
        document.documentElement.scrollTo({
          top: 0,
          behavior: 'smooth'
        });
      } else {
        // Fallback
        window.scrollTo(0, 0);
      }
    });
  })();


  // Related Notes Section
  function addRelatedNotes() {
    // Only on note pages (not index, not projects, etc.)
    const path = window.location.pathname;
    const isNotePage = path.startsWith('/notes/') && 
                      !path.endsWith('/notes/') && 
                      !path.endsWith('/notes/index.html') &&
                      path.includes('.html');
    
    if (!isNotePage) return;

    // Get current page categories from meta tags or page data
    const currentCategories = [];
    const currentTags = [];
    
    // Try to get from meta tags
    const categoryMeta = document.querySelector('meta[name="categories"], meta[property="article:tag"]');
    if (categoryMeta) {
      const cats = categoryMeta.content.split(',').map(c => c.trim());
      currentCategories.push(...cats);
    }
    
    // Try to get from page data attributes
    const pageData = document.querySelector('[data-categories]');
    if (pageData) {
      const cats = pageData.getAttribute('data-categories').split(',').map(c => c.trim());
      currentCategories.push(...cats);
    }

    // Get all notes from search.json or listings
    fetch('/search.json')
      .then(response => response.json())
      .then(data => {
        // Extract unique note pages
        const notePages = new Map();
        data.forEach(item => {
          if (item.href && item.href.startsWith('/notes/') && 
              !item.href.endsWith('/notes/index.html') &&
              item.href.includes('.html') &&
              !item.section) { // Only main pages, not sections
            if (!notePages.has(item.href) || !notePages.get(item.href).title) {
              notePages.set(item.href, {
                href: item.href,
                title: item.title || 'Untitled',
                text: item.text || ''
              });
            }
          }
        });

        // Find related notes (simple: same title words or series)
        const currentTitle = document.querySelector('h1, .quarto-title h1')?.textContent || '';
        const currentText = document.body.innerText || '';
        const currentTitleWords = currentTitle.toLowerCase().split(/\s+/);
        
        const related = Array.from(notePages.values())
          .filter(note => {
            // Don't include current page
            if (note.href === path || note.href === path.replace('.html', '')) return false;
            
            // Check for shared words in title
            const noteTitleWords = note.title.toLowerCase().split(/\s+/);
            const sharedWords = currentTitleWords.filter(w => 
              w.length > 3 && noteTitleWords.includes(w)
            );
            
            // Check for series (e.g., "Part 1", "Part 2")
            const isSeries = /part\s+\d+/i.test(currentTitle) && /part\s+\d+/i.test(note.title);
            
            return sharedWords.length > 0 || isSeries || 
                   (currentText.includes('risk') && note.text.toLowerCase().includes('risk')) ||
                   (currentText.includes('climate') && note.text.toLowerCase().includes('climate'));
          })
          .slice(0, 5); // Limit to 5 related notes

        if (related.length > 0) {
          // Create related notes section
          const relatedSection = document.createElement('div');
          relatedSection.className = 'related-notes-section';
          relatedSection.innerHTML = `
            <h2 class="related-notes-heading">Related Notes</h2>
            <ul class="related-notes-list">
              ${related.map(note => `
                <li>
                  <a href="${note.href}">${note.title}</a>
                </li>
              `).join('')}
            </ul>
          `;

          // Insert before footer or at end of content
          const content = document.querySelector('#quarto-document-content, .content, main, article');
          if (content) {
            content.appendChild(relatedSection);
          }
        }
      })
      .catch(err => console.log('Could not load related notes:', err));
  }

  // Run after page load
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', addRelatedNotes);
  } else {
    addRelatedNotes();
  }
});
</script>

<style>
/* Related Notes Section */
.related-notes-section {
  margin-top: 3rem;
  padding-top: 2rem;
  border-top: 1px solid var(--bs-border-color);
}

.related-notes-heading {
  font-size: 1.25rem;
  font-weight: 600;
  margin-bottom: 1rem;
  color: var(--bs-body-color);
}

.related-notes-list {
  list-style: none;
  padding: 0;
  margin: 0;
}

.related-notes-list li {
  margin-bottom: 0.75rem;
  padding-left: 1.5rem;
  position: relative;
}

.related-notes-list li::before {
  content: '→';
  position: absolute;
  left: 0;
  color: var(--bs-secondary);
}

.related-notes-list a {
  color: #1a1a1a !important;  /* Subtle, matches body text */
  text-decoration: none;
  transition: color 0.2s;
}

.related-notes-list a:hover {
  color: #20B2AA !important;  /* Teal on hover for interactivity */
  text-decoration: underline;
}
</style>

<style>
/* Back to top button */
.back-to-top-btn {
  position: fixed;
  bottom: 2rem;
  right: 2rem;
  width: 48px;
  height: 48px;
  border-radius: 50%;
  background: var(--bs-body-bg);
  border: 1px solid var(--bs-border-color);
  color: var(--bs-body-color);
  font-size: 1.2rem;
  cursor: pointer;
  z-index: 999;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  transition: all 0.3s ease;
  opacity: 0;
  visibility: hidden;
  transform: translateY(20px);
  display: flex;
  align-items: center;
  justify-content: center;
}

.back-to-top-btn.visible {
  opacity: 1;
  visibility: visible;
  transform: translateY(0);
}

.back-to-top-btn:hover {
  background: var(--bs-primary);
  color: var(--bs-body-bg);
  border-color: var(--bs-primary);
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.back-to-top-btn:active {
  transform: translateY(0);
}

@media (max-width: 768px) {
  .back-to-top-btn {
    bottom: 1rem;
    right: 1rem;
    width: 44px;
    height: 44px;
    font-size: 1.1rem;
  }
}

/* Hide in print */
@media print {
  .back-to-top-btn {
    display: none !important;
  }
}
</style>

<style>
/* Collapsible Code Blocks - Global */
.code-block-wrapper {
  margin: 1.5rem 0;
  border: 1px solid var(--bs-border-color);
  border-radius: 0.5rem;
  background: #f8f8f8;
  overflow: hidden;
}

.code-block-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.5rem 1rem;
  background: #f0f0f0;
  border-bottom: 1px solid var(--bs-border-color);
  cursor: pointer;
  user-select: none;
  transition: background 0.2s ease;
}

.code-block-header:hover {
  background: #e8e8e8;
}

.code-block-title {
  font-family: "IBM Plex Sans", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;
  font-size: 0.85rem;
  font-weight: 500;
  color: #666;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.code-block-toggle {
  font-size: 0.75rem;
  color: #666;
  transition: transform 0.2s ease;
  display: inline-block;
}

.code-block-wrapper.expanded .code-block-toggle {
  transform: rotate(180deg);
}

.code-block-content {
  display: none;
  overflow: hidden;
}

.code-block-wrapper.expanded .code-block-content {
  display: block;
}

.code-block-wrapper pre,
.code-block-wrapper code {
  margin: 0;
  border-radius: 0;
}

/* Ensure outputs are always visible - never collapse them */
.cell-output,
.cell-output-stdout,
.cell-output-stderr,
.cell-output-display,
.cell-output pre,
.cell-output code {
  display: block !important;
  visibility: visible !important;
  opacity: 1 !important;
}

/* Ensure unwrapped code blocks are visible until JavaScript wraps them */
pre.sourceCode:not(.code-block-wrapper pre.sourceCode),
.cell-code:not(.code-block-wrapper .cell-code) {
  display: block !important;
}
</style>

<script>
(function() {
  // Function to wrap code blocks in collapsible structure
  // ONLY wrap input code blocks, NOT outputs
  function makeCodeBlocksCollapsible() {
    try {
    // Find only INPUT code blocks - exclude outputs
    // Target pre.sourceCode (standalone code blocks) and .cell-code (input code in cells)
    // Exclude ones already wrapped and exclude any inside .cell-output
    const codeBlocks = document.querySelectorAll('pre.sourceCode:not(.code-block-wrapper pre.sourceCode):not(.cell-output pre), .cell-code:not(.code-block-wrapper .cell-code):not(.cell-output .cell-code)');
    
    if (codeBlocks.length === 0) return;
    
    codeBlocks.forEach(function(block) {
      // Skip if already wrapped
      if (block.closest('.code-block-wrapper')) {
        return;
      }

      // Skip if inside output container
      if (block.closest('.cell-output, .cell-output-stdout, .cell-output-stderr, .cell-output-display')) {
        return;
      }

      // Skip inline code
      if (block.tagName === 'CODE' && block.parentElement && block.parentElement.tagName !== 'PRE') {
        return;
      }

      // Get language from class or parent
      let language = 'code';
      const classList = block.className || '';
      if (classList.includes('sourceCode')) {
        const match = classList.match(/sourceCode-(\w+)/);
        if (match) language = match[1];
      } else if (block.querySelector('code')) {
        const codeEl = block.querySelector('code');
        if (codeEl && codeEl.className) {
          const match = codeEl.className.match(/language-(\w+)|sourceCode-(\w+)/);
          if (match) language = match[1] || match[2];
        }
      }

      // Create wrapper
      const wrapper = document.createElement('div');
      wrapper.className = 'code-block-wrapper';

      // Create header
      const header = document.createElement('div');
      header.className = 'code-block-header';
      header.innerHTML = `
        <span class="code-block-title">
          <span class="code-block-toggle">▼</span>
          <span>${language}</span>
        </span>
      `;

      // Create content container
      const content = document.createElement('div');
      content.className = 'code-block-content';
      
      // Store parent and next sibling BEFORE moving block
      const parent = block.parentNode;
      const nextSibling = block.nextSibling;
      
      // Move the block into content (don't clone, move it)
      // This removes block from parent, so we need parent/nextSibling before this
      content.appendChild(block);

      // Assemble
      wrapper.appendChild(header);
      wrapper.appendChild(content);
      
      // Insert wrapper where block was
      // Note: block is now inside content, so we insert wrapper at block's old position
      if (parent) {
        // If there's a next sibling, insert before it (block was before nextSibling)
        // Otherwise append to end
        if (nextSibling && nextSibling.parentNode === parent) {
          parent.insertBefore(wrapper, nextSibling);
        } else {
          // If nextSibling is null or invalid, append to parent
          parent.appendChild(wrapper);
        }
      }

      // Add click handler
      header.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        wrapper.classList.toggle('expanded');
      });
    });
    } catch (error) {
      console.error('Error in makeCodeBlocksCollapsible:', error);
      // Don't break the page if code block wrapping fails
    }
  }

  // Run when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', makeCodeBlocksCollapsible);
  } else {
    // DOM already loaded
    makeCodeBlocksCollapsible();
  }

  // Also run after delays to catch dynamically loaded content
  setTimeout(makeCodeBlocksCollapsible, 100);
  setTimeout(makeCodeBlocksCollapsible, 500);
  setTimeout(makeCodeBlocksCollapsible, 1000);

  // Use MutationObserver to catch dynamically added code blocks
  const observer = new MutationObserver(function(mutations) {
    let shouldRun = false;
    mutations.forEach(function(mutation) {
      if (mutation.addedNodes.length > 0) {
        mutation.addedNodes.forEach(function(node) {
          if (node.nodeType === 1) { // Element node
            // Only trigger if it's an input code block, not an output
            if (node.matches && (
              (node.matches('pre.sourceCode') && !node.closest('.cell-output')) ||
              (node.matches('.cell-code') && !node.closest('.cell-output')) ||
              (node.querySelector && node.querySelector('pre.sourceCode:not(.cell-output pre), .cell-code:not(.cell-output .cell-code)'))
            )) {
              shouldRun = true;
            }
          }
        });
      }
    });
    if (shouldRun) {
      setTimeout(makeCodeBlocksCollapsible, 100);
    }
  });

  // Start observing
  if (document.body) {
    observer.observe(document.body, {
      childList: true,
      subtree: true
    });
  } else {
    document.addEventListener('DOMContentLoaded', function() {
      observer.observe(document.body, {
        childList: true,
        subtree: true
      });
    });
  }
})();
</script>


<meta property="og:title" content="Climate Extremes Explorer – re:current_analytics">
<meta property="og:description" content="Comprehensive interactive analysis of climate extremes using synthetic climate data. Demonstrates methods for identifying, analyzing, and visualizing extreme climate events including heatwaves, cold snaps, and extreme precipitation. Features return period analysis, event clustering, and multi-variable correlation analysis.">
<meta property="og:site_name" content="re:current_analytics">
<meta name="twitter:title" content="Climate Extremes Explorer – re:current_analytics">
<meta name="twitter:description" content="Comprehensive interactive analysis of climate extremes using synthetic climate data. Demonstrates methods for identifying, analyzing, and visualizing extreme climate events including heatwaves, cold snaps, and extreme precipitation. Features return period analysis, event clustering, and multi-variable correlation analysis.">
<meta name="twitter:creator" content="@timmwalker">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">re:current_analytics</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-wide tools-end">
    <a href="mailto:timm.walker@recurrentanalytics.com" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-envelope"></i></a>
    <a href="https://github.com/recurrentanalytics" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#building-the-foundation-synthetic-climate-data" id="toc-building-the-foundation-synthetic-climate-data" class="nav-link" data-scroll-target="#building-the-foundation-synthetic-climate-data">Building the Foundation: Synthetic Climate Data</a>
  <ul class="collapse">
  <li><a href="#generate-and-load-climate-data" id="toc-generate-and-load-climate-data" class="nav-link" data-scroll-target="#generate-and-load-climate-data">Generate and Load Climate Data</a></li>
  </ul></li>
  <li><a href="#defining-the-extreme-operational-thresholds" id="toc-defining-the-extreme-operational-thresholds" class="nav-link" data-scroll-target="#defining-the-extreme-operational-thresholds">Defining the Extreme: Operational Thresholds</a>
  <ul class="collapse">
  <li><a href="#identify-extreme-events" id="toc-identify-extreme-events" class="nav-link" data-scroll-target="#identify-extreme-events">Identify Extreme Events</a></li>
  </ul></li>
  <li><a href="#temporal-patterns-when-extremes-occur" id="toc-temporal-patterns-when-extremes-occur" class="nav-link" data-scroll-target="#temporal-patterns-when-extremes-occur">Temporal Patterns: When Extremes Occur</a></li>
  <li><a href="#return-periods-quantifying-rarity" id="toc-return-periods-quantifying-rarity" class="nav-link" data-scroll-target="#return-periods-quantifying-rarity">Return Periods: Quantifying Rarity</a></li>
  <li><a href="#correlation-structure-when-variables-move-together" id="toc-correlation-structure-when-variables-move-together" class="nav-link" data-scroll-target="#correlation-structure-when-variables-move-together">Correlation Structure: When Variables Move Together</a></li>
  <li><a href="#event-typology-clustering-extreme-events" id="toc-event-typology-clustering-extreme-events" class="nav-link" data-scroll-target="#event-typology-clustering-extreme-events">Event Typology: Clustering Extreme Events</a></li>
  <li><a href="#intensity-distribution-the-shape-of-extremes" id="toc-intensity-distribution-the-shape-of-extremes" class="nav-link" data-scroll-target="#intensity-distribution-the-shape-of-extremes">Intensity Distribution: The Shape of Extremes</a></li>
  <li><a href="#synthesis-what-the-numbers-tell-us" id="toc-synthesis-what-the-numbers-tell-us" class="nav-link" data-scroll-target="#synthesis-what-the-numbers-tell-us">Synthesis: What the Numbers Tell Us</a></li>
  <li><a href="#note" id="toc-note" class="nav-link" data-scroll-target="#note">Note</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Climate Extremes Explorer</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
  <div class="quarto-categories">
    <div class="quarto-category">climate</div>
    <div class="quarto-category">extremes</div>
    <div class="quarto-category">analysis</div>
    <div class="quarto-category">visualization</div>
  </div>
  </div>

<div>
  <div class="description">
    Comprehensive interactive analysis of climate extremes using synthetic climate data. Demonstrates methods for identifying, analyzing, and visualizing extreme climate events including heatwaves, cold snaps, and extreme precipitation. Features return period analysis, event clustering, and multi-variable correlation analysis.
  </div>
</div>


<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">December 15, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="overview" class="level2">
<h2 data-anchor-id="overview">Overview</h2>
<p>Extreme climate events—heatwaves, cold snaps, extreme precipitation—are not anomalies to be dismissed as outliers. They are the signal. Understanding their frequency, intensity, and co-occurrence patterns is fundamental to climate risk assessment. This analysis applies extreme value theory and multivariate statistics to extract structure from what appears chaotic.</p>
<p>The framework demonstrates:</p>
<ul>
<li><strong>Extreme Event Identification</strong> - Multiple methods (percentile, absolute, anomaly)</li>
<li><strong>Return Period Analysis</strong> - Extreme value theory (Block Maxima, Peaks Over Threshold)</li>
<li><strong>Multi-Variable Correlation</strong> - Relationships between climate variables</li>
<li><strong>Event Clustering</strong> - Hierarchical clustering of extreme events</li>
<li><strong>Statistical Analysis</strong> - Comprehensive extreme event statistics</li>
</ul>
</section>
<section id="building-the-foundation-synthetic-climate-data" class="level2">
<h2 data-anchor-id="building-the-foundation-synthetic-climate-data">Building the Foundation: Synthetic Climate Data</h2>
<p>Before we can identify extremes, we need a baseline. Synthetic data generation here serves two purposes: it provides a controlled environment to test methods, and it demonstrates how realistic climate variability can emerge from relatively simple stochastic processes. The data spans 24 years (2000-2023) with daily resolution, capturing temperature, precipitation, and atmospheric pressure—three variables that interact in complex ways.</p>
<p>The synthetic generation incorporates: - <strong>Seasonal cycles</strong> (annual temperature variation, precipitation patterns) - <strong>Inter-annual variability</strong> (year-to-year fluctuations) - <strong>Cross-variable dependencies</strong> (temperature-precipitation relationships) - <strong>Autocorrelation</strong> (weather persistence over days)</p>
<p>This isn’t “fake data” in the pejorative sense—it’s a generative model that captures the statistical structure of real climate systems. When we later identify extremes, we’re finding events that would be rare under this baseline distribution.</p>
<section id="generate-and-load-climate-data" class="level3">
<h3 data-anchor-id="generate-and-load-climate-data">Generate and Load Climate Data</h3>
<div id="7e57d316" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    HAS_SEABORN <span class="op">=</span> <span class="va">True</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">ImportError</span>:</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    HAS_SEABORN <span class="op">=</span> <span class="va">False</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Note: seaborn not available, using matplotlib for heatmap"</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> src.climate_extremes <span class="im">import</span> (</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    generate_synthetic_climate_data,</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    identify_extremes,</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    compute_return_periods,</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    analyze_correlations,</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    cluster_extreme_events,</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    compute_extreme_statistics,</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate synthetic climate data (2000-2023, daily)</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Generating synthetic climate data..."</span>)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>climate_data <span class="op">=</span> generate_synthetic_climate_data(</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    start_date<span class="op">=</span><span class="st">"2000-01-01"</span>,</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    end_date<span class="op">=</span><span class="st">"2023-12-31"</span>,</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>    freq<span class="op">=</span><span class="st">"D"</span>,</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>    seed<span class="op">=</span><span class="dv">42</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Data shape: </span><span class="sc">{</span>climate_data<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Date range: </span><span class="sc">{</span>climate_data[<span class="st">'datetime_utc'</span>]<span class="sc">.</span><span class="bu">min</span>()<span class="sc">}</span><span class="ss"> to </span><span class="sc">{</span>climate_data[<span class="st">'datetime_utc'</span>]<span class="sc">.</span><span class="bu">max</span>()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">First few rows:"</span>)</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(climate_data.head())</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Summary statistics:"</span>)</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(climate_data[[<span class="st">'temperature_c'</span>, <span class="st">'precipitation_mm'</span>, <span class="st">'pressure_hpa'</span>]].describe())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
<section id="defining-the-extreme-operational-thresholds" class="level2">
<h2 data-anchor-id="defining-the-extreme-operational-thresholds">Defining the Extreme: Operational Thresholds</h2>
<p>What counts as “extreme” is not a question with a single answer. It’s a modeling choice with real consequences. We use the 95th percentile threshold—meaning 5% of days exceed this value—but this is arbitrary. A heatwave that’s extreme in one region might be normal in another. A 3-day minimum duration filters out single-day spikes, focusing on sustained events that have greater impact.</p>
<p>The choice of method matters: - <strong>Percentile-based</strong>: Relative to the local distribution (adapts to regional climate) - <strong>Absolute thresholds</strong>: Fixed values (e.g., 30°C) that ignore local context - <strong>Anomaly-based</strong>: Deviations from expected seasonal patterns</p>
<p>Here, we use percentile thresholds because they’re scale-invariant and adapt to the data’s inherent variability. A 95th percentile heatwave in a temperate region might be 28°C, while in a desert it might be 42°C—both are equally “extreme” relative to their contexts.</p>
<section id="identify-extreme-events" class="level3">
<h3 data-anchor-id="identify-extreme-events">Identify Extreme Events</h3>
<div id="4f64a2fa" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify extreme temperature events (95th percentile, minimum 3 consecutive days)</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>climate_data <span class="op">=</span> identify_extremes(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    climate_data,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    variable<span class="op">=</span><span class="st">'temperature_c'</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    method<span class="op">=</span><span class="st">'percentile'</span>,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    threshold<span class="op">=</span><span class="fl">95.0</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    min_duration<span class="op">=</span><span class="dv">3</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Also identify extreme precipitation events</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>climate_data <span class="op">=</span> identify_extremes(</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    climate_data,</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    variable<span class="op">=</span><span class="st">'precipitation_mm'</span>,</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    method<span class="op">=</span><span class="st">'percentile'</span>,</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    threshold<span class="op">=</span><span class="fl">95.0</span>,</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    min_duration<span class="op">=</span><span class="dv">1</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute statistics</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>temp_stats <span class="op">=</span> compute_extreme_statistics(climate_data, <span class="st">'temperature_c'</span>)</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>precip_stats <span class="op">=</span> compute_extreme_statistics(climate_data, <span class="st">'precipitation_mm'</span>)</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Temperature Extreme Events:"</span>)</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Number of events: </span><span class="sc">{</span>temp_stats[<span class="st">'n_events'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Total extreme days: </span><span class="sc">{</span>temp_stats[<span class="st">'total_days'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Mean intensity: </span><span class="sc">{</span>temp_stats[<span class="st">'mean_intensity'</span>]<span class="sc">:.2f}</span><span class="ss">°C above threshold"</span>)</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Maximum intensity: </span><span class="sc">{</span>temp_stats[<span class="st">'max_intensity'</span>]<span class="sc">:.2f}</span><span class="ss">°C above threshold"</span>)</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Mean duration: </span><span class="sc">{</span>temp_stats[<span class="st">'mean_duration'</span>]<span class="sc">:.1f}</span><span class="ss"> days"</span>)</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Precipitation Extreme Events:"</span>)</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Number of events: </span><span class="sc">{</span>precip_stats[<span class="st">'n_events'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Total extreme days: </span><span class="sc">{</span>precip_stats[<span class="st">'total_days'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Mean intensity: </span><span class="sc">{</span>precip_stats[<span class="st">'mean_intensity'</span>]<span class="sc">:.2f}</span><span class="ss"> mm above threshold"</span>)</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Maximum intensity: </span><span class="sc">{</span>precip_stats[<span class="st">'max_intensity'</span>]<span class="sc">:.2f}</span><span class="ss"> mm above threshold"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
<section id="temporal-patterns-when-extremes-occur" class="level2">
<h2 data-anchor-id="temporal-patterns-when-extremes-occur">Temporal Patterns: When Extremes Occur</h2>
<p>The timeline visualization reveals something crucial: extreme events are not uniformly distributed. They cluster in time, creating periods of elevated risk. The temperature extremes show clear seasonal patterns—heatwaves in summer, cold snaps in winter—but also reveal inter-annual variability. Some years are quiet; others are punctuated by multiple extreme events.</p>
<p>This temporal clustering has implications for risk assessment. If extremes were independent random events, we could model them with simple Poisson processes. But they’re not. They exhibit persistence (heatwaves last multiple days) and clustering (extreme years contain multiple extreme events). This means risk is not constant—it’s time-varying and state-dependent.</p>
<p>The visualization also shows the relationship between variables. Notice how extreme precipitation events sometimes coincide with temperature extremes (convective storms during heatwaves), and sometimes don’t (frontal systems during cooler periods). This co-occurrence—or lack thereof—matters for compound risk assessment.</p>
<div id="e1c47ce2" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create timeline visualization with extreme events highlighted</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">3</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">10</span>), sharex<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Temperature with extreme events</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> axes[<span class="dv">0</span>]</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>ax1.plot(climate_data[<span class="st">'datetime_utc'</span>], climate_data[<span class="st">'temperature_c'</span>], </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>         color<span class="op">=</span><span class="st">'#2c3e50'</span>, alpha<span class="op">=</span><span class="fl">0.6</span>, linewidth<span class="op">=</span><span class="fl">0.8</span>, label<span class="op">=</span><span class="st">'Temperature'</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>ax1.scatter(climate_data[climate_data[<span class="st">'is_extreme'</span>]][<span class="st">'datetime_utc'</span>],</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>           climate_data[climate_data[<span class="st">'is_extreme'</span>]][<span class="st">'temperature_c'</span>],</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>           c<span class="op">=</span><span class="st">'#e74c3c'</span>, s<span class="op">=</span><span class="dv">30</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, label<span class="op">=</span><span class="st">'Extreme Events'</span>, zorder<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>ax1.axhline(y<span class="op">=</span>np.percentile(climate_data[<span class="st">'temperature_c'</span>], <span class="dv">95</span>), </span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>           color<span class="op">=</span><span class="st">'#c0392b'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, label<span class="op">=</span><span class="st">'95th Percentile'</span>)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'Temperature (°C)'</span>, fontsize<span class="op">=</span><span class="dv">11</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">'Temperature Time Series with Extreme Events Highlighted'</span>, </span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>              fontsize<span class="op">=</span><span class="dv">13</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, pad<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>ax1.legend(loc<span class="op">=</span><span class="st">'upper left'</span>, fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>ax1.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Precipitation with extreme events</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> axes[<span class="dv">1</span>]</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>ax2.plot(climate_data[<span class="st">'datetime_utc'</span>], climate_data[<span class="st">'precipitation_mm'</span>], </span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>         color<span class="op">=</span><span class="st">'#3498db'</span>, alpha<span class="op">=</span><span class="fl">0.6</span>, linewidth<span class="op">=</span><span class="fl">0.8</span>, label<span class="op">=</span><span class="st">'Precipitation'</span>)</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>precip_extremes <span class="op">=</span> climate_data[climate_data[<span class="st">'precipitation_mm'</span>] <span class="op">&gt;=</span> </span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>                               np.percentile(climate_data[<span class="st">'precipitation_mm'</span>], <span class="dv">95</span>)]</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>ax2.scatter(precip_extremes[<span class="st">'datetime_utc'</span>], precip_extremes[<span class="st">'precipitation_mm'</span>],</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>           c<span class="op">=</span><span class="st">'#2980b9'</span>, s<span class="op">=</span><span class="dv">30</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, label<span class="op">=</span><span class="st">'Extreme Events'</span>, zorder<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>ax2.axhline(y<span class="op">=</span>np.percentile(climate_data[<span class="st">'precipitation_mm'</span>], <span class="dv">95</span>), </span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>           color<span class="op">=</span><span class="st">'#21618c'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, label<span class="op">=</span><span class="st">'95th Percentile'</span>)</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'Precipitation (mm)'</span>, fontsize<span class="op">=</span><span class="dv">11</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">'Precipitation Time Series with Extreme Events Highlighted'</span>, </span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>              fontsize<span class="op">=</span><span class="dv">13</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, pad<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>ax2.legend(loc<span class="op">=</span><span class="st">'upper left'</span>, fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>ax2.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Pressure</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>ax3 <span class="op">=</span> axes[<span class="dv">2</span>]</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>ax3.plot(climate_data[<span class="st">'datetime_utc'</span>], climate_data[<span class="st">'pressure_hpa'</span>], </span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>         color<span class="op">=</span><span class="st">'#7f8c8d'</span>, alpha<span class="op">=</span><span class="fl">0.6</span>, linewidth<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>ax3.set_ylabel(<span class="st">'Pressure (hPa)'</span>, fontsize<span class="op">=</span><span class="dv">11</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>ax3.set_xlabel(<span class="st">'Date'</span>, fontsize<span class="op">=</span><span class="dv">11</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>ax3.set_title(<span class="st">'Atmospheric Pressure Time Series'</span>, </span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>              fontsize<span class="op">=</span><span class="dv">13</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, pad<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>ax3.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="return-periods-quantifying-rarity" class="level2">
<h2 data-anchor-id="return-periods-quantifying-rarity">Return Periods: Quantifying Rarity</h2>
<p>Return period analysis answers a deceptively simple question: “How often should we expect an event of this magnitude?” A 100-year return period doesn’t mean it happens exactly once per century—it means the annual probability is 1%. Over a 100-year period, there’s a 63% chance of experiencing at least one such event (due to the compounding of probabilities).</p>
<p>The two methods shown here capture different aspects of extremes: - <strong>Block Maxima (Annual Maxima)</strong>: Takes the maximum value each year, fits a Generalized Extreme Value (GEV) distribution. Good for understanding the worst-case scenario in any given year. - <strong>Peaks Over Threshold</strong>: Identifies all values above a threshold, fits a Generalized Pareto Distribution (GPD). More data-efficient, captures multiple extremes per year.</p>
<p>The log-scale x-axis is intentional. Return periods follow a power-law relationship—doubling the return period doesn’t double the intensity. The curve flattens, meaning truly catastrophic events (1000-year return periods) are only marginally more intense than 100-year events, but exponentially rarer.</p>
<p>This analysis is the foundation of engineering design standards (dams, bridges, flood defenses) and insurance pricing. The “100-year flood” isn’t a prediction—it’s a risk metric.</p>
<div id="8d8c570c" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute return periods for temperature extremes</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>return_periods_temp <span class="op">=</span> compute_return_periods(</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    climate_data,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    variable<span class="op">=</span><span class="st">'temperature_c'</span>,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    method<span class="op">=</span><span class="st">'block_maxima'</span>,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    block_size<span class="op">=</span><span class="st">'1Y'</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>return_periods_precip <span class="op">=</span> compute_return_periods(</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    climate_data,</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    variable<span class="op">=</span><span class="st">'precipitation_mm'</span>,</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    method<span class="op">=</span><span class="st">'peaks_over_threshold'</span>,</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">5</span>))</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Temperature return periods</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> axes[<span class="dv">0</span>]</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>ax1.plot(return_periods_temp[<span class="st">'return_period_years'</span>], </span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>        return_periods_temp[<span class="st">'return_value'</span>], </span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>        marker<span class="op">=</span><span class="st">'o'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, markersize<span class="op">=</span><span class="dv">8</span>, color<span class="op">=</span><span class="st">'#e74c3c'</span>)</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'Return Period (years)'</span>, fontsize<span class="op">=</span><span class="dv">11</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'Return Value (°C)'</span>, fontsize<span class="op">=</span><span class="dv">11</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">'Temperature: Return Period Analysis</span><span class="ch">\n</span><span class="st">(Annual Maxima Method)'</span>, </span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>              fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>ax1.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>ax1.set_xscale(<span class="st">'log'</span>)</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Precipitation return periods</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> axes[<span class="dv">1</span>]</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>ax2.plot(return_periods_precip[<span class="st">'return_period_years'</span>], </span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>        return_periods_precip[<span class="st">'return_value'</span>], </span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>        marker<span class="op">=</span><span class="st">'o'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, markersize<span class="op">=</span><span class="dv">8</span>, color<span class="op">=</span><span class="st">'#3498db'</span>)</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>ax2.set_xlabel(<span class="st">'Return Period (years)'</span>, fontsize<span class="op">=</span><span class="dv">11</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'Return Value (mm)'</span>, fontsize<span class="op">=</span><span class="dv">11</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">'Precipitation: Return Period Analysis</span><span class="ch">\n</span><span class="st">(Peaks Over Threshold Method)'</span>, </span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>              fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>ax2.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>ax2.set_xscale(<span class="st">'log'</span>)</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Return Period Analysis Results:"</span>)</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Temperature (Annual Maxima):"</span>)</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(return_periods_temp.to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Precipitation (Peaks Over Threshold):"</span>)</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(return_periods_precip.to_string(index<span class="op">=</span><span class="va">False</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="correlation-structure-when-variables-move-together" class="level2">
<h2 data-anchor-id="correlation-structure-when-variables-move-together">Correlation Structure: When Variables Move Together</h2>
<p>Climate variables don’t exist in isolation. Temperature, precipitation, and pressure are coupled through physical processes. The correlation matrix quantifies these relationships, but the interpretation requires care.</p>
<p>A negative correlation between temperature and precipitation might seem counterintuitive, but it reflects the physics: high-pressure systems (clear skies, high temperatures) suppress precipitation, while low-pressure systems (clouds, precipitation) moderate temperatures. The strength of these correlations varies by season and region.</p>
<p>Why this matters: if variables are correlated, extreme events in one variable are more likely to co-occur with extremes in another. This creates compound risks that simple univariate analysis misses. A heatwave coinciding with low precipitation creates drought stress. A cold snap with high precipitation creates ice storms. The correlation structure tells us which compound events are physically plausible and which are unlikely.</p>
<div id="61d75ad4" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute correlation matrix</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>corr_matrix <span class="op">=</span> analyze_correlations(</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    climate_data,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    variables<span class="op">=</span>[<span class="st">'temperature_c'</span>, <span class="st">'precipitation_mm'</span>, <span class="st">'pressure_hpa'</span>]</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create heatmap</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> HAS_SEABORN:</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    sns.heatmap(corr_matrix, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">'.3f'</span>, cmap<span class="op">=</span><span class="st">'RdBu_r'</span>, center<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>               square<span class="op">=</span><span class="va">True</span>, linewidths<span class="op">=</span><span class="dv">1</span>, cbar_kws<span class="op">=</span>{<span class="st">"shrink"</span>: <span class="fl">0.8</span>},</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>               vmin<span class="op">=-</span><span class="dv">1</span>, vmax<span class="op">=</span><span class="dv">1</span>, ax<span class="op">=</span>ax)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    im <span class="op">=</span> ax.imshow(corr_matrix.values, cmap<span class="op">=</span><span class="st">'RdBu_r'</span>, vmin<span class="op">=-</span><span class="dv">1</span>, vmax<span class="op">=</span><span class="dv">1</span>, aspect<span class="op">=</span><span class="st">'auto'</span>)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    ax.set_xticks(<span class="bu">range</span>(<span class="bu">len</span>(corr_matrix.columns)))</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    ax.set_yticks(<span class="bu">range</span>(<span class="bu">len</span>(corr_matrix.index)))</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    ax.set_xticklabels(corr_matrix.columns)</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    ax.set_yticklabels(corr_matrix.index)</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(corr_matrix.index)):</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(corr_matrix.columns)):</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>            ax.text(j, i, <span class="ss">f'</span><span class="sc">{</span>corr_matrix<span class="sc">.</span>iloc[i, j]<span class="sc">:.3f}</span><span class="ss">'</span>, </span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>                   ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'center'</span>, color<span class="op">=</span><span class="st">'black'</span> <span class="cf">if</span> <span class="bu">abs</span>(corr_matrix.iloc[i, j]) <span class="op">&lt;</span> <span class="fl">0.5</span> <span class="cf">else</span> <span class="st">'white'</span>)</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    plt.colorbar(im, ax<span class="op">=</span>ax, shrink<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Climate Variables Correlation Matrix'</span>, </span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>             fontsize<span class="op">=</span><span class="dv">13</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, pad<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Correlation Matrix:"</span>)</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(corr_matrix)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="event-typology-clustering-extreme-events" class="level2">
<h2 data-anchor-id="event-typology-clustering-extreme-events">Event Typology: Clustering Extreme Events</h2>
<p>Not all extreme events are the same. Hierarchical clustering groups events by their multi-variable signatures, revealing distinct “types” of extremes. One cluster might represent “dry heatwaves” (high temperature, low precipitation, high pressure), while another represents “humid heatwaves” (high temperature, high precipitation, low pressure).</p>
<p>This typology matters because different event types have different impacts. A dry heatwave increases wildfire risk and water stress. A humid heatwave increases heat stress on humans (reduced evaporative cooling) and can trigger convective storms. The clustering analysis transforms a collection of individual events into a taxonomy of risk scenarios.</p>
<p>The cluster characteristics plot shows the mean conditions for each event type. Notice how clusters differ not just in temperature, but in the full multi-variable space. This is the power of multivariate analysis: it captures patterns that univariate methods miss.</p>
<div id="3531f56d" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cluster extreme temperature events</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>climate_data <span class="op">=</span> cluster_extreme_events(</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    climate_data,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    n_clusters<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    variables<span class="op">=</span>[<span class="st">'temperature_c'</span>, <span class="st">'precipitation_mm'</span>, <span class="st">'pressure_hpa'</span>]</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize clustered extreme events</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">10</span>), sharex<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Temperature with cluster colors</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> axes[<span class="dv">0</span>]</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>scatter <span class="op">=</span> ax1.scatter(climate_data[<span class="st">'datetime_utc'</span>], climate_data[<span class="st">'temperature_c'</span>],</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>                     c<span class="op">=</span>climate_data[<span class="st">'extreme_cluster'</span>], cmap<span class="op">=</span><span class="st">'Set1'</span>, </span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>                     s<span class="op">=</span><span class="dv">20</span>, alpha<span class="op">=</span><span class="fl">0.6</span>, edgecolors<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>extreme_mask <span class="op">=</span> climate_data[<span class="st">'is_extreme'</span>]</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>ax1.scatter(climate_data[extreme_mask][<span class="st">'datetime_utc'</span>],</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>           climate_data[extreme_mask][<span class="st">'temperature_c'</span>],</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>           c<span class="op">=</span>climate_data[extreme_mask][<span class="st">'extreme_cluster'</span>], cmap<span class="op">=</span><span class="st">'Set1'</span>,</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>           s<span class="op">=</span><span class="dv">100</span>, alpha<span class="op">=</span><span class="fl">0.9</span>, edgecolors<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>, </span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>           marker<span class="op">=</span><span class="st">'*'</span>, zorder<span class="op">=</span><span class="dv">5</span>, label<span class="op">=</span><span class="st">'Extreme Events'</span>)</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'Temperature (°C)'</span>, fontsize<span class="op">=</span><span class="dv">11</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">'Temperature Time Series with Clustered Extreme Events'</span>, </span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>              fontsize<span class="op">=</span><span class="dv">13</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, pad<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>cbar <span class="op">=</span> plt.colorbar(scatter, ax<span class="op">=</span>ax1)</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>cbar.set_label(<span class="st">'Cluster ID'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>ax1.legend(loc<span class="op">=</span><span class="st">'upper left'</span>, fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>ax1.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Cluster characteristics</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> axes[<span class="dv">1</span>]</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>cluster_stats <span class="op">=</span> climate_data[climate_data[<span class="st">'extreme_cluster'</span>] <span class="op">&gt;</span> <span class="dv">0</span>].groupby(<span class="st">'extreme_cluster'</span>).agg({</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">'temperature_c'</span>: <span class="st">'mean'</span>,</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>    <span class="st">'precipitation_mm'</span>: <span class="st">'mean'</span>,</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>    <span class="st">'pressure_hpa'</span>: <span class="st">'mean'</span>,</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>    <span class="st">'extreme_intensity'</span>: <span class="st">'mean'</span>,</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>}).reset_index()</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>x_pos <span class="op">=</span> np.arange(<span class="bu">len</span>(cluster_stats))</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>width <span class="op">=</span> <span class="fl">0.35</span></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>ax2.bar(x_pos <span class="op">-</span> width<span class="op">/</span><span class="dv">2</span>, cluster_stats[<span class="st">'temperature_c'</span>], width, </span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>       label<span class="op">=</span><span class="st">'Temperature'</span>, color<span class="op">=</span><span class="st">'#e74c3c'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>ax2_twin <span class="op">=</span> ax2.twinx()</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>ax2_twin.bar(x_pos <span class="op">+</span> width<span class="op">/</span><span class="dv">2</span>, cluster_stats[<span class="st">'precipitation_mm'</span>], width,</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>            label<span class="op">=</span><span class="st">'Precipitation'</span>, color<span class="op">=</span><span class="st">'#3498db'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>ax2.set_xlabel(<span class="st">'Cluster ID'</span>, fontsize<span class="op">=</span><span class="dv">11</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'Temperature (°C)'</span>, fontsize<span class="op">=</span><span class="dv">11</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, color<span class="op">=</span><span class="st">'#e74c3c'</span>)</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>ax2_twin.set_ylabel(<span class="st">'Precipitation (mm)'</span>, fontsize<span class="op">=</span><span class="dv">11</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, color<span class="op">=</span><span class="st">'#3498db'</span>)</span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">'Cluster Characteristics: Mean Values by Cluster'</span>, </span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>              fontsize<span class="op">=</span><span class="dv">13</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, pad<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>ax2.set_xticks(x_pos)</span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>ax2.set_xticklabels(cluster_stats[<span class="st">'extreme_cluster'</span>])</span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>ax2.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, axis<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Cluster Statistics:"</span>)</span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(cluster_stats.to_string(index<span class="op">=</span><span class="va">False</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="intensity-distribution-the-shape-of-extremes" class="level2">
<h2 data-anchor-id="intensity-distribution-the-shape-of-extremes">Intensity Distribution: The Shape of Extremes</h2>
<p>The distribution of extreme event intensities reveals something important: extremes themselves have structure. They’re not uniformly distributed—there are “moderate extremes” and “extreme extremes.” The histogram shows a right-skewed distribution, meaning most extreme events are relatively mild (just above the threshold), while truly catastrophic events are rare.</p>
<p>The box plots by cluster show that different event types have different intensity distributions. Some clusters have tight distributions (consistent intensity), while others are highly variable. This heterogeneity matters for risk assessment: if you’re planning for the “typical extreme,” you’ll be underprepared for the tail events.</p>
<p>The median being lower than the mean indicates positive skew—the distribution has a long right tail. This is characteristic of extreme value distributions and reflects the physics: there’s a lower bound (you can’t have negative heat), but no upper bound (temperatures can theoretically get arbitrarily high, though practically limited by energy balance).</p>
<div id="c061abc9" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Analyze distribution of extreme event intensities</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>extreme_events <span class="op">=</span> climate_data[climate_data[<span class="st">'is_extreme'</span>]].copy()</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">5</span>))</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Histogram of extreme intensities</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> axes[<span class="dv">0</span>]</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>ax1.hist(extreme_events[<span class="st">'extreme_intensity'</span>], bins<span class="op">=</span><span class="dv">30</span>, color<span class="op">=</span><span class="st">'#e74c3c'</span>, </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>        alpha<span class="op">=</span><span class="fl">0.7</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="fl">1.2</span>)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>ax1.axvline(extreme_events[<span class="st">'extreme_intensity'</span>].mean(), </span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>           color<span class="op">=</span><span class="st">'#c0392b'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, </span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>           label<span class="op">=</span><span class="ss">f"Mean: </span><span class="sc">{</span>extreme_events[<span class="st">'extreme_intensity'</span>]<span class="sc">.</span>mean()<span class="sc">:.2f}</span><span class="ss">°C"</span>)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>ax1.axvline(extreme_events[<span class="st">'extreme_intensity'</span>].median(), </span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>           color<span class="op">=</span><span class="st">'#8e44ad'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, linewidth<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>           label<span class="op">=</span><span class="ss">f"Median: </span><span class="sc">{</span>extreme_events[<span class="st">'extreme_intensity'</span>]<span class="sc">.</span>median()<span class="sc">:.2f}</span><span class="ss">°C"</span>)</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'Extreme Intensity (°C above threshold)'</span>, fontsize<span class="op">=</span><span class="dv">11</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'Frequency'</span>, fontsize<span class="op">=</span><span class="dv">11</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">'Distribution of Extreme Event Intensities'</span>, </span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>              fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>ax1.legend(fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>ax1.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, axis<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Box plot by cluster</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> axes[<span class="dv">1</span>]</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Get unique cluster IDs (excluding 0) and filter out empty clusters</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>unique_clusters <span class="op">=</span> <span class="bu">sorted</span>([i <span class="cf">for</span> i <span class="kw">in</span> extreme_events[<span class="st">'extreme_cluster'</span>].unique() <span class="cf">if</span> i <span class="op">&gt;</span> <span class="dv">0</span>])</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>cluster_data <span class="op">=</span> []</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>cluster_labels <span class="op">=</span> []</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> unique_clusters:</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> extreme_events[extreme_events[<span class="st">'extreme_cluster'</span>] <span class="op">==</span> i][<span class="st">'extreme_intensity'</span>].values</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(data) <span class="op">&gt;</span> <span class="dv">0</span>:  <span class="co"># Only include clusters with data</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>        cluster_data.append(data)</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>        cluster_labels.append(<span class="bu">str</span>(i))</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Only plot if we have data</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">len</span>(cluster_data) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>    bp <span class="op">=</span> ax2.boxplot(cluster_data, labels<span class="op">=</span>cluster_labels,</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>                    patch_artist<span class="op">=</span><span class="va">True</span>, showmeans<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> patch <span class="kw">in</span> bp[<span class="st">'boxes'</span>]:</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>        patch.set_facecolor(<span class="st">'#e74c3c'</span>)</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>        patch.set_alpha(<span class="fl">0.7</span>)</span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>    ax2.text(<span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="st">'No cluster data available'</span>, </span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>            ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'center'</span>, transform<span class="op">=</span>ax2.transAxes)</span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>ax2.set_xlabel(<span class="st">'Cluster ID'</span>, fontsize<span class="op">=</span><span class="dv">11</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'Extreme Intensity (°C above threshold)'</span>, fontsize<span class="op">=</span><span class="dv">11</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">'Extreme Intensity Distribution by Cluster'</span>, </span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>              fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>ax2.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, axis<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Extreme Event Intensity Statistics:"</span>)</span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(extreme_events[<span class="st">'extreme_intensity'</span>].describe())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="synthesis-what-the-numbers-tell-us" class="level2">
<h2 data-anchor-id="synthesis-what-the-numbers-tell-us">Synthesis: What the Numbers Tell Us</h2>
<p>The summary statistics aggregate the analysis into digestible metrics, but the real insights come from understanding how these pieces fit together. The return period analysis tells us about rarity. The clustering tells us about diversity. The correlation structure tells us about co-occurrence. Together, they paint a picture of a climate system where extremes are:</p>
<ol type="1">
<li><strong>Rare but not random</strong>: They follow statistical distributions that can be modeled</li>
<li><strong>Diverse in type</strong>: Not all extremes are the same—different event types have different impacts</li>
<li><strong>Correlated in space and time</strong>: Variables move together, creating compound risks</li>
<li><strong>Heterogeneous in intensity</strong>: Most extremes are moderate; catastrophic events are exponentially rarer</li>
</ol>
<p>This framework is the foundation for climate risk assessment. It transforms raw data into actionable intelligence: understanding not just what happened, but what could happen, how often, and in what combinations.</p>
<div id="89244426" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate comprehensive summary</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"CLIMATE EXTREMES ANALYSIS SUMMARY"</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">📊 Dataset Overview:"</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   Period: </span><span class="sc">{</span>climate_data[<span class="st">'datetime_utc'</span>]<span class="sc">.</span><span class="bu">min</span>()<span class="sc">.</span>date()<span class="sc">}</span><span class="ss"> to </span><span class="sc">{</span>climate_data[<span class="st">'datetime_utc'</span>]<span class="sc">.</span><span class="bu">max</span>()<span class="sc">.</span>date()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   Total days: </span><span class="sc">{</span><span class="bu">len</span>(climate_data)<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   Variables: Temperature, Precipitation, Pressure"</span>)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">🌡️  Temperature Extremes:"</span>)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   Total extreme events: </span><span class="sc">{</span>temp_stats[<span class="st">'n_events'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   Extreme days: </span><span class="sc">{</span>temp_stats[<span class="st">'total_days'</span>]<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span><span class="dv">100</span><span class="op">*</span>temp_stats[<span class="st">'total_days'</span>]<span class="op">/</span><span class="bu">len</span>(climate_data)<span class="sc">:.2f}</span><span class="ss">% of period)"</span>)</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   Mean intensity: </span><span class="sc">{</span>temp_stats[<span class="st">'mean_intensity'</span>]<span class="sc">:.2f}</span><span class="ss">°C above 95th percentile"</span>)</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   Maximum intensity: </span><span class="sc">{</span>temp_stats[<span class="st">'max_intensity'</span>]<span class="sc">:.2f}</span><span class="ss">°C above threshold"</span>)</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   Mean duration: </span><span class="sc">{</span>temp_stats[<span class="st">'mean_duration'</span>]<span class="sc">:.1f}</span><span class="ss"> days per event"</span>)</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">🌧️  Precipitation Extremes:"</span>)</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   Total extreme events: </span><span class="sc">{</span>precip_stats[<span class="st">'n_events'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   Extreme days: </span><span class="sc">{</span>precip_stats[<span class="st">'total_days'</span>]<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span><span class="dv">100</span><span class="op">*</span>precip_stats[<span class="st">'total_days'</span>]<span class="op">/</span><span class="bu">len</span>(climate_data)<span class="sc">:.2f}</span><span class="ss">% of period)"</span>)</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   Mean intensity: </span><span class="sc">{</span>precip_stats[<span class="st">'mean_intensity'</span>]<span class="sc">:.2f}</span><span class="ss"> mm above 95th percentile"</span>)</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   Maximum intensity: </span><span class="sc">{</span>precip_stats[<span class="st">'max_intensity'</span>]<span class="sc">:.2f}</span><span class="ss"> mm above threshold"</span>)</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">📈 Return Period Analysis:"</span>)</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   100-year return temperature: </span><span class="sc">{</span>return_periods_temp[return_periods_temp[<span class="st">'return_period_years'</span>]<span class="op">==</span><span class="dv">100</span>][<span class="st">'return_value'</span>]<span class="sc">.</span>values[<span class="dv">0</span>]<span class="sc">:.2f}</span><span class="ss">°C"</span>)</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   100-year return precipitation: </span><span class="sc">{</span>return_periods_precip[return_periods_precip[<span class="st">'return_period_years'</span>]<span class="op">==</span><span class="dv">100</span>][<span class="st">'return_value'</span>]<span class="sc">.</span>values[<span class="dv">0</span>]<span class="sc">:.2f}</span><span class="ss"> mm"</span>)</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">🔗 Variable Correlations:"</span>)</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   Temperature-Precipitation: </span><span class="sc">{</span>corr_matrix<span class="sc">.</span>loc[<span class="st">'temperature_c'</span>, <span class="st">'precipitation_mm'</span>]<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   Temperature-Pressure: </span><span class="sc">{</span>corr_matrix<span class="sc">.</span>loc[<span class="st">'temperature_c'</span>, <span class="st">'pressure_hpa'</span>]<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   Precipitation-Pressure: </span><span class="sc">{</span>corr_matrix<span class="sc">.</span>loc[<span class="st">'precipitation_mm'</span>, <span class="st">'pressure_hpa'</span>]<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">🎯 Extreme Event Clusters:"</span>)</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   Number of clusters: </span><span class="sc">{</span>climate_data[<span class="st">'extreme_cluster'</span>]<span class="sc">.</span><span class="bu">max</span>()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> cluster_id <span class="kw">in</span> <span class="bu">sorted</span>(cluster_stats[<span class="st">'extreme_cluster'</span>]):</span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>    cluster_data <span class="op">=</span> climate_data[climate_data[<span class="st">'extreme_cluster'</span>] <span class="op">==</span> cluster_id]</span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   Cluster </span><span class="sc">{</span>cluster_id<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="bu">len</span>(cluster_data)<span class="sc">}</span><span class="ss"> events, "</span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>          <span class="ss">f"mean temp </span><span class="sc">{</span>cluster_stats[cluster_stats[<span class="st">'extreme_cluster'</span>]<span class="op">==</span>cluster_id][<span class="st">'temperature_c'</span>]<span class="sc">.</span>values[<span class="dv">0</span>]<span class="sc">:.1f}</span><span class="ss">°C"</span>)</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<hr>
</section>
<section id="note" class="level2">
<h2 data-anchor-id="note">Note</h2>
<p>This analysis uses synthetic climate data for demonstration. In production, this framework can be applied to real ERA5 reanalysis data or observational climate datasets. The methods shown here—extreme value theory, return period analysis, and event clustering—are standard approaches in climate risk assessment.</p>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/recurrentanalytics\.com");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Climate Extremes Explorer"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> 2025-12-15</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span><span class="co"> [climate, extremes, analysis, visualization]</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> "Comprehensive interactive analysis of climate extremes using synthetic climate data. Demonstrates methods for identifying, analyzing, and visualizing extreme climate events including heatwaves, cold snaps, and extreme precipitation. Features return period analysis, event clustering, and multi-variable correlation analysis."</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co">  echo: true</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co">  warning: false</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co">  message: false</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="an">freeze:</span><span class="co"> auto</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="fu">## Overview</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>Extreme climate events—heatwaves, cold snaps, extreme precipitation—are not anomalies to be dismissed as outliers. They are the signal. Understanding their frequency, intensity, and co-occurrence patterns is fundamental to climate risk assessment. This analysis applies extreme value theory and multivariate statistics to extract structure from what appears chaotic.</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>The framework demonstrates:</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Extreme Event Identification** - Multiple methods (percentile, absolute, anomaly)</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Return Period Analysis** - Extreme value theory (Block Maxima, Peaks Over Threshold)</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Multi-Variable Correlation** - Relationships between climate variables</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Event Clustering** - Hierarchical clustering of extreme events</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Statistical Analysis** - Comprehensive extreme event statistics</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a><span class="fu">## Building the Foundation: Synthetic Climate Data</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>Before we can identify extremes, we need a baseline. Synthetic data generation here serves two purposes: it provides a controlled environment to test methods, and it demonstrates how realistic climate variability can emerge from relatively simple stochastic processes. The data spans 24 years (2000-2023) with daily resolution, capturing temperature, precipitation, and atmospheric pressure—three variables that interact in complex ways.</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>The synthetic generation incorporates:</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Seasonal cycles** (annual temperature variation, precipitation patterns)</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Inter-annual variability** (year-to-year fluctuations)</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Cross-variable dependencies** (temperature-precipitation relationships)</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Autocorrelation** (weather persistence over days)</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>This isn't "fake data" in the pejorative sense—it's a generative model that captures the statistical structure of real climate systems. When we later identify extremes, we're finding events that would be rare under this baseline distribution.</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a><span class="fu">### Generate and Load Climate Data</span></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>    HAS_SEABORN <span class="op">=</span> <span class="va">True</span></span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">ImportError</span>:</span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>    HAS_SEABORN <span class="op">=</span> <span class="va">False</span></span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Note: seaborn not available, using matplotlib for heatmap"</span>)</span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> src.climate_extremes <span class="im">import</span> (</span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>    generate_synthetic_climate_data,</span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>    identify_extremes,</span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>    compute_return_periods,</span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a>    analyze_correlations,</span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a>    cluster_extreme_events,</span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a>    compute_extreme_statistics,</span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate synthetic climate data (2000-2023, daily)</span></span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Generating synthetic climate data..."</span>)</span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a>climate_data <span class="op">=</span> generate_synthetic_climate_data(</span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a>    start_date<span class="op">=</span><span class="st">"2000-01-01"</span>,</span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a>    end_date<span class="op">=</span><span class="st">"2023-12-31"</span>,</span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a>    freq<span class="op">=</span><span class="st">"D"</span>,</span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a>    seed<span class="op">=</span><span class="dv">42</span></span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Data shape: </span><span class="sc">{</span>climate_data<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Date range: </span><span class="sc">{</span>climate_data[<span class="st">'datetime_utc'</span>]<span class="sc">.</span><span class="bu">min</span>()<span class="sc">}</span><span class="ss"> to </span><span class="sc">{</span>climate_data[<span class="st">'datetime_utc'</span>]<span class="sc">.</span><span class="bu">max</span>()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">First few rows:"</span>)</span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(climate_data.head())</span>
<span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Summary statistics:"</span>)</span>
<span id="cb9-76"><a href="#cb9-76" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(climate_data[[<span class="st">'temperature_c'</span>, <span class="st">'precipitation_mm'</span>, <span class="st">'pressure_hpa'</span>]].describe())</span>
<span id="cb9-77"><a href="#cb9-77" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-78"><a href="#cb9-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-79"><a href="#cb9-79" aria-hidden="true" tabindex="-1"></a><span class="fu">## Defining the Extreme: Operational Thresholds</span></span>
<span id="cb9-80"><a href="#cb9-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-81"><a href="#cb9-81" aria-hidden="true" tabindex="-1"></a>What counts as "extreme" is not a question with a single answer. It's a modeling choice with real consequences. We use the 95th percentile threshold—meaning 5% of days exceed this value—but this is arbitrary. A heatwave that's extreme in one region might be normal in another. A 3-day minimum duration filters out single-day spikes, focusing on sustained events that have greater impact.</span>
<span id="cb9-82"><a href="#cb9-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-83"><a href="#cb9-83" aria-hidden="true" tabindex="-1"></a>The choice of method matters:</span>
<span id="cb9-84"><a href="#cb9-84" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Percentile-based**: Relative to the local distribution (adapts to regional climate)</span>
<span id="cb9-85"><a href="#cb9-85" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Absolute thresholds**: Fixed values (e.g., 30°C) that ignore local context</span>
<span id="cb9-86"><a href="#cb9-86" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Anomaly-based**: Deviations from expected seasonal patterns</span>
<span id="cb9-87"><a href="#cb9-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-88"><a href="#cb9-88" aria-hidden="true" tabindex="-1"></a>Here, we use percentile thresholds because they're scale-invariant and adapt to the data's inherent variability. A 95th percentile heatwave in a temperate region might be 28°C, while in a desert it might be 42°C—both are equally "extreme" relative to their contexts.</span>
<span id="cb9-89"><a href="#cb9-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-90"><a href="#cb9-90" aria-hidden="true" tabindex="-1"></a><span class="fu">### Identify Extreme Events</span></span>
<span id="cb9-91"><a href="#cb9-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-94"><a href="#cb9-94" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb9-95"><a href="#cb9-95" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify extreme temperature events (95th percentile, minimum 3 consecutive days)</span></span>
<span id="cb9-96"><a href="#cb9-96" aria-hidden="true" tabindex="-1"></a>climate_data <span class="op">=</span> identify_extremes(</span>
<span id="cb9-97"><a href="#cb9-97" aria-hidden="true" tabindex="-1"></a>    climate_data,</span>
<span id="cb9-98"><a href="#cb9-98" aria-hidden="true" tabindex="-1"></a>    variable<span class="op">=</span><span class="st">'temperature_c'</span>,</span>
<span id="cb9-99"><a href="#cb9-99" aria-hidden="true" tabindex="-1"></a>    method<span class="op">=</span><span class="st">'percentile'</span>,</span>
<span id="cb9-100"><a href="#cb9-100" aria-hidden="true" tabindex="-1"></a>    threshold<span class="op">=</span><span class="fl">95.0</span>,</span>
<span id="cb9-101"><a href="#cb9-101" aria-hidden="true" tabindex="-1"></a>    min_duration<span class="op">=</span><span class="dv">3</span></span>
<span id="cb9-102"><a href="#cb9-102" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-103"><a href="#cb9-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-104"><a href="#cb9-104" aria-hidden="true" tabindex="-1"></a><span class="co"># Also identify extreme precipitation events</span></span>
<span id="cb9-105"><a href="#cb9-105" aria-hidden="true" tabindex="-1"></a>climate_data <span class="op">=</span> identify_extremes(</span>
<span id="cb9-106"><a href="#cb9-106" aria-hidden="true" tabindex="-1"></a>    climate_data,</span>
<span id="cb9-107"><a href="#cb9-107" aria-hidden="true" tabindex="-1"></a>    variable<span class="op">=</span><span class="st">'precipitation_mm'</span>,</span>
<span id="cb9-108"><a href="#cb9-108" aria-hidden="true" tabindex="-1"></a>    method<span class="op">=</span><span class="st">'percentile'</span>,</span>
<span id="cb9-109"><a href="#cb9-109" aria-hidden="true" tabindex="-1"></a>    threshold<span class="op">=</span><span class="fl">95.0</span>,</span>
<span id="cb9-110"><a href="#cb9-110" aria-hidden="true" tabindex="-1"></a>    min_duration<span class="op">=</span><span class="dv">1</span></span>
<span id="cb9-111"><a href="#cb9-111" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-112"><a href="#cb9-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-113"><a href="#cb9-113" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute statistics</span></span>
<span id="cb9-114"><a href="#cb9-114" aria-hidden="true" tabindex="-1"></a>temp_stats <span class="op">=</span> compute_extreme_statistics(climate_data, <span class="st">'temperature_c'</span>)</span>
<span id="cb9-115"><a href="#cb9-115" aria-hidden="true" tabindex="-1"></a>precip_stats <span class="op">=</span> compute_extreme_statistics(climate_data, <span class="st">'precipitation_mm'</span>)</span>
<span id="cb9-116"><a href="#cb9-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-117"><a href="#cb9-117" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Temperature Extreme Events:"</span>)</span>
<span id="cb9-118"><a href="#cb9-118" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Number of events: </span><span class="sc">{</span>temp_stats[<span class="st">'n_events'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb9-119"><a href="#cb9-119" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Total extreme days: </span><span class="sc">{</span>temp_stats[<span class="st">'total_days'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb9-120"><a href="#cb9-120" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Mean intensity: </span><span class="sc">{</span>temp_stats[<span class="st">'mean_intensity'</span>]<span class="sc">:.2f}</span><span class="ss">°C above threshold"</span>)</span>
<span id="cb9-121"><a href="#cb9-121" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Maximum intensity: </span><span class="sc">{</span>temp_stats[<span class="st">'max_intensity'</span>]<span class="sc">:.2f}</span><span class="ss">°C above threshold"</span>)</span>
<span id="cb9-122"><a href="#cb9-122" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Mean duration: </span><span class="sc">{</span>temp_stats[<span class="st">'mean_duration'</span>]<span class="sc">:.1f}</span><span class="ss"> days"</span>)</span>
<span id="cb9-123"><a href="#cb9-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-124"><a href="#cb9-124" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Precipitation Extreme Events:"</span>)</span>
<span id="cb9-125"><a href="#cb9-125" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Number of events: </span><span class="sc">{</span>precip_stats[<span class="st">'n_events'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb9-126"><a href="#cb9-126" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Total extreme days: </span><span class="sc">{</span>precip_stats[<span class="st">'total_days'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb9-127"><a href="#cb9-127" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Mean intensity: </span><span class="sc">{</span>precip_stats[<span class="st">'mean_intensity'</span>]<span class="sc">:.2f}</span><span class="ss"> mm above threshold"</span>)</span>
<span id="cb9-128"><a href="#cb9-128" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Maximum intensity: </span><span class="sc">{</span>precip_stats[<span class="st">'max_intensity'</span>]<span class="sc">:.2f}</span><span class="ss"> mm above threshold"</span>)</span>
<span id="cb9-129"><a href="#cb9-129" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-130"><a href="#cb9-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-131"><a href="#cb9-131" aria-hidden="true" tabindex="-1"></a><span class="fu">## Temporal Patterns: When Extremes Occur</span></span>
<span id="cb9-132"><a href="#cb9-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-133"><a href="#cb9-133" aria-hidden="true" tabindex="-1"></a>The timeline visualization reveals something crucial: extreme events are not uniformly distributed. They cluster in time, creating periods of elevated risk. The temperature extremes show clear seasonal patterns—heatwaves in summer, cold snaps in winter—but also reveal inter-annual variability. Some years are quiet; others are punctuated by multiple extreme events.</span>
<span id="cb9-134"><a href="#cb9-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-135"><a href="#cb9-135" aria-hidden="true" tabindex="-1"></a>This temporal clustering has implications for risk assessment. If extremes were independent random events, we could model them with simple Poisson processes. But they're not. They exhibit persistence (heatwaves last multiple days) and clustering (extreme years contain multiple extreme events). This means risk is not constant—it's time-varying and state-dependent.</span>
<span id="cb9-136"><a href="#cb9-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-137"><a href="#cb9-137" aria-hidden="true" tabindex="-1"></a>The visualization also shows the relationship between variables. Notice how extreme precipitation events sometimes coincide with temperature extremes (convective storms during heatwaves), and sometimes don't (frontal systems during cooler periods). This co-occurrence—or lack thereof—matters for compound risk assessment.</span>
<span id="cb9-138"><a href="#cb9-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-141"><a href="#cb9-141" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb9-142"><a href="#cb9-142" aria-hidden="true" tabindex="-1"></a><span class="co"># Create timeline visualization with extreme events highlighted</span></span>
<span id="cb9-143"><a href="#cb9-143" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">3</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">10</span>), sharex<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb9-144"><a href="#cb9-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-145"><a href="#cb9-145" aria-hidden="true" tabindex="-1"></a><span class="co"># Temperature with extreme events</span></span>
<span id="cb9-146"><a href="#cb9-146" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> axes[<span class="dv">0</span>]</span>
<span id="cb9-147"><a href="#cb9-147" aria-hidden="true" tabindex="-1"></a>ax1.plot(climate_data[<span class="st">'datetime_utc'</span>], climate_data[<span class="st">'temperature_c'</span>], </span>
<span id="cb9-148"><a href="#cb9-148" aria-hidden="true" tabindex="-1"></a>         color<span class="op">=</span><span class="st">'#2c3e50'</span>, alpha<span class="op">=</span><span class="fl">0.6</span>, linewidth<span class="op">=</span><span class="fl">0.8</span>, label<span class="op">=</span><span class="st">'Temperature'</span>)</span>
<span id="cb9-149"><a href="#cb9-149" aria-hidden="true" tabindex="-1"></a>ax1.scatter(climate_data[climate_data[<span class="st">'is_extreme'</span>]][<span class="st">'datetime_utc'</span>],</span>
<span id="cb9-150"><a href="#cb9-150" aria-hidden="true" tabindex="-1"></a>           climate_data[climate_data[<span class="st">'is_extreme'</span>]][<span class="st">'temperature_c'</span>],</span>
<span id="cb9-151"><a href="#cb9-151" aria-hidden="true" tabindex="-1"></a>           c<span class="op">=</span><span class="st">'#e74c3c'</span>, s<span class="op">=</span><span class="dv">30</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, label<span class="op">=</span><span class="st">'Extreme Events'</span>, zorder<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb9-152"><a href="#cb9-152" aria-hidden="true" tabindex="-1"></a>ax1.axhline(y<span class="op">=</span>np.percentile(climate_data[<span class="st">'temperature_c'</span>], <span class="dv">95</span>), </span>
<span id="cb9-153"><a href="#cb9-153" aria-hidden="true" tabindex="-1"></a>           color<span class="op">=</span><span class="st">'#c0392b'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, label<span class="op">=</span><span class="st">'95th Percentile'</span>)</span>
<span id="cb9-154"><a href="#cb9-154" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'Temperature (°C)'</span>, fontsize<span class="op">=</span><span class="dv">11</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb9-155"><a href="#cb9-155" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">'Temperature Time Series with Extreme Events Highlighted'</span>, </span>
<span id="cb9-156"><a href="#cb9-156" aria-hidden="true" tabindex="-1"></a>              fontsize<span class="op">=</span><span class="dv">13</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, pad<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb9-157"><a href="#cb9-157" aria-hidden="true" tabindex="-1"></a>ax1.legend(loc<span class="op">=</span><span class="st">'upper left'</span>, fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb9-158"><a href="#cb9-158" aria-hidden="true" tabindex="-1"></a>ax1.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb9-159"><a href="#cb9-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-160"><a href="#cb9-160" aria-hidden="true" tabindex="-1"></a><span class="co"># Precipitation with extreme events</span></span>
<span id="cb9-161"><a href="#cb9-161" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> axes[<span class="dv">1</span>]</span>
<span id="cb9-162"><a href="#cb9-162" aria-hidden="true" tabindex="-1"></a>ax2.plot(climate_data[<span class="st">'datetime_utc'</span>], climate_data[<span class="st">'precipitation_mm'</span>], </span>
<span id="cb9-163"><a href="#cb9-163" aria-hidden="true" tabindex="-1"></a>         color<span class="op">=</span><span class="st">'#3498db'</span>, alpha<span class="op">=</span><span class="fl">0.6</span>, linewidth<span class="op">=</span><span class="fl">0.8</span>, label<span class="op">=</span><span class="st">'Precipitation'</span>)</span>
<span id="cb9-164"><a href="#cb9-164" aria-hidden="true" tabindex="-1"></a>precip_extremes <span class="op">=</span> climate_data[climate_data[<span class="st">'precipitation_mm'</span>] <span class="op">&gt;=</span> </span>
<span id="cb9-165"><a href="#cb9-165" aria-hidden="true" tabindex="-1"></a>                               np.percentile(climate_data[<span class="st">'precipitation_mm'</span>], <span class="dv">95</span>)]</span>
<span id="cb9-166"><a href="#cb9-166" aria-hidden="true" tabindex="-1"></a>ax2.scatter(precip_extremes[<span class="st">'datetime_utc'</span>], precip_extremes[<span class="st">'precipitation_mm'</span>],</span>
<span id="cb9-167"><a href="#cb9-167" aria-hidden="true" tabindex="-1"></a>           c<span class="op">=</span><span class="st">'#2980b9'</span>, s<span class="op">=</span><span class="dv">30</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, label<span class="op">=</span><span class="st">'Extreme Events'</span>, zorder<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb9-168"><a href="#cb9-168" aria-hidden="true" tabindex="-1"></a>ax2.axhline(y<span class="op">=</span>np.percentile(climate_data[<span class="st">'precipitation_mm'</span>], <span class="dv">95</span>), </span>
<span id="cb9-169"><a href="#cb9-169" aria-hidden="true" tabindex="-1"></a>           color<span class="op">=</span><span class="st">'#21618c'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, label<span class="op">=</span><span class="st">'95th Percentile'</span>)</span>
<span id="cb9-170"><a href="#cb9-170" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'Precipitation (mm)'</span>, fontsize<span class="op">=</span><span class="dv">11</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb9-171"><a href="#cb9-171" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">'Precipitation Time Series with Extreme Events Highlighted'</span>, </span>
<span id="cb9-172"><a href="#cb9-172" aria-hidden="true" tabindex="-1"></a>              fontsize<span class="op">=</span><span class="dv">13</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, pad<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb9-173"><a href="#cb9-173" aria-hidden="true" tabindex="-1"></a>ax2.legend(loc<span class="op">=</span><span class="st">'upper left'</span>, fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb9-174"><a href="#cb9-174" aria-hidden="true" tabindex="-1"></a>ax2.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb9-175"><a href="#cb9-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-176"><a href="#cb9-176" aria-hidden="true" tabindex="-1"></a><span class="co"># Pressure</span></span>
<span id="cb9-177"><a href="#cb9-177" aria-hidden="true" tabindex="-1"></a>ax3 <span class="op">=</span> axes[<span class="dv">2</span>]</span>
<span id="cb9-178"><a href="#cb9-178" aria-hidden="true" tabindex="-1"></a>ax3.plot(climate_data[<span class="st">'datetime_utc'</span>], climate_data[<span class="st">'pressure_hpa'</span>], </span>
<span id="cb9-179"><a href="#cb9-179" aria-hidden="true" tabindex="-1"></a>         color<span class="op">=</span><span class="st">'#7f8c8d'</span>, alpha<span class="op">=</span><span class="fl">0.6</span>, linewidth<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb9-180"><a href="#cb9-180" aria-hidden="true" tabindex="-1"></a>ax3.set_ylabel(<span class="st">'Pressure (hPa)'</span>, fontsize<span class="op">=</span><span class="dv">11</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb9-181"><a href="#cb9-181" aria-hidden="true" tabindex="-1"></a>ax3.set_xlabel(<span class="st">'Date'</span>, fontsize<span class="op">=</span><span class="dv">11</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb9-182"><a href="#cb9-182" aria-hidden="true" tabindex="-1"></a>ax3.set_title(<span class="st">'Atmospheric Pressure Time Series'</span>, </span>
<span id="cb9-183"><a href="#cb9-183" aria-hidden="true" tabindex="-1"></a>              fontsize<span class="op">=</span><span class="dv">13</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, pad<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb9-184"><a href="#cb9-184" aria-hidden="true" tabindex="-1"></a>ax3.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb9-185"><a href="#cb9-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-186"><a href="#cb9-186" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb9-187"><a href="#cb9-187" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb9-188"><a href="#cb9-188" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-189"><a href="#cb9-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-190"><a href="#cb9-190" aria-hidden="true" tabindex="-1"></a><span class="fu">## Return Periods: Quantifying Rarity</span></span>
<span id="cb9-191"><a href="#cb9-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-192"><a href="#cb9-192" aria-hidden="true" tabindex="-1"></a>Return period analysis answers a deceptively simple question: "How often should we expect an event of this magnitude?" A 100-year return period doesn't mean it happens exactly once per century—it means the annual probability is 1%. Over a 100-year period, there's a 63% chance of experiencing at least one such event (due to the compounding of probabilities).</span>
<span id="cb9-193"><a href="#cb9-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-194"><a href="#cb9-194" aria-hidden="true" tabindex="-1"></a>The two methods shown here capture different aspects of extremes:</span>
<span id="cb9-195"><a href="#cb9-195" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Block Maxima (Annual Maxima)**: Takes the maximum value each year, fits a Generalized Extreme Value (GEV) distribution. Good for understanding the worst-case scenario in any given year.</span>
<span id="cb9-196"><a href="#cb9-196" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Peaks Over Threshold**: Identifies all values above a threshold, fits a Generalized Pareto Distribution (GPD). More data-efficient, captures multiple extremes per year.</span>
<span id="cb9-197"><a href="#cb9-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-198"><a href="#cb9-198" aria-hidden="true" tabindex="-1"></a>The log-scale x-axis is intentional. Return periods follow a power-law relationship—doubling the return period doesn't double the intensity. The curve flattens, meaning truly catastrophic events (1000-year return periods) are only marginally more intense than 100-year events, but exponentially rarer.</span>
<span id="cb9-199"><a href="#cb9-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-200"><a href="#cb9-200" aria-hidden="true" tabindex="-1"></a>This analysis is the foundation of engineering design standards (dams, bridges, flood defenses) and insurance pricing. The "100-year flood" isn't a prediction—it's a risk metric.</span>
<span id="cb9-201"><a href="#cb9-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-204"><a href="#cb9-204" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb9-205"><a href="#cb9-205" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute return periods for temperature extremes</span></span>
<span id="cb9-206"><a href="#cb9-206" aria-hidden="true" tabindex="-1"></a>return_periods_temp <span class="op">=</span> compute_return_periods(</span>
<span id="cb9-207"><a href="#cb9-207" aria-hidden="true" tabindex="-1"></a>    climate_data,</span>
<span id="cb9-208"><a href="#cb9-208" aria-hidden="true" tabindex="-1"></a>    variable<span class="op">=</span><span class="st">'temperature_c'</span>,</span>
<span id="cb9-209"><a href="#cb9-209" aria-hidden="true" tabindex="-1"></a>    method<span class="op">=</span><span class="st">'block_maxima'</span>,</span>
<span id="cb9-210"><a href="#cb9-210" aria-hidden="true" tabindex="-1"></a>    block_size<span class="op">=</span><span class="st">'1Y'</span></span>
<span id="cb9-211"><a href="#cb9-211" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-212"><a href="#cb9-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-213"><a href="#cb9-213" aria-hidden="true" tabindex="-1"></a>return_periods_precip <span class="op">=</span> compute_return_periods(</span>
<span id="cb9-214"><a href="#cb9-214" aria-hidden="true" tabindex="-1"></a>    climate_data,</span>
<span id="cb9-215"><a href="#cb9-215" aria-hidden="true" tabindex="-1"></a>    variable<span class="op">=</span><span class="st">'precipitation_mm'</span>,</span>
<span id="cb9-216"><a href="#cb9-216" aria-hidden="true" tabindex="-1"></a>    method<span class="op">=</span><span class="st">'peaks_over_threshold'</span>,</span>
<span id="cb9-217"><a href="#cb9-217" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-218"><a href="#cb9-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-219"><a href="#cb9-219" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">5</span>))</span>
<span id="cb9-220"><a href="#cb9-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-221"><a href="#cb9-221" aria-hidden="true" tabindex="-1"></a><span class="co"># Temperature return periods</span></span>
<span id="cb9-222"><a href="#cb9-222" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> axes[<span class="dv">0</span>]</span>
<span id="cb9-223"><a href="#cb9-223" aria-hidden="true" tabindex="-1"></a>ax1.plot(return_periods_temp[<span class="st">'return_period_years'</span>], </span>
<span id="cb9-224"><a href="#cb9-224" aria-hidden="true" tabindex="-1"></a>        return_periods_temp[<span class="st">'return_value'</span>], </span>
<span id="cb9-225"><a href="#cb9-225" aria-hidden="true" tabindex="-1"></a>        marker<span class="op">=</span><span class="st">'o'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, markersize<span class="op">=</span><span class="dv">8</span>, color<span class="op">=</span><span class="st">'#e74c3c'</span>)</span>
<span id="cb9-226"><a href="#cb9-226" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'Return Period (years)'</span>, fontsize<span class="op">=</span><span class="dv">11</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb9-227"><a href="#cb9-227" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'Return Value (°C)'</span>, fontsize<span class="op">=</span><span class="dv">11</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb9-228"><a href="#cb9-228" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">'Temperature: Return Period Analysis</span><span class="ch">\n</span><span class="st">(Annual Maxima Method)'</span>, </span>
<span id="cb9-229"><a href="#cb9-229" aria-hidden="true" tabindex="-1"></a>              fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb9-230"><a href="#cb9-230" aria-hidden="true" tabindex="-1"></a>ax1.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb9-231"><a href="#cb9-231" aria-hidden="true" tabindex="-1"></a>ax1.set_xscale(<span class="st">'log'</span>)</span>
<span id="cb9-232"><a href="#cb9-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-233"><a href="#cb9-233" aria-hidden="true" tabindex="-1"></a><span class="co"># Precipitation return periods</span></span>
<span id="cb9-234"><a href="#cb9-234" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> axes[<span class="dv">1</span>]</span>
<span id="cb9-235"><a href="#cb9-235" aria-hidden="true" tabindex="-1"></a>ax2.plot(return_periods_precip[<span class="st">'return_period_years'</span>], </span>
<span id="cb9-236"><a href="#cb9-236" aria-hidden="true" tabindex="-1"></a>        return_periods_precip[<span class="st">'return_value'</span>], </span>
<span id="cb9-237"><a href="#cb9-237" aria-hidden="true" tabindex="-1"></a>        marker<span class="op">=</span><span class="st">'o'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, markersize<span class="op">=</span><span class="dv">8</span>, color<span class="op">=</span><span class="st">'#3498db'</span>)</span>
<span id="cb9-238"><a href="#cb9-238" aria-hidden="true" tabindex="-1"></a>ax2.set_xlabel(<span class="st">'Return Period (years)'</span>, fontsize<span class="op">=</span><span class="dv">11</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb9-239"><a href="#cb9-239" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'Return Value (mm)'</span>, fontsize<span class="op">=</span><span class="dv">11</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb9-240"><a href="#cb9-240" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">'Precipitation: Return Period Analysis</span><span class="ch">\n</span><span class="st">(Peaks Over Threshold Method)'</span>, </span>
<span id="cb9-241"><a href="#cb9-241" aria-hidden="true" tabindex="-1"></a>              fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb9-242"><a href="#cb9-242" aria-hidden="true" tabindex="-1"></a>ax2.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb9-243"><a href="#cb9-243" aria-hidden="true" tabindex="-1"></a>ax2.set_xscale(<span class="st">'log'</span>)</span>
<span id="cb9-244"><a href="#cb9-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-245"><a href="#cb9-245" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb9-246"><a href="#cb9-246" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb9-247"><a href="#cb9-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-248"><a href="#cb9-248" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Return Period Analysis Results:"</span>)</span>
<span id="cb9-249"><a href="#cb9-249" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Temperature (Annual Maxima):"</span>)</span>
<span id="cb9-250"><a href="#cb9-250" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(return_periods_temp.to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb9-251"><a href="#cb9-251" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Precipitation (Peaks Over Threshold):"</span>)</span>
<span id="cb9-252"><a href="#cb9-252" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(return_periods_precip.to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb9-253"><a href="#cb9-253" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-254"><a href="#cb9-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-255"><a href="#cb9-255" aria-hidden="true" tabindex="-1"></a><span class="fu">## Correlation Structure: When Variables Move Together</span></span>
<span id="cb9-256"><a href="#cb9-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-257"><a href="#cb9-257" aria-hidden="true" tabindex="-1"></a>Climate variables don't exist in isolation. Temperature, precipitation, and pressure are coupled through physical processes. The correlation matrix quantifies these relationships, but the interpretation requires care.</span>
<span id="cb9-258"><a href="#cb9-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-259"><a href="#cb9-259" aria-hidden="true" tabindex="-1"></a>A negative correlation between temperature and precipitation might seem counterintuitive, but it reflects the physics: high-pressure systems (clear skies, high temperatures) suppress precipitation, while low-pressure systems (clouds, precipitation) moderate temperatures. The strength of these correlations varies by season and region.</span>
<span id="cb9-260"><a href="#cb9-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-261"><a href="#cb9-261" aria-hidden="true" tabindex="-1"></a>Why this matters: if variables are correlated, extreme events in one variable are more likely to co-occur with extremes in another. This creates compound risks that simple univariate analysis misses. A heatwave coinciding with low precipitation creates drought stress. A cold snap with high precipitation creates ice storms. The correlation structure tells us which compound events are physically plausible and which are unlikely.</span>
<span id="cb9-262"><a href="#cb9-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-265"><a href="#cb9-265" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb9-266"><a href="#cb9-266" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute correlation matrix</span></span>
<span id="cb9-267"><a href="#cb9-267" aria-hidden="true" tabindex="-1"></a>corr_matrix <span class="op">=</span> analyze_correlations(</span>
<span id="cb9-268"><a href="#cb9-268" aria-hidden="true" tabindex="-1"></a>    climate_data,</span>
<span id="cb9-269"><a href="#cb9-269" aria-hidden="true" tabindex="-1"></a>    variables<span class="op">=</span>[<span class="st">'temperature_c'</span>, <span class="st">'precipitation_mm'</span>, <span class="st">'pressure_hpa'</span>]</span>
<span id="cb9-270"><a href="#cb9-270" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-271"><a href="#cb9-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-272"><a href="#cb9-272" aria-hidden="true" tabindex="-1"></a><span class="co"># Create heatmap</span></span>
<span id="cb9-273"><a href="#cb9-273" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb9-274"><a href="#cb9-274" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> HAS_SEABORN:</span>
<span id="cb9-275"><a href="#cb9-275" aria-hidden="true" tabindex="-1"></a>    sns.heatmap(corr_matrix, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">'.3f'</span>, cmap<span class="op">=</span><span class="st">'RdBu_r'</span>, center<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb9-276"><a href="#cb9-276" aria-hidden="true" tabindex="-1"></a>               square<span class="op">=</span><span class="va">True</span>, linewidths<span class="op">=</span><span class="dv">1</span>, cbar_kws<span class="op">=</span>{<span class="st">"shrink"</span>: <span class="fl">0.8</span>},</span>
<span id="cb9-277"><a href="#cb9-277" aria-hidden="true" tabindex="-1"></a>               vmin<span class="op">=-</span><span class="dv">1</span>, vmax<span class="op">=</span><span class="dv">1</span>, ax<span class="op">=</span>ax)</span>
<span id="cb9-278"><a href="#cb9-278" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb9-279"><a href="#cb9-279" aria-hidden="true" tabindex="-1"></a>    im <span class="op">=</span> ax.imshow(corr_matrix.values, cmap<span class="op">=</span><span class="st">'RdBu_r'</span>, vmin<span class="op">=-</span><span class="dv">1</span>, vmax<span class="op">=</span><span class="dv">1</span>, aspect<span class="op">=</span><span class="st">'auto'</span>)</span>
<span id="cb9-280"><a href="#cb9-280" aria-hidden="true" tabindex="-1"></a>    ax.set_xticks(<span class="bu">range</span>(<span class="bu">len</span>(corr_matrix.columns)))</span>
<span id="cb9-281"><a href="#cb9-281" aria-hidden="true" tabindex="-1"></a>    ax.set_yticks(<span class="bu">range</span>(<span class="bu">len</span>(corr_matrix.index)))</span>
<span id="cb9-282"><a href="#cb9-282" aria-hidden="true" tabindex="-1"></a>    ax.set_xticklabels(corr_matrix.columns)</span>
<span id="cb9-283"><a href="#cb9-283" aria-hidden="true" tabindex="-1"></a>    ax.set_yticklabels(corr_matrix.index)</span>
<span id="cb9-284"><a href="#cb9-284" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(corr_matrix.index)):</span>
<span id="cb9-285"><a href="#cb9-285" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(corr_matrix.columns)):</span>
<span id="cb9-286"><a href="#cb9-286" aria-hidden="true" tabindex="-1"></a>            ax.text(j, i, <span class="ss">f'</span><span class="sc">{</span>corr_matrix<span class="sc">.</span>iloc[i, j]<span class="sc">:.3f}</span><span class="ss">'</span>, </span>
<span id="cb9-287"><a href="#cb9-287" aria-hidden="true" tabindex="-1"></a>                   ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'center'</span>, color<span class="op">=</span><span class="st">'black'</span> <span class="cf">if</span> <span class="bu">abs</span>(corr_matrix.iloc[i, j]) <span class="op">&lt;</span> <span class="fl">0.5</span> <span class="cf">else</span> <span class="st">'white'</span>)</span>
<span id="cb9-288"><a href="#cb9-288" aria-hidden="true" tabindex="-1"></a>    plt.colorbar(im, ax<span class="op">=</span>ax, shrink<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb9-289"><a href="#cb9-289" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Climate Variables Correlation Matrix'</span>, </span>
<span id="cb9-290"><a href="#cb9-290" aria-hidden="true" tabindex="-1"></a>             fontsize<span class="op">=</span><span class="dv">13</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, pad<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb9-291"><a href="#cb9-291" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb9-292"><a href="#cb9-292" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb9-293"><a href="#cb9-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-294"><a href="#cb9-294" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Correlation Matrix:"</span>)</span>
<span id="cb9-295"><a href="#cb9-295" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(corr_matrix)</span>
<span id="cb9-296"><a href="#cb9-296" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-297"><a href="#cb9-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-298"><a href="#cb9-298" aria-hidden="true" tabindex="-1"></a><span class="fu">## Event Typology: Clustering Extreme Events</span></span>
<span id="cb9-299"><a href="#cb9-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-300"><a href="#cb9-300" aria-hidden="true" tabindex="-1"></a>Not all extreme events are the same. Hierarchical clustering groups events by their multi-variable signatures, revealing distinct "types" of extremes. One cluster might represent "dry heatwaves" (high temperature, low precipitation, high pressure), while another represents "humid heatwaves" (high temperature, high precipitation, low pressure).</span>
<span id="cb9-301"><a href="#cb9-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-302"><a href="#cb9-302" aria-hidden="true" tabindex="-1"></a>This typology matters because different event types have different impacts. A dry heatwave increases wildfire risk and water stress. A humid heatwave increases heat stress on humans (reduced evaporative cooling) and can trigger convective storms. The clustering analysis transforms a collection of individual events into a taxonomy of risk scenarios.</span>
<span id="cb9-303"><a href="#cb9-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-304"><a href="#cb9-304" aria-hidden="true" tabindex="-1"></a>The cluster characteristics plot shows the mean conditions for each event type. Notice how clusters differ not just in temperature, but in the full multi-variable space. This is the power of multivariate analysis: it captures patterns that univariate methods miss.</span>
<span id="cb9-305"><a href="#cb9-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-308"><a href="#cb9-308" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb9-309"><a href="#cb9-309" aria-hidden="true" tabindex="-1"></a><span class="co"># Cluster extreme temperature events</span></span>
<span id="cb9-310"><a href="#cb9-310" aria-hidden="true" tabindex="-1"></a>climate_data <span class="op">=</span> cluster_extreme_events(</span>
<span id="cb9-311"><a href="#cb9-311" aria-hidden="true" tabindex="-1"></a>    climate_data,</span>
<span id="cb9-312"><a href="#cb9-312" aria-hidden="true" tabindex="-1"></a>    n_clusters<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb9-313"><a href="#cb9-313" aria-hidden="true" tabindex="-1"></a>    variables<span class="op">=</span>[<span class="st">'temperature_c'</span>, <span class="st">'precipitation_mm'</span>, <span class="st">'pressure_hpa'</span>]</span>
<span id="cb9-314"><a href="#cb9-314" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-315"><a href="#cb9-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-316"><a href="#cb9-316" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize clustered extreme events</span></span>
<span id="cb9-317"><a href="#cb9-317" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">10</span>), sharex<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb9-318"><a href="#cb9-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-319"><a href="#cb9-319" aria-hidden="true" tabindex="-1"></a><span class="co"># Temperature with cluster colors</span></span>
<span id="cb9-320"><a href="#cb9-320" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> axes[<span class="dv">0</span>]</span>
<span id="cb9-321"><a href="#cb9-321" aria-hidden="true" tabindex="-1"></a>scatter <span class="op">=</span> ax1.scatter(climate_data[<span class="st">'datetime_utc'</span>], climate_data[<span class="st">'temperature_c'</span>],</span>
<span id="cb9-322"><a href="#cb9-322" aria-hidden="true" tabindex="-1"></a>                     c<span class="op">=</span>climate_data[<span class="st">'extreme_cluster'</span>], cmap<span class="op">=</span><span class="st">'Set1'</span>, </span>
<span id="cb9-323"><a href="#cb9-323" aria-hidden="true" tabindex="-1"></a>                     s<span class="op">=</span><span class="dv">20</span>, alpha<span class="op">=</span><span class="fl">0.6</span>, edgecolors<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb9-324"><a href="#cb9-324" aria-hidden="true" tabindex="-1"></a>extreme_mask <span class="op">=</span> climate_data[<span class="st">'is_extreme'</span>]</span>
<span id="cb9-325"><a href="#cb9-325" aria-hidden="true" tabindex="-1"></a>ax1.scatter(climate_data[extreme_mask][<span class="st">'datetime_utc'</span>],</span>
<span id="cb9-326"><a href="#cb9-326" aria-hidden="true" tabindex="-1"></a>           climate_data[extreme_mask][<span class="st">'temperature_c'</span>],</span>
<span id="cb9-327"><a href="#cb9-327" aria-hidden="true" tabindex="-1"></a>           c<span class="op">=</span>climate_data[extreme_mask][<span class="st">'extreme_cluster'</span>], cmap<span class="op">=</span><span class="st">'Set1'</span>,</span>
<span id="cb9-328"><a href="#cb9-328" aria-hidden="true" tabindex="-1"></a>           s<span class="op">=</span><span class="dv">100</span>, alpha<span class="op">=</span><span class="fl">0.9</span>, edgecolors<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>, </span>
<span id="cb9-329"><a href="#cb9-329" aria-hidden="true" tabindex="-1"></a>           marker<span class="op">=</span><span class="st">'*'</span>, zorder<span class="op">=</span><span class="dv">5</span>, label<span class="op">=</span><span class="st">'Extreme Events'</span>)</span>
<span id="cb9-330"><a href="#cb9-330" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'Temperature (°C)'</span>, fontsize<span class="op">=</span><span class="dv">11</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb9-331"><a href="#cb9-331" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">'Temperature Time Series with Clustered Extreme Events'</span>, </span>
<span id="cb9-332"><a href="#cb9-332" aria-hidden="true" tabindex="-1"></a>              fontsize<span class="op">=</span><span class="dv">13</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, pad<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb9-333"><a href="#cb9-333" aria-hidden="true" tabindex="-1"></a>cbar <span class="op">=</span> plt.colorbar(scatter, ax<span class="op">=</span>ax1)</span>
<span id="cb9-334"><a href="#cb9-334" aria-hidden="true" tabindex="-1"></a>cbar.set_label(<span class="st">'Cluster ID'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb9-335"><a href="#cb9-335" aria-hidden="true" tabindex="-1"></a>ax1.legend(loc<span class="op">=</span><span class="st">'upper left'</span>, fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb9-336"><a href="#cb9-336" aria-hidden="true" tabindex="-1"></a>ax1.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb9-337"><a href="#cb9-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-338"><a href="#cb9-338" aria-hidden="true" tabindex="-1"></a><span class="co"># Cluster characteristics</span></span>
<span id="cb9-339"><a href="#cb9-339" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> axes[<span class="dv">1</span>]</span>
<span id="cb9-340"><a href="#cb9-340" aria-hidden="true" tabindex="-1"></a>cluster_stats <span class="op">=</span> climate_data[climate_data[<span class="st">'extreme_cluster'</span>] <span class="op">&gt;</span> <span class="dv">0</span>].groupby(<span class="st">'extreme_cluster'</span>).agg({</span>
<span id="cb9-341"><a href="#cb9-341" aria-hidden="true" tabindex="-1"></a>    <span class="st">'temperature_c'</span>: <span class="st">'mean'</span>,</span>
<span id="cb9-342"><a href="#cb9-342" aria-hidden="true" tabindex="-1"></a>    <span class="st">'precipitation_mm'</span>: <span class="st">'mean'</span>,</span>
<span id="cb9-343"><a href="#cb9-343" aria-hidden="true" tabindex="-1"></a>    <span class="st">'pressure_hpa'</span>: <span class="st">'mean'</span>,</span>
<span id="cb9-344"><a href="#cb9-344" aria-hidden="true" tabindex="-1"></a>    <span class="st">'extreme_intensity'</span>: <span class="st">'mean'</span>,</span>
<span id="cb9-345"><a href="#cb9-345" aria-hidden="true" tabindex="-1"></a>}).reset_index()</span>
<span id="cb9-346"><a href="#cb9-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-347"><a href="#cb9-347" aria-hidden="true" tabindex="-1"></a>x_pos <span class="op">=</span> np.arange(<span class="bu">len</span>(cluster_stats))</span>
<span id="cb9-348"><a href="#cb9-348" aria-hidden="true" tabindex="-1"></a>width <span class="op">=</span> <span class="fl">0.35</span></span>
<span id="cb9-349"><a href="#cb9-349" aria-hidden="true" tabindex="-1"></a>ax2.bar(x_pos <span class="op">-</span> width<span class="op">/</span><span class="dv">2</span>, cluster_stats[<span class="st">'temperature_c'</span>], width, </span>
<span id="cb9-350"><a href="#cb9-350" aria-hidden="true" tabindex="-1"></a>       label<span class="op">=</span><span class="st">'Temperature'</span>, color<span class="op">=</span><span class="st">'#e74c3c'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb9-351"><a href="#cb9-351" aria-hidden="true" tabindex="-1"></a>ax2_twin <span class="op">=</span> ax2.twinx()</span>
<span id="cb9-352"><a href="#cb9-352" aria-hidden="true" tabindex="-1"></a>ax2_twin.bar(x_pos <span class="op">+</span> width<span class="op">/</span><span class="dv">2</span>, cluster_stats[<span class="st">'precipitation_mm'</span>], width,</span>
<span id="cb9-353"><a href="#cb9-353" aria-hidden="true" tabindex="-1"></a>            label<span class="op">=</span><span class="st">'Precipitation'</span>, color<span class="op">=</span><span class="st">'#3498db'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb9-354"><a href="#cb9-354" aria-hidden="true" tabindex="-1"></a>ax2.set_xlabel(<span class="st">'Cluster ID'</span>, fontsize<span class="op">=</span><span class="dv">11</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb9-355"><a href="#cb9-355" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'Temperature (°C)'</span>, fontsize<span class="op">=</span><span class="dv">11</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, color<span class="op">=</span><span class="st">'#e74c3c'</span>)</span>
<span id="cb9-356"><a href="#cb9-356" aria-hidden="true" tabindex="-1"></a>ax2_twin.set_ylabel(<span class="st">'Precipitation (mm)'</span>, fontsize<span class="op">=</span><span class="dv">11</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, color<span class="op">=</span><span class="st">'#3498db'</span>)</span>
<span id="cb9-357"><a href="#cb9-357" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">'Cluster Characteristics: Mean Values by Cluster'</span>, </span>
<span id="cb9-358"><a href="#cb9-358" aria-hidden="true" tabindex="-1"></a>              fontsize<span class="op">=</span><span class="dv">13</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, pad<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb9-359"><a href="#cb9-359" aria-hidden="true" tabindex="-1"></a>ax2.set_xticks(x_pos)</span>
<span id="cb9-360"><a href="#cb9-360" aria-hidden="true" tabindex="-1"></a>ax2.set_xticklabels(cluster_stats[<span class="st">'extreme_cluster'</span>])</span>
<span id="cb9-361"><a href="#cb9-361" aria-hidden="true" tabindex="-1"></a>ax2.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, axis<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="cb9-362"><a href="#cb9-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-363"><a href="#cb9-363" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb9-364"><a href="#cb9-364" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb9-365"><a href="#cb9-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-366"><a href="#cb9-366" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Cluster Statistics:"</span>)</span>
<span id="cb9-367"><a href="#cb9-367" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(cluster_stats.to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb9-368"><a href="#cb9-368" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-369"><a href="#cb9-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-370"><a href="#cb9-370" aria-hidden="true" tabindex="-1"></a><span class="fu">## Intensity Distribution: The Shape of Extremes</span></span>
<span id="cb9-371"><a href="#cb9-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-372"><a href="#cb9-372" aria-hidden="true" tabindex="-1"></a>The distribution of extreme event intensities reveals something important: extremes themselves have structure. They're not uniformly distributed—there are "moderate extremes" and "extreme extremes." The histogram shows a right-skewed distribution, meaning most extreme events are relatively mild (just above the threshold), while truly catastrophic events are rare.</span>
<span id="cb9-373"><a href="#cb9-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-374"><a href="#cb9-374" aria-hidden="true" tabindex="-1"></a>The box plots by cluster show that different event types have different intensity distributions. Some clusters have tight distributions (consistent intensity), while others are highly variable. This heterogeneity matters for risk assessment: if you're planning for the "typical extreme," you'll be underprepared for the tail events.</span>
<span id="cb9-375"><a href="#cb9-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-376"><a href="#cb9-376" aria-hidden="true" tabindex="-1"></a>The median being lower than the mean indicates positive skew—the distribution has a long right tail. This is characteristic of extreme value distributions and reflects the physics: there's a lower bound (you can't have negative heat), but no upper bound (temperatures can theoretically get arbitrarily high, though practically limited by energy balance).</span>
<span id="cb9-377"><a href="#cb9-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-380"><a href="#cb9-380" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb9-381"><a href="#cb9-381" aria-hidden="true" tabindex="-1"></a><span class="co"># Analyze distribution of extreme event intensities</span></span>
<span id="cb9-382"><a href="#cb9-382" aria-hidden="true" tabindex="-1"></a>extreme_events <span class="op">=</span> climate_data[climate_data[<span class="st">'is_extreme'</span>]].copy()</span>
<span id="cb9-383"><a href="#cb9-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-384"><a href="#cb9-384" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">5</span>))</span>
<span id="cb9-385"><a href="#cb9-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-386"><a href="#cb9-386" aria-hidden="true" tabindex="-1"></a><span class="co"># Histogram of extreme intensities</span></span>
<span id="cb9-387"><a href="#cb9-387" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> axes[<span class="dv">0</span>]</span>
<span id="cb9-388"><a href="#cb9-388" aria-hidden="true" tabindex="-1"></a>ax1.hist(extreme_events[<span class="st">'extreme_intensity'</span>], bins<span class="op">=</span><span class="dv">30</span>, color<span class="op">=</span><span class="st">'#e74c3c'</span>, </span>
<span id="cb9-389"><a href="#cb9-389" aria-hidden="true" tabindex="-1"></a>        alpha<span class="op">=</span><span class="fl">0.7</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="fl">1.2</span>)</span>
<span id="cb9-390"><a href="#cb9-390" aria-hidden="true" tabindex="-1"></a>ax1.axvline(extreme_events[<span class="st">'extreme_intensity'</span>].mean(), </span>
<span id="cb9-391"><a href="#cb9-391" aria-hidden="true" tabindex="-1"></a>           color<span class="op">=</span><span class="st">'#c0392b'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, </span>
<span id="cb9-392"><a href="#cb9-392" aria-hidden="true" tabindex="-1"></a>           label<span class="op">=</span><span class="ss">f"Mean: </span><span class="sc">{</span>extreme_events[<span class="st">'extreme_intensity'</span>]<span class="sc">.</span>mean()<span class="sc">:.2f}</span><span class="ss">°C"</span>)</span>
<span id="cb9-393"><a href="#cb9-393" aria-hidden="true" tabindex="-1"></a>ax1.axvline(extreme_events[<span class="st">'extreme_intensity'</span>].median(), </span>
<span id="cb9-394"><a href="#cb9-394" aria-hidden="true" tabindex="-1"></a>           color<span class="op">=</span><span class="st">'#8e44ad'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, linewidth<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb9-395"><a href="#cb9-395" aria-hidden="true" tabindex="-1"></a>           label<span class="op">=</span><span class="ss">f"Median: </span><span class="sc">{</span>extreme_events[<span class="st">'extreme_intensity'</span>]<span class="sc">.</span>median()<span class="sc">:.2f}</span><span class="ss">°C"</span>)</span>
<span id="cb9-396"><a href="#cb9-396" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'Extreme Intensity (°C above threshold)'</span>, fontsize<span class="op">=</span><span class="dv">11</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb9-397"><a href="#cb9-397" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'Frequency'</span>, fontsize<span class="op">=</span><span class="dv">11</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb9-398"><a href="#cb9-398" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">'Distribution of Extreme Event Intensities'</span>, </span>
<span id="cb9-399"><a href="#cb9-399" aria-hidden="true" tabindex="-1"></a>              fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb9-400"><a href="#cb9-400" aria-hidden="true" tabindex="-1"></a>ax1.legend(fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb9-401"><a href="#cb9-401" aria-hidden="true" tabindex="-1"></a>ax1.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, axis<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="cb9-402"><a href="#cb9-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-403"><a href="#cb9-403" aria-hidden="true" tabindex="-1"></a><span class="co"># Box plot by cluster</span></span>
<span id="cb9-404"><a href="#cb9-404" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> axes[<span class="dv">1</span>]</span>
<span id="cb9-405"><a href="#cb9-405" aria-hidden="true" tabindex="-1"></a><span class="co"># Get unique cluster IDs (excluding 0) and filter out empty clusters</span></span>
<span id="cb9-406"><a href="#cb9-406" aria-hidden="true" tabindex="-1"></a>unique_clusters <span class="op">=</span> <span class="bu">sorted</span>([i <span class="cf">for</span> i <span class="kw">in</span> extreme_events[<span class="st">'extreme_cluster'</span>].unique() <span class="cf">if</span> i <span class="op">&gt;</span> <span class="dv">0</span>])</span>
<span id="cb9-407"><a href="#cb9-407" aria-hidden="true" tabindex="-1"></a>cluster_data <span class="op">=</span> []</span>
<span id="cb9-408"><a href="#cb9-408" aria-hidden="true" tabindex="-1"></a>cluster_labels <span class="op">=</span> []</span>
<span id="cb9-409"><a href="#cb9-409" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> unique_clusters:</span>
<span id="cb9-410"><a href="#cb9-410" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> extreme_events[extreme_events[<span class="st">'extreme_cluster'</span>] <span class="op">==</span> i][<span class="st">'extreme_intensity'</span>].values</span>
<span id="cb9-411"><a href="#cb9-411" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(data) <span class="op">&gt;</span> <span class="dv">0</span>:  <span class="co"># Only include clusters with data</span></span>
<span id="cb9-412"><a href="#cb9-412" aria-hidden="true" tabindex="-1"></a>        cluster_data.append(data)</span>
<span id="cb9-413"><a href="#cb9-413" aria-hidden="true" tabindex="-1"></a>        cluster_labels.append(<span class="bu">str</span>(i))</span>
<span id="cb9-414"><a href="#cb9-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-415"><a href="#cb9-415" aria-hidden="true" tabindex="-1"></a><span class="co"># Only plot if we have data</span></span>
<span id="cb9-416"><a href="#cb9-416" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">len</span>(cluster_data) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb9-417"><a href="#cb9-417" aria-hidden="true" tabindex="-1"></a>    bp <span class="op">=</span> ax2.boxplot(cluster_data, labels<span class="op">=</span>cluster_labels,</span>
<span id="cb9-418"><a href="#cb9-418" aria-hidden="true" tabindex="-1"></a>                    patch_artist<span class="op">=</span><span class="va">True</span>, showmeans<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb9-419"><a href="#cb9-419" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> patch <span class="kw">in</span> bp[<span class="st">'boxes'</span>]:</span>
<span id="cb9-420"><a href="#cb9-420" aria-hidden="true" tabindex="-1"></a>        patch.set_facecolor(<span class="st">'#e74c3c'</span>)</span>
<span id="cb9-421"><a href="#cb9-421" aria-hidden="true" tabindex="-1"></a>        patch.set_alpha(<span class="fl">0.7</span>)</span>
<span id="cb9-422"><a href="#cb9-422" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb9-423"><a href="#cb9-423" aria-hidden="true" tabindex="-1"></a>    ax2.text(<span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="st">'No cluster data available'</span>, </span>
<span id="cb9-424"><a href="#cb9-424" aria-hidden="true" tabindex="-1"></a>            ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'center'</span>, transform<span class="op">=</span>ax2.transAxes)</span>
<span id="cb9-425"><a href="#cb9-425" aria-hidden="true" tabindex="-1"></a>ax2.set_xlabel(<span class="st">'Cluster ID'</span>, fontsize<span class="op">=</span><span class="dv">11</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb9-426"><a href="#cb9-426" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'Extreme Intensity (°C above threshold)'</span>, fontsize<span class="op">=</span><span class="dv">11</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb9-427"><a href="#cb9-427" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">'Extreme Intensity Distribution by Cluster'</span>, </span>
<span id="cb9-428"><a href="#cb9-428" aria-hidden="true" tabindex="-1"></a>              fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb9-429"><a href="#cb9-429" aria-hidden="true" tabindex="-1"></a>ax2.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, axis<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="cb9-430"><a href="#cb9-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-431"><a href="#cb9-431" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb9-432"><a href="#cb9-432" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb9-433"><a href="#cb9-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-434"><a href="#cb9-434" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Extreme Event Intensity Statistics:"</span>)</span>
<span id="cb9-435"><a href="#cb9-435" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(extreme_events[<span class="st">'extreme_intensity'</span>].describe())</span>
<span id="cb9-436"><a href="#cb9-436" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-437"><a href="#cb9-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-438"><a href="#cb9-438" aria-hidden="true" tabindex="-1"></a><span class="fu">## Synthesis: What the Numbers Tell Us</span></span>
<span id="cb9-439"><a href="#cb9-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-440"><a href="#cb9-440" aria-hidden="true" tabindex="-1"></a>The summary statistics aggregate the analysis into digestible metrics, but the real insights come from understanding how these pieces fit together. The return period analysis tells us about rarity. The clustering tells us about diversity. The correlation structure tells us about co-occurrence. Together, they paint a picture of a climate system where extremes are:</span>
<span id="cb9-441"><a href="#cb9-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-442"><a href="#cb9-442" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Rare but not random**: They follow statistical distributions that can be modeled</span>
<span id="cb9-443"><a href="#cb9-443" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Diverse in type**: Not all extremes are the same—different event types have different impacts</span>
<span id="cb9-444"><a href="#cb9-444" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Correlated in space and time**: Variables move together, creating compound risks</span>
<span id="cb9-445"><a href="#cb9-445" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**Heterogeneous in intensity**: Most extremes are moderate; catastrophic events are exponentially rarer</span>
<span id="cb9-446"><a href="#cb9-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-447"><a href="#cb9-447" aria-hidden="true" tabindex="-1"></a>This framework is the foundation for climate risk assessment. It transforms raw data into actionable intelligence: understanding not just what happened, but what could happen, how often, and in what combinations.</span>
<span id="cb9-448"><a href="#cb9-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-451"><a href="#cb9-451" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb9-452"><a href="#cb9-452" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate comprehensive summary</span></span>
<span id="cb9-453"><a href="#cb9-453" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb9-454"><a href="#cb9-454" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"CLIMATE EXTREMES ANALYSIS SUMMARY"</span>)</span>
<span id="cb9-455"><a href="#cb9-455" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb9-456"><a href="#cb9-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-457"><a href="#cb9-457" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">📊 Dataset Overview:"</span>)</span>
<span id="cb9-458"><a href="#cb9-458" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   Period: </span><span class="sc">{</span>climate_data[<span class="st">'datetime_utc'</span>]<span class="sc">.</span><span class="bu">min</span>()<span class="sc">.</span>date()<span class="sc">}</span><span class="ss"> to </span><span class="sc">{</span>climate_data[<span class="st">'datetime_utc'</span>]<span class="sc">.</span><span class="bu">max</span>()<span class="sc">.</span>date()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb9-459"><a href="#cb9-459" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   Total days: </span><span class="sc">{</span><span class="bu">len</span>(climate_data)<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb9-460"><a href="#cb9-460" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   Variables: Temperature, Precipitation, Pressure"</span>)</span>
<span id="cb9-461"><a href="#cb9-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-462"><a href="#cb9-462" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">🌡️  Temperature Extremes:"</span>)</span>
<span id="cb9-463"><a href="#cb9-463" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   Total extreme events: </span><span class="sc">{</span>temp_stats[<span class="st">'n_events'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb9-464"><a href="#cb9-464" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   Extreme days: </span><span class="sc">{</span>temp_stats[<span class="st">'total_days'</span>]<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span><span class="dv">100</span><span class="op">*</span>temp_stats[<span class="st">'total_days'</span>]<span class="op">/</span><span class="bu">len</span>(climate_data)<span class="sc">:.2f}</span><span class="ss">% of period)"</span>)</span>
<span id="cb9-465"><a href="#cb9-465" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   Mean intensity: </span><span class="sc">{</span>temp_stats[<span class="st">'mean_intensity'</span>]<span class="sc">:.2f}</span><span class="ss">°C above 95th percentile"</span>)</span>
<span id="cb9-466"><a href="#cb9-466" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   Maximum intensity: </span><span class="sc">{</span>temp_stats[<span class="st">'max_intensity'</span>]<span class="sc">:.2f}</span><span class="ss">°C above threshold"</span>)</span>
<span id="cb9-467"><a href="#cb9-467" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   Mean duration: </span><span class="sc">{</span>temp_stats[<span class="st">'mean_duration'</span>]<span class="sc">:.1f}</span><span class="ss"> days per event"</span>)</span>
<span id="cb9-468"><a href="#cb9-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-469"><a href="#cb9-469" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">🌧️  Precipitation Extremes:"</span>)</span>
<span id="cb9-470"><a href="#cb9-470" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   Total extreme events: </span><span class="sc">{</span>precip_stats[<span class="st">'n_events'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb9-471"><a href="#cb9-471" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   Extreme days: </span><span class="sc">{</span>precip_stats[<span class="st">'total_days'</span>]<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span><span class="dv">100</span><span class="op">*</span>precip_stats[<span class="st">'total_days'</span>]<span class="op">/</span><span class="bu">len</span>(climate_data)<span class="sc">:.2f}</span><span class="ss">% of period)"</span>)</span>
<span id="cb9-472"><a href="#cb9-472" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   Mean intensity: </span><span class="sc">{</span>precip_stats[<span class="st">'mean_intensity'</span>]<span class="sc">:.2f}</span><span class="ss"> mm above 95th percentile"</span>)</span>
<span id="cb9-473"><a href="#cb9-473" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   Maximum intensity: </span><span class="sc">{</span>precip_stats[<span class="st">'max_intensity'</span>]<span class="sc">:.2f}</span><span class="ss"> mm above threshold"</span>)</span>
<span id="cb9-474"><a href="#cb9-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-475"><a href="#cb9-475" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">📈 Return Period Analysis:"</span>)</span>
<span id="cb9-476"><a href="#cb9-476" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   100-year return temperature: </span><span class="sc">{</span>return_periods_temp[return_periods_temp[<span class="st">'return_period_years'</span>]<span class="op">==</span><span class="dv">100</span>][<span class="st">'return_value'</span>]<span class="sc">.</span>values[<span class="dv">0</span>]<span class="sc">:.2f}</span><span class="ss">°C"</span>)</span>
<span id="cb9-477"><a href="#cb9-477" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   100-year return precipitation: </span><span class="sc">{</span>return_periods_precip[return_periods_precip[<span class="st">'return_period_years'</span>]<span class="op">==</span><span class="dv">100</span>][<span class="st">'return_value'</span>]<span class="sc">.</span>values[<span class="dv">0</span>]<span class="sc">:.2f}</span><span class="ss"> mm"</span>)</span>
<span id="cb9-478"><a href="#cb9-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-479"><a href="#cb9-479" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">🔗 Variable Correlations:"</span>)</span>
<span id="cb9-480"><a href="#cb9-480" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   Temperature-Precipitation: </span><span class="sc">{</span>corr_matrix<span class="sc">.</span>loc[<span class="st">'temperature_c'</span>, <span class="st">'precipitation_mm'</span>]<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb9-481"><a href="#cb9-481" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   Temperature-Pressure: </span><span class="sc">{</span>corr_matrix<span class="sc">.</span>loc[<span class="st">'temperature_c'</span>, <span class="st">'pressure_hpa'</span>]<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb9-482"><a href="#cb9-482" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   Precipitation-Pressure: </span><span class="sc">{</span>corr_matrix<span class="sc">.</span>loc[<span class="st">'precipitation_mm'</span>, <span class="st">'pressure_hpa'</span>]<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb9-483"><a href="#cb9-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-484"><a href="#cb9-484" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">🎯 Extreme Event Clusters:"</span>)</span>
<span id="cb9-485"><a href="#cb9-485" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   Number of clusters: </span><span class="sc">{</span>climate_data[<span class="st">'extreme_cluster'</span>]<span class="sc">.</span><span class="bu">max</span>()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb9-486"><a href="#cb9-486" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> cluster_id <span class="kw">in</span> <span class="bu">sorted</span>(cluster_stats[<span class="st">'extreme_cluster'</span>]):</span>
<span id="cb9-487"><a href="#cb9-487" aria-hidden="true" tabindex="-1"></a>    cluster_data <span class="op">=</span> climate_data[climate_data[<span class="st">'extreme_cluster'</span>] <span class="op">==</span> cluster_id]</span>
<span id="cb9-488"><a href="#cb9-488" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   Cluster </span><span class="sc">{</span>cluster_id<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="bu">len</span>(cluster_data)<span class="sc">}</span><span class="ss"> events, "</span></span>
<span id="cb9-489"><a href="#cb9-489" aria-hidden="true" tabindex="-1"></a>          <span class="ss">f"mean temp </span><span class="sc">{</span>cluster_stats[cluster_stats[<span class="st">'extreme_cluster'</span>]<span class="op">==</span>cluster_id][<span class="st">'temperature_c'</span>]<span class="sc">.</span>values[<span class="dv">0</span>]<span class="sc">:.1f}</span><span class="ss">°C"</span>)</span>
<span id="cb9-490"><a href="#cb9-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-491"><a href="#cb9-491" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb9-492"><a href="#cb9-492" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-493"><a href="#cb9-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-494"><a href="#cb9-494" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb9-495"><a href="#cb9-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-496"><a href="#cb9-496" aria-hidden="true" tabindex="-1"></a><span class="fu">## Note</span></span>
<span id="cb9-497"><a href="#cb9-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-498"><a href="#cb9-498" aria-hidden="true" tabindex="-1"></a>This analysis uses synthetic climate data for demonstration. In production, this framework can be applied to real ERA5 reanalysis data or observational climate datasets. The methods shown here—extreme value theory, return period analysis, and event clustering—are standard approaches in climate risk assessment.</span>
</code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>© Timm Walker</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p><a href="../notes/index.xml" title="RSS Feed" aria-label="RSS Feed">📡 RSS</a> · <a href="https://github.com/recurrentanalytics" title="GitHub">GitHub</a> · <a href="mailto:timm.walker@recurrentanalytics.com" title="Email">Email</a></p>
</div>
  </div>
</footer>




<script src="../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>