{
  "hash": "5077f4c76f26bd8a6843d41de0d8b027",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"Heatwaves and Day-Ahead Prices: DE-LU, Summer 2019\"\ndate: 2025-12-12\ncategories: [energy, extremes, time-series]\n---\n\n## Why this note exists\n\nHeatwaves stress energy systems. Air conditioning demand spikes. Thermal power plants lose efficiency. Grid operators face the dual challenge of surging demand and constrained supply. This note asks a simple question: do electricity prices reflect this stress?\n\nThis is not a causal analysis. We're not claiming heatwaves cause price spikes—too many confounding factors exist. Instead, we document an operational definition of a heatwave, trace it through a data pipeline, and observe what happens to prices when heatwaves occur. The pipeline is meant to be inspectable rather than \"correct\" in any final sense. Every choice—the 30°C threshold, the 3-day minimum duration, the peak hours definition—is explicit and debatable.\n\n## Data: Two Time Series, One Question\n\nWe need two things: electricity prices and temperature. The DE-LU day-ahead price represents the marginal cost of electricity in the German-Luxembourg bidding zone—the price at which the last unit of demand is satisfied. It's a market signal that reflects supply-demand balance in real-time.\n\nGerman temperature data provides the heatwave signal. We use Germany because it's the dominant market in the DE-LU zone, and temperature is the primary driver of cooling demand. The data spans 2015-2020, capturing multiple summers with varying heatwave intensity.\n\nThe challenge is temporal alignment: prices are hourly, heatwaves are daily phenomena. We need to bridge this gap—flagging heatwave days, then attributing that flag to all hours within those days. This is a modeling choice: we're assuming that if a day is a heatwave day, all hours within it are \"heatwave hours,\" even though nighttime hours might be cooler.\n\n## Build processed inputs (hourly parquet)\n\n::: {#ec1b8868 .cell execution_count=1}\n``` {.python .cell-code}\nimport sys\nimport os\nsys.path.insert(0, os.path.abspath('.'))\n\nimport pandas as pd\n\nfrom src.data_download import (\n    save_prices_from_opsd, \n    save_weather_de_from_opsd,\n    generate_synthetic_prices,\n    generate_synthetic_weather,\n)\n\nSTART = \"2015-01-01\"\nEND_PRICES  = \"2020-07-01\"\nEND_WEATHER = \"2020-01-01\"\n\n# Try to load real data, fall back to synthetic if not available\ntry:\n    save_prices_from_opsd(start=START, end=END_PRICES)\n    save_weather_de_from_opsd(start=START, end=END_WEATHER)\n    \n    prices  = pd.read_parquet(\"data/processed/prices_de_lu_clean.parquet\")\n    weather = pd.read_parquet(\"data/processed/weather_de_agg.parquet\")\n    \n    print(\"Real data loaded successfully:\")\n    print(prices.head())\n    print(weather.head())\nexcept (FileNotFoundError, Exception) as e:\n    print(f\"Real data files not found: {e}\")\n    print(\"\\nGenerating synthetic data for demonstration purposes...\")\n    print(\"(To use real data, download from:\")\n    print(\"- Time series: https://data.open-power-system-data.org/time_series/\")\n    print(\"- Weather data: https://data.open-power-system-data.org/weather_data/\")\n    print(\"  and place CSV files in data/raw/)\\n\")\n    \n    # Generate synthetic data\n    prices = generate_synthetic_prices(start=START, end=END_PRICES, seed=42)\n    weather = generate_synthetic_weather(start=START, end=END_WEATHER, seed=42)\n    \n    print(\"Synthetic data generated:\")\n    print(f\"Prices: {len(prices)} hourly records\")\n    print(f\"Weather: {len(weather)} hourly records\")\n    print(prices.head())\n    print(weather.head())\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nReal data files not found: File not found at data/raw/time_series_60min_singleindex.csv. Download from: https://data.open-power-system-data.org/time_series/latest/\n\nGenerating synthetic data for demonstration purposes...\n(To use real data, download from:\n- Time series: https://data.open-power-system-data.org/time_series/\n- Weather data: https://data.open-power-system-data.org/weather_data/\n  and place CSV files in data/raw/)\n\nSynthetic data generated:\nPrices: 48193 hourly records\nWeather: 43825 hourly records\n               datetime_utc  price_eur_mwh\n0 2015-01-01 00:00:00+00:00      42.013229\n1 2015-01-01 01:00:00+00:00      38.289080\n2 2015-01-01 02:00:00+00:00      42.898693\n3 2015-01-01 03:00:00+00:00      48.032570\n4 2015-01-01 04:00:00+00:00      37.726690\n               datetime_utc  t2m_mean_c\n0 2015-01-01 00:00:00+00:00   -3.286388\n1 2015-01-01 01:00:00+00:00   -5.020953\n2 2015-01-01 02:00:00+00:00   -2.163592\n3 2015-01-01 03:00:00+00:00    1.257025\n4 2015-01-01 04:00:00+00:00   -2.978991\n```\n:::\n:::\n\n\n## Heatwave Definition: A Threshold with Consequences\n\nThe definition is simple: daily maximum temperature ≥ 30°C for at least 3 consecutive days. But this simplicity masks complexity. Why 30°C? Why 3 days? These choices determine which events get flagged, which get ignored, and ultimately what patterns we observe in the price data.\n\nThe 30°C threshold is arbitrary but meaningful. In Germany, 30°C represents a temperature where cooling demand becomes significant. Below this, natural ventilation and shading might suffice. Above this, active cooling (air conditioning) becomes necessary, driving electricity demand. The 3-day minimum filters out brief heat spikes, focusing on sustained events that have cumulative impacts on both demand (building heat storage) and supply (thermal plant efficiency degradation).\n\nAlternative definitions exist: percentile-based (e.g., 95th percentile of summer temperatures), regionalized (different thresholds for different regions), or impact-based (thresholds tied to actual cooling degree days). Each would produce a different set of flagged days, potentially revealing different price patterns. The point isn't to find the \"correct\" definition—it's to make the choice explicit and trace its implications.\n\n## Flag heatwaves and merge with prices\n\n::: {#0bac5ba0 .cell execution_count=2}\n``` {.python .cell-code}\nimport matplotlib.pyplot as plt\n\nfrom src.heatwave_defs import (\n    restrict_common_period,\n    compute_daily_max_temp,\n    flag_heatwaves,\n    expand_heatwave_flag_to_hourly,\n    merge_price_and_weather,\n)\n\n# Check if data is available\nif prices.empty or weather.empty:\n    print(\"Skipping analysis: data files not available.\")\n    print(\"Please download the required data files to run this analysis.\")\n    prices_c = pd.DataFrame()\n    weather_c = pd.DataFrame()\n    daily_flags = pd.DataFrame()\n    merged = pd.DataFrame()\nelse:\n    prices_c, weather_c = restrict_common_period(prices, weather)\n    \n    daily_temp  = compute_daily_max_temp(weather_c)\n    daily_flags = flag_heatwaves(daily_temp, threshold=30.0, min_duration=3)\n    \n    # Attach daily flag back to hourly weather and merge with hourly prices\n    weather_hw = expand_heatwave_flag_to_hourly(weather_c, daily_flags)\n    merged = merge_price_and_weather(prices_c, weather_hw)\n    \n    print(\"Heatwave analysis completed:\")\n    print(merged.head())\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nHeatwave analysis completed:\n               datetime_utc  price_eur_mwh  t2m_mean_c  is_heatwave_day  hour  \\\n0 2015-01-01 00:00:00+00:00      42.013229   -3.286388            False     0   \n1 2015-01-01 01:00:00+00:00      38.289080   -5.020953            False     1   \n2 2015-01-01 02:00:00+00:00      42.898693   -2.163592            False     2   \n3 2015-01-01 03:00:00+00:00      48.032570    1.257025            False     3   \n4 2015-01-01 04:00:00+00:00      37.726690   -2.978991            False     4   \n\n   dow  month  \n0    3      1  \n1    3      1  \n2    3      1  \n3    3      1  \n4    3      1  \n```\n:::\n:::\n\n\n## Summer 2019: A Case Study in Heatwave Clustering\n\nSummer 2019 serves as a concrete example. The visualization shows daily maximum temperatures with heatwave days highlighted. Notice the clustering: heatwaves don't occur in isolation. They cluster in time, creating multi-week periods of elevated stress. The first visualization isolates temperature, showing the heatwave signal clearly—days that exceed 30°C for three or more consecutive days.\n\nThis temporal clustering matters. A single hot day might cause a price spike, but sustained heatwaves create cumulative effects: building heat storage saturates (requiring more cooling), thermal plants lose efficiency over time, and grid operators face sustained stress rather than brief spikes. The 3-day minimum captures this sustained nature.\n\n::: {#9563fae3 .cell execution_count=3}\n``` {.python .cell-code}\nif daily_flags.empty:\n    print(\"No data available for visualization.\")\nelse:\n    hw_2019 = daily_flags[\"2019-06-01\":\"2019-08-31\"]\n    \n    fig, ax = plt.subplots(figsize=(12, 4))\n    ax.plot(hw_2019.index, hw_2019[\"t2m_daily_max_c\"], label=\"Daily max temp\")\n    ax.scatter(\n        hw_2019.index[hw_2019[\"is_heatwave_day\"]],\n        hw_2019[\"t2m_daily_max_c\"][hw_2019[\"is_heatwave_day\"]],\n        s=35,\n        label=\"Heatwave days\",\n    )\n    ax.set_ylabel(\"°C\")\n    ax.set_title(\"Daily max temperature with heatwave days highlighted (Summer 2019)\")\n    ax.legend()\n    plt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](heatwave-prices-de-lu_files/figure-html/cell-4-output-1.png){width=977 height=357}\n:::\n:::\n\n\n## Price-Temperature Coupling: Visual Evidence\n\nThe dual-axis plot reveals the relationship between prices and temperature during summer 2019. The shaded regions mark heatwave days, creating a visual test: do prices behave differently during these periods?\n\nWhat we observe: prices show volatility throughout the summer, but heatwave periods (shaded) often coincide with price spikes. This is descriptive, not causal. Prices could be spiking for other reasons—renewable generation shortfalls, plant outages, cross-border flow constraints. But the visual correlation is suggestive: when heatwaves occur, prices tend to be elevated.\n\nThe dashed temperature line shows the underlying driver. Notice how price spikes often lag temperature peaks slightly—this reflects the time it takes for cooling demand to build (buildings heat up gradually) and for grid operators to respond to demand signals.\n\n::: {#edb169a1 .cell execution_count=4}\n``` {.python .cell-code}\nif merged.empty:\n    print(\"No data available for visualization.\")\nelse:\n    summer = merged.set_index(\"datetime_utc\")[\"2019-06-01\":\"2019-08-31\"]\n    \n    fig, ax1 = plt.subplots(figsize=(12, 5))\n    ax2 = ax1.twinx()\n    \n    ax1.plot(summer.index, summer[\"price_eur_mwh\"], label=\"Price (EUR/MWh)\")\n    ax2.plot(summer.index, summer[\"t2m_mean_c\"], alpha=0.7, linestyle=\"--\", label=\"Temperature (°C)\")\n    \n    # Shade heatwave days\n    for day in summer.index.normalize().unique():\n        day_mask = (summer.index.normalize() == day)\n        if summer.loc[day_mask, \"is_heatwave_day\"].any():\n            ax1.axvspan(day, day + pd.Timedelta(days=1), alpha=0.12)\n    \n    ax1.set_ylabel(\"Price [EUR/MWh]\")\n    ax2.set_ylabel(\"Temperature [°C]\")\n    ax1.set_title(\"Summer 2019: DE-LU day-ahead prices and DE temperature (heatwave days shaded)\")\n    fig.tight_layout()\n    plt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](heatwave-prices-de-lu_files/figure-html/cell-5-output-1.png){width=1140 height=469}\n:::\n:::\n\n\n## Distributional Differences: Quantifying the Heatwave Premium\n\nThe histogram comparison is the core of the analysis. It asks: do price distributions differ between heatwave and non-heatwave days during peak hours (8 AM to 8 PM)? Peak hours matter because that's when cooling demand is highest and when price formation is most sensitive to marginal units.\n\nWhat we typically observe: the heatwave distribution is shifted right (higher prices on average) and has a fatter right tail (more extreme price spikes). The mean difference quantifies the \"heatwave premium\"—the average price increase during heatwave periods. But the tail matters more: extreme price spikes during heatwaves can be orders of magnitude higher than normal prices, creating financial stress for consumers and opportunities for generators.\n\nThe statistical summary provides the numbers: mean, median, standard deviation, and percentiles for both distributions. The difference in means tells us about average impact. The difference in 95th percentiles tells us about tail risk. Both matter, but for different purposes: average impact affects long-term costs, tail risk affects system resilience and financial planning.\n\n::: {#ef132407 .cell execution_count=5}\n``` {.python .cell-code}\nif merged.empty:\n    print(\"No data available for analysis.\")\n    summary = pd.DataFrame()\nelse:\n    peak = merged[(merged[\"hour\"] >= 8) & (merged[\"hour\"] <= 20)].copy()\n    \n    hw = peak[peak[\"is_heatwave_day\"]]\n    normal = peak[~peak[\"is_heatwave_day\"]]\n    \n    summary = pd.DataFrame({\n        \"normal_peak_hours\": normal[\"price_eur_mwh\"].describe(),\n        \"heatwave_peak_hours\": hw[\"price_eur_mwh\"].describe(),\n    })\n    print(summary)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n       normal_peak_hours  heatwave_peak_hours\ncount       23465.000000           273.000000\nmean           54.219016            53.919783\nstd            11.336571             9.488113\nmin            21.270343            26.527501\n25%            47.398170            47.516456\n50%            53.485898            53.349150\n75%            59.841235            58.802326\nmax           200.000000            93.670777\n```\n:::\n:::\n\n\n::: {#0dd7ecba .cell execution_count=6}\n``` {.python .cell-code}\nif merged.empty:\n    print(\"No data available for visualization.\")\nelse:\n    peak = merged[(merged[\"hour\"] >= 8) & (merged[\"hour\"] <= 20)].copy()\n    hw = peak[peak[\"is_heatwave_day\"]]\n    normal = peak[~peak[\"is_heatwave_day\"]]\n    \n    fig, ax = plt.subplots(figsize=(8, 5))\n    \n    ax.hist(normal[\"price_eur_mwh\"], bins=60, alpha=0.6, density=True, label=\"Normal days (peak hours)\")\n    ax.hist(hw[\"price_eur_mwh\"],     bins=60, alpha=0.6, density=True, label=\"Heatwave days (peak hours)\")\n    \n    ax.set_xlabel(\"Day-ahead price (EUR/MWh)\")\n    ax.set_ylabel(\"Density\")\n    ax.set_title(\"DE-LU prices: heatwave vs normal days (2015–2019, peak hours)\")\n    ax.legend()\n    plt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](heatwave-prices-de-lu_files/figure-html/cell-7-output-1.png){width=672 height=449}\n:::\n:::\n\n\n## Limitations and Extensions: What This Analysis Doesn't Tell Us\n\nThis analysis is intentionally limited. It's descriptive, not causal. We observe that prices are higher during heatwaves, but we don't claim heatwaves cause those higher prices. Too many confounding factors exist: renewable generation (solar output is high during heatwaves, potentially offsetting demand), plant outages (thermal plants are more likely to fail during heat stress), cross-border flows (neighboring countries also face heatwaves), and fuel prices (which drive marginal costs).\n\nTo establish causality, we'd need an identification strategy: perhaps exploiting spatial variation (heatwaves in one region but not another), temporal variation (comparing similar days with and without heatwaves), or instrumental variables (using temperature as an instrument for cooling demand). This is beyond the scope of this note.\n\nNatural extensions include:\n- **Alternative heatwave definitions**: Percentile-based thresholds that adapt to regional climate, or impact-based definitions tied to actual cooling degree days\n- **Multivariate analysis**: Adding load, renewable generation, and plant availability as covariates to control for confounding factors\n- **Multi-year stability**: Do these patterns hold across different summers? Are heatwave impacts getting stronger over time (suggesting increasing system stress)?\n- **Spatial analysis**: Do heatwaves in different regions have different price impacts? Does transmission capacity matter?\n\nThe value of this analysis isn't in its completeness—it's in its transparency. Every choice is explicit, every assumption is visible, and the pipeline is inspectable. This makes it a foundation for more sophisticated analysis, not an endpoint.\n\n::: {.backlinks}\n#### Related\n- [Risk Modelling Part 2: Data](/notes/risk-series-2.html) - Data sources for climate risk\n:::\n\n",
    "supporting": [
      "heatwave-prices-de-lu_files"
    ],
    "filters": [],
    "includes": {}
  }
}