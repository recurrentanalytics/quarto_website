project:
  type: website
  output-dir: _site

website:
  title: "re:current analytics"
  site-url: https://recurrentanalytics.com
  description: "A lab-notebook for climate risk, models, and recurrent intelligence."
  favicon: assets/favicon.svg

  # Social cards (disabled until image exists)
  # image: assets/social-card.png
  open-graph: true
  twitter-card:
    creator: "@timmwalker"
    # image: assets/social-card.png

  navbar:
    logo: assets/favicon.svg
    left:
      - text: Home
        href: index.qmd
      - text: About
        href: about.qmd
      - text: Notes / Lab
        href: notes/
      - text: Projects
        href: projects/
      - text: Models & Tools
        href: models/
      - text: Reading
        href: reading/
      - text: Tipping Points
        href: tipping-points/
      - text: Contact / CV
        href: contact_cv.qmd
    right:
      - icon: github
        href: https://github.com/recurrentanalytics
      - icon: rss
        href: notes/index.xml

  page-footer:
    left: "© Timm Walker"
    right: "A lab for recurrent climate intelligence."

  search: true
  repo-url: https://github.com/recurrentanalytics/recurrentanalytics
  repo-actions: [source]

format:
  html:
    theme:
      light: [cosmo, styles.scss]
      dark:  [cyborg, styles.scss]
    toc: true
    code-tools: true
    code-copy: true
    smooth-scroll: true
    anchor-sections: true
    include-in-header:
      text: |
        <!-- Plausible analytics -->
        <script defer data-domain="recurrentanalytics.com" src="https://plausible.io/js/script.js"></script>

        <!-- Hero drift effect -->
        <style>
          .rac-hero {
            position: relative; padding: 5rem 0 4rem; text-align:center;
            overflow: hidden;
          }
          .rac-hero h1 { font-weight: 800; letter-spacing: .5px; }
          .rac-hero .drift {
            position: absolute; left: -10%; right:-10%; bottom: -40px; height: 120px;
            background: radial-gradient(100% 60% at 50% 40%, var(--bs-secondary-bg) 0%, transparent 70%);
            animation: slowfloat 14s ease-in-out infinite alternate;
            opacity:.7; filter: blur(10px);
          }
          @keyframes slowfloat { from { transform: translateY(0px);} to {transform: translateY(16px);} }
        </style>

        <!-- Reading progress bar, keyboard shortcuts, random note -->
        <script>
        document.addEventListener('DOMContentLoaded', function() {
          // Reading progress bar
          const progressBar = document.createElement('div');
          progressBar.className = 'reading-progress';
          document.body.appendChild(progressBar);
          
          window.addEventListener('scroll', function() {
            const scrollTop = window.scrollY;
            const docHeight = document.documentElement.scrollHeight - window.innerHeight;
            const progress = docHeight > 0 ? (scrollTop / docHeight) * 100 : 0;
            progressBar.style.width = progress + '%';
          });

          // Keyboard shortcuts
          const noteLinks = Array.from(document.querySelectorAll('.quarto-listing-default a, .sidebar-item a'));
          let currentIndex = -1;

          document.addEventListener('keydown', function(e) {
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
            
            // / to focus search
            if (e.key === '/' && !e.ctrlKey && !e.metaKey) {
              e.preventDefault();
              const searchInput = document.querySelector('#quarto-search input, .aa-Input');
              if (searchInput) searchInput.focus();
            }
            
            // j/k to navigate notes (on listing pages)
            if (noteLinks.length > 0) {
              if (e.key === 'j') {
                currentIndex = Math.min(currentIndex + 1, noteLinks.length - 1);
                noteLinks[currentIndex]?.focus();
              }
              if (e.key === 'k') {
                currentIndex = Math.max(currentIndex - 1, 0);
                noteLinks[currentIndex]?.focus();
              }
            }
            
            // ? to show keyboard hints
            if (e.key === '?') {
              const hint = document.querySelector('.keyboard-hint');
              if (hint) hint.classList.toggle('visible');
            }
          });

          // Add keyboard hint element
          const hint = document.createElement('div');
          hint.className = 'keyboard-hint';
          hint.innerHTML = '/ search · j/k navigate · ? toggle hints';
          document.body.appendChild(hint);

          // Reading time - add to article pages
          const articleBody = document.querySelector('.quarto-title-block, #quarto-document-content');
          const contentArea = document.querySelector('#quarto-document-content, .content, main');
          if (articleBody && contentArea) {
            const text = contentArea.innerText || '';
            const wordCount = text.trim().split(/\s+/).length;
            const readingTime = Math.max(1, Math.ceil(wordCount / 200));
            const timeSpan = document.createElement('span');
            timeSpan.className = 'reading-time';
            timeSpan.textContent = readingTime + ' min read';
            const titleMeta = document.querySelector('.quarto-title-meta, .quarto-title');
            if (titleMeta) {
              titleMeta.appendChild(document.createTextNode(' · '));
              titleMeta.appendChild(timeSpan);
            }
          }

          // Random note link - add to footer if on notes section
          const notesData = [
            '/notes/2025-hello-world.html',
            '/notes/climate/monte-carlo-basics.html',
            '/notes/climate/sal.html'
          ];
          
          const footer = document.querySelector('.nav-footer-center, .nav-footer-right');
          if (footer && notesData.length > 0) {
            const randomLink = document.createElement('a');
            randomLink.href = '#';
            randomLink.className = 'random-note-link';
            randomLink.textContent = '↻ Random note';
            randomLink.addEventListener('click', function(e) {
              e.preventDefault();
              const randomNote = notesData[Math.floor(Math.random() * notesData.length)];
              window.location.href = randomNote;
            });
            footer.appendChild(document.createTextNode(' · '));
            footer.appendChild(randomLink);
          }
        });
        </script>

execute:
  freeze: auto

# Blog-style collection with feed (RSS at notes/index.xml)
collections:
  notes:
    feed: true
    categories: true
    sort: "date desc"
    listing:
      type: default
      sort: "date desc"
      contents: "notes/*"
