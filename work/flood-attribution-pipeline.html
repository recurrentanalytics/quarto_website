<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2025-01-15">

<title>Extreme Rainfall Attribution Pipeline – re:current_analytics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../assets/favicon.svg" rel="icon" type="image/svg+xml">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-4be685f768d06aff641a2dc379f1fc59.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>

<script src="https://d3js.org/d3.v7.min.js"></script>

<script src="../assets/graph-script.js" defer=""></script>
<script>
// Fallback: ensure graph loads even if main script fails
window.addEventListener('load', function() {
  if (!document.getElementById('mini-graph-container')) {
    setTimeout(function() {
      const script = document.createElement('script');
      script.src = '../assets/graph-script.js';
      document.head.appendChild(script);
    }, 500);
  }
});
</script>

<style>
/* Prevent scrolling in code output areas */
.cell-output,
.cell-output-stdout,
.cell-output-display,
.cell-output-error,
.cell-output-warning {
  overflow: visible !important;
  max-height: none !important;
  white-space: pre-wrap;
  word-wrap: break-word;
}

pre.sourceCode,
pre code {
  overflow: visible !important;
  max-height: none !important;
}

/* Ensure output containers don't scroll */
.cell-output > pre,
.cell-output-stdout > pre {
  overflow: visible !important;
  max-height: none !important;
}

/* Better spacing and layout for code cells */
.cell {
  margin: 2rem 0;
}

.cell-code {
  margin-bottom: 0.5rem;
}

/* Text output styling */
.cell-output-stdout {
  margin-top: 0.75rem;
  padding: 1rem;
  background: var(--bs-tertiary-bg, #f8f9fa);
  border-radius: 0.375rem;
  border-left: 3px solid var(--bs-primary, #0d6efd);
}

.cell-output-stdout pre {
  margin: 0;
  padding: 0;
  background: transparent;
  border: none;
  font-size: 0.9rem;
  line-height: 1.6;
}

/* Visual output styling - better stacking */
.cell-output-display {
  margin-top: 1rem;
  margin-bottom: 0;
}

.cell-output-display figure {
  margin: 0;
  padding: 0;
}

.cell-output-display .figure-img {
  max-width: 100%;
  height: auto;
  display: block;
  margin: 0 auto;
  border-radius: 0.375rem;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  cursor: pointer;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.cell-output-display .figure-img:hover {
  transform: scale(1.02);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

/* Lightbox modal */
.figure-lightbox {
  display: none;
  position: fixed;
  z-index: 10000;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.9);
  backdrop-filter: blur(4px);
  animation: fadeIn 0.2s ease;
}

.figure-lightbox.active {
  display: flex;
  align-items: center;
  justify-content: center;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.figure-lightbox-content {
  position: relative;
  max-width: 95%;
  max-height: 95vh;
  margin: auto;
  animation: zoomIn 0.2s ease;
}

@keyframes zoomIn {
  from { transform: scale(0.9); opacity: 0; }
  to { transform: scale(1); opacity: 1; }
}

.figure-lightbox-img {
  max-width: 100%;
  max-height: 95vh;
  width: auto;
  height: auto;
  border-radius: 0.5rem;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
}

.figure-lightbox-close {
  position: absolute;
  top: -2.5rem;
  right: 0;
  color: white;
  font-size: 2rem;
  font-weight: bold;
  cursor: pointer;
  background: rgba(0, 0, 0, 0.5);
  border: none;
  border-radius: 50%;
  width: 2.5rem;
  height: 2.5rem;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background 0.2s ease;
}

.figure-lightbox-close:hover {
  background: rgba(0, 0, 0, 0.8);
}

.figure-lightbox-close:focus {
  outline: 2px solid white;
  outline-offset: 2px;
}

@media (max-width: 768px) {
  .figure-lightbox-content {
    max-width: 98%;
  }

  .figure-lightbox-close {
    top: 1rem;
    right: 1rem;
  }
}

/* Better separation between code and output */
.cell-code + .cell-output {
  margin-top: 0.75rem;
}

/* Error output styling */
.cell-output-error {
  margin-top: 0.75rem;
  padding: 1rem;
  background: var(--bs-danger-bg-subtle, #f8d7da);
  border-radius: 0.375rem;
  border-left: 3px solid var(--bs-danger, #dc3545);
  color: var(--bs-danger-text-emphasis, #721c24);
}

.cell-output-error pre {
  margin: 0;
  padding: 0;
  background: transparent;
  border: none;
}
</style>
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Create lightbox container
  const lightbox = document.createElement('div');
  lightbox.className = 'figure-lightbox';
  lightbox.innerHTML = `
    <div class="figure-lightbox-content">
      <button class="figure-lightbox-close" aria-label="Close">&times;</button>
      <img class="figure-lightbox-img" src="" alt="Enlarged figure">
    </div>
  `;
  document.body.appendChild(lightbox);

  const lightboxImg = lightbox.querySelector('.figure-lightbox-img');
  const lightboxClose = lightbox.querySelector('.figure-lightbox-close');

  // Make all figure images clickable
  document.querySelectorAll('.cell-output-display .figure-img').forEach(img => {
    img.style.cursor = 'pointer';
    img.setAttribute('title', 'Click to enlarge');

    img.addEventListener('click', function(e) {
      e.stopPropagation();
      lightboxImg.src = this.src;
      lightboxImg.alt = this.alt || 'Enlarged figure';
      lightbox.classList.add('active');
      document.body.style.overflow = 'hidden';
    });
  });

  // Close lightbox
  function closeLightbox() {
    lightbox.classList.remove('active');
    document.body.style.overflow = '';
  }

  lightboxClose.addEventListener('click', closeLightbox);

  lightbox.addEventListener('click', function(e) {
    if (e.target === lightbox) {
      closeLightbox();
    }
  });

  // Close on Escape key
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape' && lightbox.classList.contains('active')) {
      closeLightbox();
    }
  });
});
</script>


<meta property="og:title" content="Extreme Rainfall Attribution Pipeline – re:current_analytics">
<meta property="og:description" content="A lab-notebook for climate risk, models, and recurrent intelligence.">
<meta property="og:image" content="https://recurrentanalytics.com/work/flood-attribution-pipeline_files/figure-html/cell-6-output-1.png">
<meta property="og:site_name" content="re:current_analytics">
<meta property="og:image:height" content="2284">
<meta property="og:image:width" content="3051">
<meta name="twitter:title" content="Extreme Rainfall Attribution Pipeline – re:current_analytics">
<meta name="twitter:description" content="A lab-notebook for climate risk, models, and recurrent intelligence.">
<meta name="twitter:image" content="https://recurrentanalytics.com/work/flood-attribution-pipeline_files/figure-html/cell-6-output-1.png">
<meta name="twitter:creator" content="@timmwalker">
<meta name="twitter:image-height" content="2284">
<meta name="twitter:image-width" content="3051">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../assets/favicon.svg" alt="" class="navbar-logo light-content">
    <img src="../assets/favicon.svg" alt="" class="navbar-logo dark-content">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">re:current_analytics</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#why-this-pipeline-exists" id="toc-why-this-pipeline-exists" class="nav-link active" data-scroll-target="#why-this-pipeline-exists">Why this pipeline exists</a></li>
  <li><a href="#introduction-extreme-event-attribution" id="toc-introduction-extreme-event-attribution" class="nav-link" data-scroll-target="#introduction-extreme-event-attribution">Introduction: Extreme Event Attribution</a></li>
  <li><a href="#data-requirements" id="toc-data-requirements" class="nav-link" data-scroll-target="#data-requirements">Data Requirements</a></li>
  <li><a href="#example-1-2021-western-europe-floods" id="toc-example-1-2021-western-europe-floods" class="nav-link" data-scroll-target="#example-1-2021-western-europe-floods">Example 1: 2021 Western Europe Floods</a>
  <ul class="collapse">
  <li><a href="#define-the-event" id="toc-define-the-event" class="nav-link" data-scroll-target="#define-the-event">Define the event</a></li>
  <li><a href="#load-era5-data" id="toc-load-era5-data" class="nav-link" data-scroll-target="#load-era5-data">Load ERA5 data</a></li>
  <li><a href="#detect-the-event" id="toc-detect-the-event" class="nav-link" data-scroll-target="#detect-the-event">Detect the event</a></li>
  <li><a href="#calculate-attribution" id="toc-calculate-attribution" class="nav-link" data-scroll-target="#calculate-attribution">Calculate attribution</a></li>
  <li><a href="#visualize-results" id="toc-visualize-results" class="nav-link" data-scroll-target="#visualize-results">Visualize results</a></li>
  <li><a href="#interpretation" id="toc-interpretation" class="nav-link" data-scroll-target="#interpretation">Interpretation</a></li>
  </ul></li>
  <li><a href="#example-2-user-defined-event" id="toc-example-2-user-defined-event" class="nav-link" data-scroll-target="#example-2-user-defined-event">Example 2: User-Defined Event</a></li>
  <li><a href="#methodology-details" id="toc-methodology-details" class="nav-link" data-scroll-target="#methodology-details">Methodology Details</a>
  <ul class="collapse">
  <li><a href="#statistical-approach" id="toc-statistical-approach" class="nav-link" data-scroll-target="#statistical-approach">Statistical Approach</a></li>
  <li><a href="#limitations" id="toc-limitations" class="nav-link" data-scroll-target="#limitations">Limitations</a></li>
  </ul></li>
  <li><a href="#extensions-and-future-work" id="toc-extensions-and-future-work" class="nav-link" data-scroll-target="#extensions-and-future-work">Extensions and Future Work</a></li>
  <li><a href="#integration-with-other-content" id="toc-integration-with-other-content" class="nav-link" data-scroll-target="#integration-with-other-content">Integration with Other Content</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/recurrentanalytics/quarto_website/blob/main/work/flood-attribution-pipeline.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Extreme Rainfall Attribution Pipeline</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
  <div class="quarto-categories">
    <div class="quarto-category">attribution</div>
    <div class="quarto-category">extremes</div>
    <div class="quarto-category">climate-risk</div>
  </div>
  </div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 15, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="why-this-pipeline-exists" class="level2">
<h2 class="anchored" data-anchor-id="why-this-pipeline-exists">Why this pipeline exists</h2>
<p>This pipeline quantifies how climate change altered the probability and intensity of extreme rainfall events. It implements standard attribution methods (Fraction of Attributable Risk and Probability Ratio) using ERA5 reanalysis data.</p>
<p><strong>Code Execution:</strong> All code cells are executed when the page is rendered. The code and its output are shown together, making it easy to see what each step does.</p>
<p><strong>What this does:</strong> - Analyzes precipitation extremes (not flood impacts directly) - Calculates attribution metrics with uncertainty quantification - Works for any region, date range, and event definition - Reproducible and inspectable</p>
<p><strong>What this doesn’t do:</strong> - Model actual flood impacts (runoff, infrastructure vulnerability) - Provide causal attribution (this is statistical attribution) - Account for all regional/local factors</p>
<p>This is an intermediate object: a working tool that makes explicit choices and limitations.</p>
</section>
<section id="introduction-extreme-event-attribution" class="level2">
<h2 class="anchored" data-anchor-id="introduction-extreme-event-attribution">Introduction: Extreme Event Attribution</h2>
<p>Extreme event attribution asks: <em>“How did climate change alter the probability or intensity of this specific event?”</em></p>
<p>Two common metrics:</p>
<ol type="1">
<li><strong>Fraction of Attributable Risk (FAR)</strong>: The fraction of risk that can be attributed to climate change
<ul>
<li>FAR = 1 - (P_historical / P_recent)</li>
<li>Range: -∞ to 1 (1 = fully attributable, 0 = no change, negative = less likely)</li>
</ul></li>
<li><strong>Probability Ratio (PR)</strong>: How many times more likely the event became
<ul>
<li>PR = P_recent / P_historical</li>
<li>Range: 0 to ∞ (1 = no change, &gt;1 = more likely, &lt;1 = less likely)</li>
</ul></li>
</ol>
<p>Both metrics compare probabilities of exceeding a threshold in a historical baseline period versus a recent period.</p>
</section>
<section id="data-requirements" class="level2">
<h2 class="anchored" data-anchor-id="data-requirements">Data Requirements</h2>
<p>This pipeline uses <strong>ERA5 reanalysis</strong> precipitation data. ERA5 provides: - Global coverage from 1950 to present - Hourly or daily temporal resolution - ~31km spatial resolution - Variable: <code>total_precipitation</code> (accumulated over hour, in meters)</p>
<p><strong>To use this pipeline, you need:</strong> 1. ERA5 data downloaded (via CDS API or pre-downloaded files) 2. Or modify the data loading functions to use your own data source</p>
<p><strong>Data download:</strong> - <a href="https://cds.climate.copernicus.eu/">CDS API</a> (requires registration) - Variable: <code>total_precipitation</code> - Product: <code>reanalysis-era5-single-levels</code></p>
</section>
<section id="example-1-2021-western-europe-floods" class="level2">
<h2 class="anchored" data-anchor-id="example-1-2021-western-europe-floods">Example 1: 2021 Western Europe Floods</h2>
<p>The July 2021 floods in Germany, Belgium, and Netherlands were caused by extreme rainfall. Let’s analyze the attribution of this event.</p>
<section id="define-the-event" class="level3">
<h3 class="anchored" data-anchor-id="define-the-event">Define the event</h3>
<div id="ab6e2710" class="cell" data-execution_count="1">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Add project root to Python path  </span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>project_root <span class="op">=</span> Path.cwd() <span class="cf">if</span> Path(<span class="st">'src'</span>).exists() <span class="cf">else</span> Path.cwd().parent</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>sys.path.insert(<span class="dv">0</span>, <span class="bu">str</span>(project_root))</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> src.attribution.event_definitions <span class="im">import</span> define_rainfall_event</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Event definition: July 12-15, 2021, Western Europe</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Cumulative rainfall &gt;150mm over 2-3 days</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>event_2021 <span class="op">=</span> define_rainfall_event(</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    region<span class="op">=</span>{<span class="st">'lat'</span>: (<span class="fl">48.0</span>, <span class="fl">52.0</span>), <span class="st">'lon'</span>: (<span class="fl">4.0</span>, <span class="fl">9.0</span>)},  <span class="co"># Germany/Belgium region</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    date_range<span class="op">=</span>(<span class="st">'2021-07-12'</span>, <span class="st">'2021-07-15'</span>),</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    threshold<span class="op">=</span><span class="fl">150.0</span>,  <span class="co"># mm</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    metric<span class="op">=</span><span class="st">'cumulative'</span>,</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    duration<span class="op">=</span><span class="dv">3</span>,  <span class="co"># days</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Event: </span><span class="sc">{</span>event_2021<span class="sc">.</span>date_range[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> to </span><span class="sc">{</span>event_2021<span class="sc">.</span>date_range[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Region: </span><span class="sc">{</span>event_2021<span class="sc">.</span>region<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Threshold: </span><span class="sc">{</span>event_2021<span class="sc">.</span>threshold<span class="sc">}</span><span class="ss"> mm over </span><span class="sc">{</span>event_2021<span class="sc">.</span>duration<span class="sc">}</span><span class="ss"> days"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Event: 2021-07-12 to 2021-07-15
Region: {'lat': (48.0, 52.0), 'lon': (4.0, 9.0)}
Threshold: 150.0 mm over 3 days</code></pre>
</div>
</div>
</section>
<section id="load-era5-data" class="level3">
<h3 class="anchored" data-anchor-id="load-era5-data">Load ERA5 data</h3>
<p><strong>Note:</strong> This example assumes you have ERA5 data available. In practice, you would:</p>
<ol type="1">
<li>Download ERA5 data via CDS API, or</li>
<li>Use pre-downloaded NetCDF files, or</li>
<li>Use a data service that provides ERA5 access</li>
</ol>
<p>For demonstration, we’ll show the structure with synthetic data:</p>
<div id="4aab8620" class="cell" data-execution_count="2">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime, timedelta</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate synthetic ERA5-like data for demonstration</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"># In practice, use: load_era5_precipitation() from src.attribution.data_loading</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">42</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create date ranges</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>baseline_dates <span class="op">=</span> pd.date_range(<span class="st">'1950-01-01'</span>, <span class="st">'1980-12-31'</span>, freq<span class="op">=</span><span class="st">'D'</span>)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>recent_dates <span class="op">=</span> pd.date_range(<span class="st">'1990-01-01'</span>, <span class="st">'2023-12-31'</span>, freq<span class="op">=</span><span class="st">'D'</span>)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>event_dates <span class="op">=</span> pd.date_range(<span class="st">'2021-07-12'</span>, <span class="st">'2021-07-15'</span>, freq<span class="op">=</span><span class="st">'D'</span>)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Synthetic precipitation (gamma distribution, realistic for Europe)</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Baseline: lower mean, recent: higher mean (climate change signal)</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>baseline_precip <span class="op">=</span> np.random.gamma(shape<span class="op">=</span><span class="dv">2</span>, scale<span class="op">=</span><span class="dv">5</span>, size<span class="op">=</span><span class="bu">len</span>(baseline_dates))</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>recent_precip <span class="op">=</span> np.random.gamma(shape<span class="op">=</span><span class="dv">2</span>, scale<span class="op">=</span><span class="dv">6</span>, size<span class="op">=</span><span class="bu">len</span>(recent_dates))</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Add extreme event in 2021</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>event_precip <span class="op">=</span> np.array([<span class="dv">45</span>, <span class="dv">85</span>, <span class="dv">70</span>, <span class="dv">30</span>])  <span class="co"># mm per day, totals 230mm over 3 days</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine into DataFrames</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>baseline_data <span class="op">=</span> pd.DataFrame({</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">'date'</span>: baseline_dates,</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">'precipitation_mm'</span>: baseline_precip</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>recent_data <span class="op">=</span> pd.DataFrame({</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">'date'</span>: recent_dates,</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">'precipitation_mm'</span>: recent_precip</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Insert event into recent data</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>event_mask <span class="op">=</span> recent_data[<span class="st">'date'</span>].isin(event_dates)</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>recent_data.loc[event_mask, <span class="st">'precipitation_mm'</span>] <span class="op">=</span> event_precip</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Data loaded:"</span>)</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Baseline period: </span><span class="sc">{</span><span class="bu">len</span>(baseline_data)<span class="sc">}</span><span class="ss"> days"</span>)</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Recent period: </span><span class="sc">{</span><span class="bu">len</span>(recent_data)<span class="sc">}</span><span class="ss"> days"</span>)</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Baseline stats:"</span>)</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(baseline_data[<span class="st">'precipitation_mm'</span>].describe())</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Recent stats:"</span>)</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(recent_data[<span class="st">'precipitation_mm'</span>].describe())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Data loaded:
Baseline period: 11323 days
Recent period: 12418 days

Baseline stats:
count    11323.000000
mean        10.071010
std          7.066802
min          0.067730
25%          4.904667
50%          8.450174
75%         13.563262
max         68.473294
Name: precipitation_mm, dtype: float64

Recent stats:
count    12418.000000
mean        11.965798
std          8.540110
min          0.033139
25%          5.618902
50%          9.981399
75%         16.175604
max         85.000000
Name: precipitation_mm, dtype: float64</code></pre>
</div>
</div>
</section>
<section id="detect-the-event" class="level3">
<h3 class="anchored" data-anchor-id="detect-the-event">Detect the event</h3>
<div id="baa21b3d" class="cell" data-execution_count="3">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Add project root to Python path  </span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>project_root <span class="op">=</span> Path.cwd() <span class="cf">if</span> Path(<span class="st">'src'</span>).exists() <span class="cf">else</span> Path.cwd().parent</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>sys.path.insert(<span class="dv">0</span>, <span class="bu">str</span>(project_root))</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> src.attribution.event_definitions <span class="im">import</span> detect_rainfall_events, extract_event_data</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Detect all events matching criteria in recent period</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>recent_with_events <span class="op">=</span> detect_rainfall_events(</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    recent_data,</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    threshold<span class="op">=</span><span class="fl">150.0</span>,</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    min_duration<span class="op">=</span><span class="dv">3</span>,</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    metric<span class="op">=</span><span class="st">'cumulative'</span>,</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    duration<span class="op">=</span><span class="dv">3</span>,</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the specific 2021 event</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>event_data <span class="op">=</span> extract_event_data(recent_data, event_2021)</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"2021 Event details:"</span>)</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(event_data[[<span class="st">'date'</span>, <span class="st">'precipitation_mm'</span>]])</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Cumulative rainfall: </span><span class="sc">{</span>event_data[<span class="st">'precipitation_mm'</span>]<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.1f}</span><span class="ss"> mm"</span>)</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Event threshold: </span><span class="sc">{</span>event_2021<span class="sc">.</span>threshold<span class="sc">}</span><span class="ss"> mm"</span>)</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Event exceeded threshold: </span><span class="sc">{</span>event_data[<span class="st">'precipitation_mm'</span>]<span class="sc">.</span><span class="bu">sum</span>() <span class="op">&gt;=</span> event_2021<span class="sc">.</span>threshold<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>2021 Event details:
            date  precipitation_mm
11515 2021-07-12              45.0
11516 2021-07-13              85.0
11517 2021-07-14              70.0
11518 2021-07-15              30.0

Cumulative rainfall: 230.0 mm
Event threshold: 150.0 mm
Event exceeded threshold: True</code></pre>
</div>
</div>
</section>
<section id="calculate-attribution" class="level3">
<h3 class="anchored" data-anchor-id="calculate-attribution">Calculate attribution</h3>
<div id="aaa741a1" class="cell" data-execution_count="4">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Add project root to Python path  </span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>project_root <span class="op">=</span> Path.cwd() <span class="cf">if</span> Path(<span class="st">'src'</span>).exists() <span class="cf">else</span> Path.cwd().parent</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>sys.path.insert(<span class="dv">0</span>, <span class="bu">str</span>(project_root))</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> src.attribution.attribution_methods <span class="im">import</span> bootstrap_attribution</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate attribution with bootstrap confidence intervals</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>attribution_results <span class="op">=</span> bootstrap_attribution(</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    historical_data<span class="op">=</span>baseline_data[<span class="st">'precipitation_mm'</span>],</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    recent_data<span class="op">=</span>recent_data[<span class="st">'precipitation_mm'</span>],</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    event_threshold<span class="op">=</span><span class="fl">150.0</span>,  <span class="co"># 150mm cumulative over 3 days</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    n_bootstrap<span class="op">=</span><span class="dv">1000</span>,</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    distribution_type<span class="op">=</span><span class="st">'gamma'</span>,</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    random_seed<span class="op">=</span><span class="dv">42</span>,</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Attribution Results:"</span>)</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Fraction of Attributable Risk (FAR): </span><span class="sc">{</span>attribution_results[<span class="st">'far'</span>]<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  95% CI: [</span><span class="sc">{</span>attribution_results[<span class="st">'far_ci_lower'</span>]<span class="sc">:.3f}</span><span class="ss">, </span><span class="sc">{</span>attribution_results[<span class="st">'far_ci_upper'</span>]<span class="sc">:.3f}</span><span class="ss">]"</span>)</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Probability Ratio (PR): </span><span class="sc">{</span>attribution_results[<span class="st">'pr'</span>]<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  95% CI: [</span><span class="sc">{</span>attribution_results[<span class="st">'pr_ci_lower'</span>]<span class="sc">:.3f}</span><span class="ss">, </span><span class="sc">{</span>attribution_results[<span class="st">'pr_ci_upper'</span>]<span class="sc">:.3f}</span><span class="ss">]"</span>)</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Historical probability: </span><span class="sc">{</span>attribution_results[<span class="st">'p_historical'</span>]<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Recent probability: </span><span class="sc">{</span>attribution_results[<span class="st">'p_recent'</span>]<span class="sc">:.6f}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Attribution Results:
Fraction of Attributable Risk (FAR): 0.994
  95% CI: [0.986, 0.997]

Probability Ratio (PR): 169.764
  95% CI: [70.263, 381.230]

Historical probability: 0.000000
Recent probability: 0.000000</code></pre>
</div>
</div>
</section>
<section id="visualize-results" class="level3">
<h3 class="anchored" data-anchor-id="visualize-results">Visualize results</h3>
<div id="9ec583ec" class="cell" data-execution_count="5">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Add project root to Python path  </span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>project_root <span class="op">=</span> Path.cwd() <span class="cf">if</span> Path(<span class="st">'src'</span>).exists() <span class="cf">else</span> Path.cwd().parent</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>sys.path.insert(<span class="dv">0</span>, <span class="bu">str</span>(project_root))</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> src.attribution.visualization <span class="im">import</span> (</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    plot_precipitation_timeseries,</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    plot_distribution_comparison,</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    plot_attribution_results,</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    plot_cumulative_rainfall,</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine data for time series plot</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>all_data <span class="op">=</span> pd.concat([</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    baseline_data.assign(period<span class="op">=</span><span class="st">'baseline'</span>),</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    recent_data.assign(period<span class="op">=</span><span class="st">'recent'</span>)</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>], ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Time series with event highlighted</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">12</span>))</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Time series</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> axes[<span class="dv">0</span>, <span class="dv">0</span>]</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>plot_precipitation_timeseries(</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>    all_data,</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>    event_2021,</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>    baseline_period<span class="op">=</span>(<span class="st">'1950-01-01'</span>, <span class="st">'1980-12-31'</span>),</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>    recent_period<span class="op">=</span>(<span class="st">'1990-01-01'</span>, <span class="st">'2023-12-31'</span>),</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax1,</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Distribution comparison</span></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> axes[<span class="dv">0</span>, <span class="dv">1</span>]</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>plot_distribution_comparison(</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>    baseline_data[<span class="st">'precipitation_mm'</span>],</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>    recent_data[<span class="st">'precipitation_mm'</span>],</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>    event_threshold<span class="op">=</span><span class="fl">150.0</span>,</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax2,</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Attribution results</span></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>ax3 <span class="op">=</span> axes[<span class="dv">1</span>, <span class="dv">0</span>]</span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>plot_attribution_results(</span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>    attribution_results[<span class="st">'far'</span>],</span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>    attribution_results[<span class="st">'pr'</span>],</span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>    confidence_intervals<span class="op">=</span>{</span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>        <span class="st">'far_ci_lower'</span>: attribution_results[<span class="st">'far_ci_lower'</span>],</span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>        <span class="st">'far_ci_upper'</span>: attribution_results[<span class="st">'far_ci_upper'</span>],</span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>        <span class="st">'pr_ci_lower'</span>: attribution_results[<span class="st">'pr_ci_lower'</span>],</span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>        <span class="st">'pr_ci_upper'</span>: attribution_results[<span class="st">'pr_ci_upper'</span>],</span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax3,</span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Cumulative rainfall for event</span></span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a>ax4 <span class="op">=</span> axes[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a>plot_cumulative_rainfall(event_data, event_2021, ax<span class="op">=</span>ax4)</span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="flood-attribution-pipeline_files/figure-html/cell-6-output-1.png" width="1526" height="1142" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="interpretation" class="level3">
<h3 class="anchored" data-anchor-id="interpretation">Interpretation</h3>
<div id="fe4d848e" class="cell" data-execution_count="6">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display interpretation</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>far_pct <span class="op">=</span> attribution_results[<span class="st">'far'</span>] <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>pr_rounded <span class="op">=</span> <span class="bu">round</span>(attribution_results[<span class="st">'pr'</span>])</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Based on the attribution analysis:"</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">FAR = </span><span class="sc">{</span>attribution_results[<span class="st">'far'</span>]<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"This means approximately </span><span class="sc">{</span>far_pct<span class="sc">:.1f}</span><span class="ss">% of the risk of this event"</span>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"can be attributed to climate change."</span>)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">PR = </span><span class="sc">{</span>attribution_results[<span class="st">'pr'</span>]<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"The event is approximately </span><span class="sc">{</span>pr_rounded<span class="sc">}</span><span class="ss">x more likely in the recent period"</span>)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"compared to the historical baseline."</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Based on the attribution analysis:

FAR = 0.994
This means approximately 99.4% of the risk of this event
can be attributed to climate change.

PR = 169.764
The event is approximately 170x more likely in the recent period
compared to the historical baseline.</code></pre>
</div>
</div>
<p><strong>Note:</strong> These are synthetic results for demonstration. Real attribution requires: - Actual ERA5 data - Careful selection of baseline and recent periods - Consideration of seasonal patterns - Validation against observational data</p>
</section>
</section>
<section id="example-2-user-defined-event" class="level2">
<h2 class="anchored" data-anchor-id="example-2-user-defined-event">Example 2: User-Defined Event</h2>
<p>The pipeline is generalizable. Here’s how to analyze any rainfall event:</p>
<div id="b6eb96eb" class="cell" data-execution_count="7">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Add project root to Python path  </span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>project_root <span class="op">=</span> Path.cwd() <span class="cf">if</span> Path(<span class="st">'src'</span>).exists() <span class="cf">else</span> Path.cwd().parent</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>sys.path.insert(<span class="dv">0</span>, <span class="bu">str</span>(project_root))</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> src.attribution.event_definitions <span class="im">import</span> define_rainfall_event</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> src.attribution.data_loading <span class="im">import</span> get_historical_baseline, get_recent_period</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> src.attribution.attribution_methods <span class="im">import</span> bootstrap_attribution</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Define your event</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>my_event <span class="op">=</span> define_rainfall_event(</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    region<span class="op">=</span>{<span class="st">'lat'</span>: (<span class="fl">40.0</span>, <span class="fl">50.0</span>), <span class="st">'lon'</span>: (<span class="op">-</span><span class="fl">10.0</span>, <span class="fl">5.0</span>)},  <span class="co"># Your region</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    date_range<span class="op">=</span>(<span class="st">'2023-06-01'</span>, <span class="st">'2023-06-05'</span>),  <span class="co"># Your dates</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    threshold<span class="op">=</span><span class="fl">100.0</span>,  <span class="co"># Your threshold (mm)</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    metric<span class="op">=</span><span class="st">'cumulative'</span>,  <span class="co"># or 'intensity', 'duration'</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    duration<span class="op">=</span><span class="dv">5</span>,  <span class="co"># days</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data (replace with actual data loading)</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="co"># baseline = get_historical_baseline(my_event.region, '1950-01-01', '1980-12-31')</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a><span class="co"># recent = get_recent_period(my_event.region, '1990-01-01', '2023-12-31')</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate attribution</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a><span class="co"># results = bootstrap_attribution(</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a><span class="co">#     baseline['precipitation_mm'],</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a><span class="co">#     recent['precipitation_mm'],</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a><span class="co">#     my_event.threshold,</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a><span class="co">#     n_bootstrap=1000,</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Event defined. Next steps:"</span>)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"1. Load ERA5 data for your region"</span>)</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"2. Run attribution analysis"</span>)</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"3. Visualize results"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Event defined. Next steps:
1. Load ERA5 data for your region
2. Run attribution analysis
3. Visualize results</code></pre>
</div>
</div>
</section>
<section id="methodology-details" class="level2">
<h2 class="anchored" data-anchor-id="methodology-details">Methodology Details</h2>
<section id="statistical-approach" class="level3">
<h3 class="anchored" data-anchor-id="statistical-approach">Statistical Approach</h3>
<p><strong>Distribution Fitting:</strong> - Precipitation data is typically right-skewed with many zero values - We fit gamma distributions (common for precipitation) - Alternative: log-normal or GEV (for extremes)</p>
<p><strong>Bootstrap Confidence Intervals:</strong> - Resample data with replacement (1000 iterations) - Calculate FAR and PR for each bootstrap sample - 95% CI from percentiles (2.5th, 97.5th)</p>
<p><strong>Seasonality:</strong> - Precipitation has strong seasonal patterns - For robust attribution, compare same seasons across periods - This pipeline can be extended to handle seasonality</p>
</section>
<section id="limitations" class="level3">
<h3 class="anchored" data-anchor-id="limitations">Limitations</h3>
<ol type="1">
<li><p><strong>Precipitation vs Floods</strong>: This analyzes rainfall extremes, not actual flood impacts. Floods depend on:</p>
<ul>
<li>Runoff and drainage</li>
<li>Soil moisture and saturation</li>
<li>Infrastructure and land use</li>
<li>River discharge and capacity</li>
</ul></li>
<li><p><strong>Reanalysis Data</strong>: ERA5 is a model-based reanalysis, not pure observations. It may have biases, especially for:</p>
<ul>
<li>Extreme events</li>
<li>Mountainous regions</li>
<li>Coastal areas</li>
</ul></li>
<li><p><strong>Non-Stationarity</strong>: Assumes distributions are stationary within each period. Climate change may introduce trends even within “recent” period.</p></li>
<li><p><strong>Regional Specificity</strong>: Results are for the defined region. Local factors (urbanization, land use changes) are not accounted for.</p></li>
</ol>
</section>
</section>
<section id="extensions-and-future-work" class="level2">
<h2 class="anchored" data-anchor-id="extensions-and-future-work">Extensions and Future Work</h2>
<p><strong>Possible extensions:</strong></p>
<ol type="1">
<li><strong>Add observational data</strong>: Compare ERA5 with station observations</li>
<li><strong>CMIP6 integration</strong>: Use climate model ensembles for counterfactual analysis</li>
<li><strong>Compound events</strong>: Include antecedent soil moisture, temperature</li>
<li><strong>Spatial analysis</strong>: Map attribution results across regions</li>
<li><strong>Seasonal attribution</strong>: Separate analysis by season</li>
<li><strong>Flood impact modeling</strong>: Connect precipitation to actual flood risk</li>
</ol>
<p><strong>References:</strong></p>
<ul>
<li>Stott et al.&nbsp;(2016). “Attribution of extreme weather and climate-related events.” <em>WIREs Climate Change</em></li>
<li>National Academies (2016). <em>Attribution of Extreme Weather Events in the Context of Climate Change</em></li>
<li>World Weather Attribution: <a href="https://www.worldweatherattribution.org/">worldweatherattribution.org</a></li>
</ul>
</section>
<section id="integration-with-other-content" class="level2">
<h2 class="anchored" data-anchor-id="integration-with-other-content">Integration with Other Content</h2>
<p>This pipeline connects to:</p>
<ul>
<li><a href="../notes/risk-series-2.html">Risk Series Part 2</a> - Data sources for climate risk</li>
<li><a href="../notes/climate/monte-carlo-basics.html">Monte Carlo Basics</a> - Bootstrap methods used here</li>
<li><a href="../work/heatwave-prices-de-lu.html">Heatwave Analysis</a> - Similar event definition patterns</li>
</ul>
<section id="related" class="level4 backlinks">
<h4 class="anchored" data-anchor-id="related">Related</h4>
<ul>
<li><a href="../notes/risk-series-1.html">Risk Modelling Series</a> - Foundations of risk modeling</li>
<li><a href="../notes/climate/monte-carlo-basics.html">Monte Carlo Basics</a> - Statistical methods</li>
</ul>
</section>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/recurrentanalytics\.com");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb14" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Extreme Rainfall Attribution Pipeline"</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> 2025-01-15</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span><span class="co"> [attribution, extremes, climate-risk]</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="an">jupyter:</span><span class="co"> python3</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co">  echo: true</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co">  warning: false</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co">  error: true</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="co">  output: true</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="co">  fig-width: 10</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="co">  fig-height: 6</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="co">    code-copy: true</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="co">    code-overflow: wrap</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="co">    include-in-header:</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="co">      text: |</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="co">        &lt;!-- D3.js for network graph --&gt;</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a><span class="co">        &lt;script src="https://d3js.org/d3.v7.min.js"&gt;&lt;/script&gt;</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a><span class="co">        &lt;!-- Graph script - same as global header --&gt;</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a><span class="co">        &lt;script src="../assets/graph-script.js" defer&gt;&lt;/script&gt;</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a><span class="co">        &lt;script&gt;</span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a><span class="co">        // Fallback: ensure graph loads even if main script fails</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a><span class="co">        window.addEventListener('load', function() {</span></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a><span class="co">          if (!document.getElementById('mini-graph-container')) {</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a><span class="co">            setTimeout(function() {</span></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a><span class="co">              const script = document.createElement('script');</span></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a><span class="co">              script.src = '../assets/graph-script.js';</span></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a><span class="co">              document.head.appendChild(script);</span></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a><span class="co">            }, 500);</span></span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a><span class="co">          }</span></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a><span class="co">        });</span></span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a><span class="co">        &lt;/script&gt;</span></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a><span class="co">        &lt;style&gt;</span></span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a><span class="co">        /* Prevent scrolling in code output areas */</span></span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a><span class="co">        .cell-output,</span></span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a><span class="co">        .cell-output-stdout,</span></span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a><span class="co">        .cell-output-display,</span></span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a><span class="co">        .cell-output-error,</span></span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a><span class="co">        .cell-output-warning {</span></span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a><span class="co">          overflow: visible !important;</span></span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a><span class="co">          max-height: none !important;</span></span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a><span class="co">          white-space: pre-wrap;</span></span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a><span class="co">          word-wrap: break-word;</span></span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a><span class="co">        }</span></span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a><span class="co">        pre.sourceCode,</span></span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a><span class="co">        pre code {</span></span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a><span class="co">          overflow: visible !important;</span></span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a><span class="co">          max-height: none !important;</span></span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a><span class="co">        }</span></span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a><span class="co">        /* Ensure output containers don't scroll */</span></span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a><span class="co">        .cell-output &gt; pre,</span></span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a><span class="co">        .cell-output-stdout &gt; pre {</span></span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a><span class="co">          overflow: visible !important;</span></span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a><span class="co">          max-height: none !important;</span></span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a><span class="co">        }</span></span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a><span class="co">        /* Better spacing and layout for code cells */</span></span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a><span class="co">        .cell {</span></span>
<span id="cb14-66"><a href="#cb14-66" aria-hidden="true" tabindex="-1"></a><span class="co">          margin: 2rem 0;</span></span>
<span id="cb14-67"><a href="#cb14-67" aria-hidden="true" tabindex="-1"></a><span class="co">        }</span></span>
<span id="cb14-68"><a href="#cb14-68" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb14-69"><a href="#cb14-69" aria-hidden="true" tabindex="-1"></a><span class="co">        .cell-code {</span></span>
<span id="cb14-70"><a href="#cb14-70" aria-hidden="true" tabindex="-1"></a><span class="co">          margin-bottom: 0.5rem;</span></span>
<span id="cb14-71"><a href="#cb14-71" aria-hidden="true" tabindex="-1"></a><span class="co">        }</span></span>
<span id="cb14-72"><a href="#cb14-72" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb14-73"><a href="#cb14-73" aria-hidden="true" tabindex="-1"></a><span class="co">        /* Text output styling */</span></span>
<span id="cb14-74"><a href="#cb14-74" aria-hidden="true" tabindex="-1"></a><span class="co">        .cell-output-stdout {</span></span>
<span id="cb14-75"><a href="#cb14-75" aria-hidden="true" tabindex="-1"></a><span class="co">          margin-top: 0.75rem;</span></span>
<span id="cb14-76"><a href="#cb14-76" aria-hidden="true" tabindex="-1"></a><span class="co">          padding: 1rem;</span></span>
<span id="cb14-77"><a href="#cb14-77" aria-hidden="true" tabindex="-1"></a><span class="co">          background: var(--bs-tertiary-bg, #f8f9fa);</span></span>
<span id="cb14-78"><a href="#cb14-78" aria-hidden="true" tabindex="-1"></a><span class="co">          border-radius: 0.375rem;</span></span>
<span id="cb14-79"><a href="#cb14-79" aria-hidden="true" tabindex="-1"></a><span class="co">          border-left: 3px solid var(--bs-primary, #0d6efd);</span></span>
<span id="cb14-80"><a href="#cb14-80" aria-hidden="true" tabindex="-1"></a><span class="co">        }</span></span>
<span id="cb14-81"><a href="#cb14-81" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb14-82"><a href="#cb14-82" aria-hidden="true" tabindex="-1"></a><span class="co">        .cell-output-stdout pre {</span></span>
<span id="cb14-83"><a href="#cb14-83" aria-hidden="true" tabindex="-1"></a><span class="co">          margin: 0;</span></span>
<span id="cb14-84"><a href="#cb14-84" aria-hidden="true" tabindex="-1"></a><span class="co">          padding: 0;</span></span>
<span id="cb14-85"><a href="#cb14-85" aria-hidden="true" tabindex="-1"></a><span class="co">          background: transparent;</span></span>
<span id="cb14-86"><a href="#cb14-86" aria-hidden="true" tabindex="-1"></a><span class="co">          border: none;</span></span>
<span id="cb14-87"><a href="#cb14-87" aria-hidden="true" tabindex="-1"></a><span class="co">          font-size: 0.9rem;</span></span>
<span id="cb14-88"><a href="#cb14-88" aria-hidden="true" tabindex="-1"></a><span class="co">          line-height: 1.6;</span></span>
<span id="cb14-89"><a href="#cb14-89" aria-hidden="true" tabindex="-1"></a><span class="co">        }</span></span>
<span id="cb14-90"><a href="#cb14-90" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb14-91"><a href="#cb14-91" aria-hidden="true" tabindex="-1"></a><span class="co">        /* Visual output styling - better stacking */</span></span>
<span id="cb14-92"><a href="#cb14-92" aria-hidden="true" tabindex="-1"></a><span class="co">        .cell-output-display {</span></span>
<span id="cb14-93"><a href="#cb14-93" aria-hidden="true" tabindex="-1"></a><span class="co">          margin-top: 1rem;</span></span>
<span id="cb14-94"><a href="#cb14-94" aria-hidden="true" tabindex="-1"></a><span class="co">          margin-bottom: 0;</span></span>
<span id="cb14-95"><a href="#cb14-95" aria-hidden="true" tabindex="-1"></a><span class="co">        }</span></span>
<span id="cb14-96"><a href="#cb14-96" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb14-97"><a href="#cb14-97" aria-hidden="true" tabindex="-1"></a><span class="co">        .cell-output-display figure {</span></span>
<span id="cb14-98"><a href="#cb14-98" aria-hidden="true" tabindex="-1"></a><span class="co">          margin: 0;</span></span>
<span id="cb14-99"><a href="#cb14-99" aria-hidden="true" tabindex="-1"></a><span class="co">          padding: 0;</span></span>
<span id="cb14-100"><a href="#cb14-100" aria-hidden="true" tabindex="-1"></a><span class="co">        }</span></span>
<span id="cb14-101"><a href="#cb14-101" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb14-102"><a href="#cb14-102" aria-hidden="true" tabindex="-1"></a><span class="co">        .cell-output-display .figure-img {</span></span>
<span id="cb14-103"><a href="#cb14-103" aria-hidden="true" tabindex="-1"></a><span class="co">          max-width: 100%;</span></span>
<span id="cb14-104"><a href="#cb14-104" aria-hidden="true" tabindex="-1"></a><span class="co">          height: auto;</span></span>
<span id="cb14-105"><a href="#cb14-105" aria-hidden="true" tabindex="-1"></a><span class="co">          display: block;</span></span>
<span id="cb14-106"><a href="#cb14-106" aria-hidden="true" tabindex="-1"></a><span class="co">          margin: 0 auto;</span></span>
<span id="cb14-107"><a href="#cb14-107" aria-hidden="true" tabindex="-1"></a><span class="co">          border-radius: 0.375rem;</span></span>
<span id="cb14-108"><a href="#cb14-108" aria-hidden="true" tabindex="-1"></a><span class="co">          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);</span></span>
<span id="cb14-109"><a href="#cb14-109" aria-hidden="true" tabindex="-1"></a><span class="co">          cursor: pointer;</span></span>
<span id="cb14-110"><a href="#cb14-110" aria-hidden="true" tabindex="-1"></a><span class="co">          transition: transform 0.2s ease, box-shadow 0.2s ease;</span></span>
<span id="cb14-111"><a href="#cb14-111" aria-hidden="true" tabindex="-1"></a><span class="co">        }</span></span>
<span id="cb14-112"><a href="#cb14-112" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb14-113"><a href="#cb14-113" aria-hidden="true" tabindex="-1"></a><span class="co">        .cell-output-display .figure-img:hover {</span></span>
<span id="cb14-114"><a href="#cb14-114" aria-hidden="true" tabindex="-1"></a><span class="co">          transform: scale(1.02);</span></span>
<span id="cb14-115"><a href="#cb14-115" aria-hidden="true" tabindex="-1"></a><span class="co">          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);</span></span>
<span id="cb14-116"><a href="#cb14-116" aria-hidden="true" tabindex="-1"></a><span class="co">        }</span></span>
<span id="cb14-117"><a href="#cb14-117" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb14-118"><a href="#cb14-118" aria-hidden="true" tabindex="-1"></a><span class="co">        /* Lightbox modal */</span></span>
<span id="cb14-119"><a href="#cb14-119" aria-hidden="true" tabindex="-1"></a><span class="co">        .figure-lightbox {</span></span>
<span id="cb14-120"><a href="#cb14-120" aria-hidden="true" tabindex="-1"></a><span class="co">          display: none;</span></span>
<span id="cb14-121"><a href="#cb14-121" aria-hidden="true" tabindex="-1"></a><span class="co">          position: fixed;</span></span>
<span id="cb14-122"><a href="#cb14-122" aria-hidden="true" tabindex="-1"></a><span class="co">          z-index: 10000;</span></span>
<span id="cb14-123"><a href="#cb14-123" aria-hidden="true" tabindex="-1"></a><span class="co">          left: 0;</span></span>
<span id="cb14-124"><a href="#cb14-124" aria-hidden="true" tabindex="-1"></a><span class="co">          top: 0;</span></span>
<span id="cb14-125"><a href="#cb14-125" aria-hidden="true" tabindex="-1"></a><span class="co">          width: 100%;</span></span>
<span id="cb14-126"><a href="#cb14-126" aria-hidden="true" tabindex="-1"></a><span class="co">          height: 100%;</span></span>
<span id="cb14-127"><a href="#cb14-127" aria-hidden="true" tabindex="-1"></a><span class="co">          background-color: rgba(0, 0, 0, 0.9);</span></span>
<span id="cb14-128"><a href="#cb14-128" aria-hidden="true" tabindex="-1"></a><span class="co">          backdrop-filter: blur(4px);</span></span>
<span id="cb14-129"><a href="#cb14-129" aria-hidden="true" tabindex="-1"></a><span class="co">          animation: fadeIn 0.2s ease;</span></span>
<span id="cb14-130"><a href="#cb14-130" aria-hidden="true" tabindex="-1"></a><span class="co">        }</span></span>
<span id="cb14-131"><a href="#cb14-131" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb14-132"><a href="#cb14-132" aria-hidden="true" tabindex="-1"></a><span class="co">        .figure-lightbox.active {</span></span>
<span id="cb14-133"><a href="#cb14-133" aria-hidden="true" tabindex="-1"></a><span class="co">          display: flex;</span></span>
<span id="cb14-134"><a href="#cb14-134" aria-hidden="true" tabindex="-1"></a><span class="co">          align-items: center;</span></span>
<span id="cb14-135"><a href="#cb14-135" aria-hidden="true" tabindex="-1"></a><span class="co">          justify-content: center;</span></span>
<span id="cb14-136"><a href="#cb14-136" aria-hidden="true" tabindex="-1"></a><span class="co">        }</span></span>
<span id="cb14-137"><a href="#cb14-137" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb14-138"><a href="#cb14-138" aria-hidden="true" tabindex="-1"></a><span class="co">        @keyframes fadeIn {</span></span>
<span id="cb14-139"><a href="#cb14-139" aria-hidden="true" tabindex="-1"></a><span class="co">          from { opacity: 0; }</span></span>
<span id="cb14-140"><a href="#cb14-140" aria-hidden="true" tabindex="-1"></a><span class="co">          to { opacity: 1; }</span></span>
<span id="cb14-141"><a href="#cb14-141" aria-hidden="true" tabindex="-1"></a><span class="co">        }</span></span>
<span id="cb14-142"><a href="#cb14-142" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb14-143"><a href="#cb14-143" aria-hidden="true" tabindex="-1"></a><span class="co">        .figure-lightbox-content {</span></span>
<span id="cb14-144"><a href="#cb14-144" aria-hidden="true" tabindex="-1"></a><span class="co">          position: relative;</span></span>
<span id="cb14-145"><a href="#cb14-145" aria-hidden="true" tabindex="-1"></a><span class="co">          max-width: 95%;</span></span>
<span id="cb14-146"><a href="#cb14-146" aria-hidden="true" tabindex="-1"></a><span class="co">          max-height: 95vh;</span></span>
<span id="cb14-147"><a href="#cb14-147" aria-hidden="true" tabindex="-1"></a><span class="co">          margin: auto;</span></span>
<span id="cb14-148"><a href="#cb14-148" aria-hidden="true" tabindex="-1"></a><span class="co">          animation: zoomIn 0.2s ease;</span></span>
<span id="cb14-149"><a href="#cb14-149" aria-hidden="true" tabindex="-1"></a><span class="co">        }</span></span>
<span id="cb14-150"><a href="#cb14-150" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb14-151"><a href="#cb14-151" aria-hidden="true" tabindex="-1"></a><span class="co">        @keyframes zoomIn {</span></span>
<span id="cb14-152"><a href="#cb14-152" aria-hidden="true" tabindex="-1"></a><span class="co">          from { transform: scale(0.9); opacity: 0; }</span></span>
<span id="cb14-153"><a href="#cb14-153" aria-hidden="true" tabindex="-1"></a><span class="co">          to { transform: scale(1); opacity: 1; }</span></span>
<span id="cb14-154"><a href="#cb14-154" aria-hidden="true" tabindex="-1"></a><span class="co">        }</span></span>
<span id="cb14-155"><a href="#cb14-155" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb14-156"><a href="#cb14-156" aria-hidden="true" tabindex="-1"></a><span class="co">        .figure-lightbox-img {</span></span>
<span id="cb14-157"><a href="#cb14-157" aria-hidden="true" tabindex="-1"></a><span class="co">          max-width: 100%;</span></span>
<span id="cb14-158"><a href="#cb14-158" aria-hidden="true" tabindex="-1"></a><span class="co">          max-height: 95vh;</span></span>
<span id="cb14-159"><a href="#cb14-159" aria-hidden="true" tabindex="-1"></a><span class="co">          width: auto;</span></span>
<span id="cb14-160"><a href="#cb14-160" aria-hidden="true" tabindex="-1"></a><span class="co">          height: auto;</span></span>
<span id="cb14-161"><a href="#cb14-161" aria-hidden="true" tabindex="-1"></a><span class="co">          border-radius: 0.5rem;</span></span>
<span id="cb14-162"><a href="#cb14-162" aria-hidden="true" tabindex="-1"></a><span class="co">          box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);</span></span>
<span id="cb14-163"><a href="#cb14-163" aria-hidden="true" tabindex="-1"></a><span class="co">        }</span></span>
<span id="cb14-164"><a href="#cb14-164" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb14-165"><a href="#cb14-165" aria-hidden="true" tabindex="-1"></a><span class="co">        .figure-lightbox-close {</span></span>
<span id="cb14-166"><a href="#cb14-166" aria-hidden="true" tabindex="-1"></a><span class="co">          position: absolute;</span></span>
<span id="cb14-167"><a href="#cb14-167" aria-hidden="true" tabindex="-1"></a><span class="co">          top: -2.5rem;</span></span>
<span id="cb14-168"><a href="#cb14-168" aria-hidden="true" tabindex="-1"></a><span class="co">          right: 0;</span></span>
<span id="cb14-169"><a href="#cb14-169" aria-hidden="true" tabindex="-1"></a><span class="co">          color: white;</span></span>
<span id="cb14-170"><a href="#cb14-170" aria-hidden="true" tabindex="-1"></a><span class="co">          font-size: 2rem;</span></span>
<span id="cb14-171"><a href="#cb14-171" aria-hidden="true" tabindex="-1"></a><span class="co">          font-weight: bold;</span></span>
<span id="cb14-172"><a href="#cb14-172" aria-hidden="true" tabindex="-1"></a><span class="co">          cursor: pointer;</span></span>
<span id="cb14-173"><a href="#cb14-173" aria-hidden="true" tabindex="-1"></a><span class="co">          background: rgba(0, 0, 0, 0.5);</span></span>
<span id="cb14-174"><a href="#cb14-174" aria-hidden="true" tabindex="-1"></a><span class="co">          border: none;</span></span>
<span id="cb14-175"><a href="#cb14-175" aria-hidden="true" tabindex="-1"></a><span class="co">          border-radius: 50%;</span></span>
<span id="cb14-176"><a href="#cb14-176" aria-hidden="true" tabindex="-1"></a><span class="co">          width: 2.5rem;</span></span>
<span id="cb14-177"><a href="#cb14-177" aria-hidden="true" tabindex="-1"></a><span class="co">          height: 2.5rem;</span></span>
<span id="cb14-178"><a href="#cb14-178" aria-hidden="true" tabindex="-1"></a><span class="co">          display: flex;</span></span>
<span id="cb14-179"><a href="#cb14-179" aria-hidden="true" tabindex="-1"></a><span class="co">          align-items: center;</span></span>
<span id="cb14-180"><a href="#cb14-180" aria-hidden="true" tabindex="-1"></a><span class="co">          justify-content: center;</span></span>
<span id="cb14-181"><a href="#cb14-181" aria-hidden="true" tabindex="-1"></a><span class="co">          transition: background 0.2s ease;</span></span>
<span id="cb14-182"><a href="#cb14-182" aria-hidden="true" tabindex="-1"></a><span class="co">        }</span></span>
<span id="cb14-183"><a href="#cb14-183" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb14-184"><a href="#cb14-184" aria-hidden="true" tabindex="-1"></a><span class="co">        .figure-lightbox-close:hover {</span></span>
<span id="cb14-185"><a href="#cb14-185" aria-hidden="true" tabindex="-1"></a><span class="co">          background: rgba(0, 0, 0, 0.8);</span></span>
<span id="cb14-186"><a href="#cb14-186" aria-hidden="true" tabindex="-1"></a><span class="co">        }</span></span>
<span id="cb14-187"><a href="#cb14-187" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb14-188"><a href="#cb14-188" aria-hidden="true" tabindex="-1"></a><span class="co">        .figure-lightbox-close:focus {</span></span>
<span id="cb14-189"><a href="#cb14-189" aria-hidden="true" tabindex="-1"></a><span class="co">          outline: 2px solid white;</span></span>
<span id="cb14-190"><a href="#cb14-190" aria-hidden="true" tabindex="-1"></a><span class="co">          outline-offset: 2px;</span></span>
<span id="cb14-191"><a href="#cb14-191" aria-hidden="true" tabindex="-1"></a><span class="co">        }</span></span>
<span id="cb14-192"><a href="#cb14-192" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb14-193"><a href="#cb14-193" aria-hidden="true" tabindex="-1"></a><span class="co">        @media (max-width: 768px) {</span></span>
<span id="cb14-194"><a href="#cb14-194" aria-hidden="true" tabindex="-1"></a><span class="co">          .figure-lightbox-content {</span></span>
<span id="cb14-195"><a href="#cb14-195" aria-hidden="true" tabindex="-1"></a><span class="co">            max-width: 98%;</span></span>
<span id="cb14-196"><a href="#cb14-196" aria-hidden="true" tabindex="-1"></a><span class="co">          }</span></span>
<span id="cb14-197"><a href="#cb14-197" aria-hidden="true" tabindex="-1"></a><span class="co">          </span></span>
<span id="cb14-198"><a href="#cb14-198" aria-hidden="true" tabindex="-1"></a><span class="co">          .figure-lightbox-close {</span></span>
<span id="cb14-199"><a href="#cb14-199" aria-hidden="true" tabindex="-1"></a><span class="co">            top: 1rem;</span></span>
<span id="cb14-200"><a href="#cb14-200" aria-hidden="true" tabindex="-1"></a><span class="co">            right: 1rem;</span></span>
<span id="cb14-201"><a href="#cb14-201" aria-hidden="true" tabindex="-1"></a><span class="co">          }</span></span>
<span id="cb14-202"><a href="#cb14-202" aria-hidden="true" tabindex="-1"></a><span class="co">        }</span></span>
<span id="cb14-203"><a href="#cb14-203" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb14-204"><a href="#cb14-204" aria-hidden="true" tabindex="-1"></a><span class="co">        /* Better separation between code and output */</span></span>
<span id="cb14-205"><a href="#cb14-205" aria-hidden="true" tabindex="-1"></a><span class="co">        .cell-code + .cell-output {</span></span>
<span id="cb14-206"><a href="#cb14-206" aria-hidden="true" tabindex="-1"></a><span class="co">          margin-top: 0.75rem;</span></span>
<span id="cb14-207"><a href="#cb14-207" aria-hidden="true" tabindex="-1"></a><span class="co">        }</span></span>
<span id="cb14-208"><a href="#cb14-208" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb14-209"><a href="#cb14-209" aria-hidden="true" tabindex="-1"></a><span class="co">        /* Error output styling */</span></span>
<span id="cb14-210"><a href="#cb14-210" aria-hidden="true" tabindex="-1"></a><span class="co">        .cell-output-error {</span></span>
<span id="cb14-211"><a href="#cb14-211" aria-hidden="true" tabindex="-1"></a><span class="co">          margin-top: 0.75rem;</span></span>
<span id="cb14-212"><a href="#cb14-212" aria-hidden="true" tabindex="-1"></a><span class="co">          padding: 1rem;</span></span>
<span id="cb14-213"><a href="#cb14-213" aria-hidden="true" tabindex="-1"></a><span class="co">          background: var(--bs-danger-bg-subtle, #f8d7da);</span></span>
<span id="cb14-214"><a href="#cb14-214" aria-hidden="true" tabindex="-1"></a><span class="co">          border-radius: 0.375rem;</span></span>
<span id="cb14-215"><a href="#cb14-215" aria-hidden="true" tabindex="-1"></a><span class="co">          border-left: 3px solid var(--bs-danger, #dc3545);</span></span>
<span id="cb14-216"><a href="#cb14-216" aria-hidden="true" tabindex="-1"></a><span class="co">          color: var(--bs-danger-text-emphasis, #721c24);</span></span>
<span id="cb14-217"><a href="#cb14-217" aria-hidden="true" tabindex="-1"></a><span class="co">        }</span></span>
<span id="cb14-218"><a href="#cb14-218" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb14-219"><a href="#cb14-219" aria-hidden="true" tabindex="-1"></a><span class="co">        .cell-output-error pre {</span></span>
<span id="cb14-220"><a href="#cb14-220" aria-hidden="true" tabindex="-1"></a><span class="co">          margin: 0;</span></span>
<span id="cb14-221"><a href="#cb14-221" aria-hidden="true" tabindex="-1"></a><span class="co">          padding: 0;</span></span>
<span id="cb14-222"><a href="#cb14-222" aria-hidden="true" tabindex="-1"></a><span class="co">          background: transparent;</span></span>
<span id="cb14-223"><a href="#cb14-223" aria-hidden="true" tabindex="-1"></a><span class="co">          border: none;</span></span>
<span id="cb14-224"><a href="#cb14-224" aria-hidden="true" tabindex="-1"></a><span class="co">        }</span></span>
<span id="cb14-225"><a href="#cb14-225" aria-hidden="true" tabindex="-1"></a><span class="co">        &lt;/style&gt;</span></span>
<span id="cb14-226"><a href="#cb14-226" aria-hidden="true" tabindex="-1"></a><span class="co">        &lt;script&gt;</span></span>
<span id="cb14-227"><a href="#cb14-227" aria-hidden="true" tabindex="-1"></a><span class="co">        document.addEventListener('DOMContentLoaded', function() {</span></span>
<span id="cb14-228"><a href="#cb14-228" aria-hidden="true" tabindex="-1"></a><span class="co">          // Create lightbox container</span></span>
<span id="cb14-229"><a href="#cb14-229" aria-hidden="true" tabindex="-1"></a><span class="co">          const lightbox = document.createElement('div');</span></span>
<span id="cb14-230"><a href="#cb14-230" aria-hidden="true" tabindex="-1"></a><span class="co">          lightbox.className = 'figure-lightbox';</span></span>
<span id="cb14-231"><a href="#cb14-231" aria-hidden="true" tabindex="-1"></a><span class="co">          lightbox.innerHTML = `</span></span>
<span id="cb14-232"><a href="#cb14-232" aria-hidden="true" tabindex="-1"></a><span class="co">            &lt;div class="figure-lightbox-content"&gt;</span></span>
<span id="cb14-233"><a href="#cb14-233" aria-hidden="true" tabindex="-1"></a><span class="co">              &lt;button class="figure-lightbox-close" aria-label="Close"&gt;&amp;times;&lt;/button&gt;</span></span>
<span id="cb14-234"><a href="#cb14-234" aria-hidden="true" tabindex="-1"></a><span class="co">              &lt;img class="figure-lightbox-img" src="" alt="Enlarged figure"&gt;</span></span>
<span id="cb14-235"><a href="#cb14-235" aria-hidden="true" tabindex="-1"></a><span class="co">            &lt;/div&gt;</span></span>
<span id="cb14-236"><a href="#cb14-236" aria-hidden="true" tabindex="-1"></a><span class="co">          `;</span></span>
<span id="cb14-237"><a href="#cb14-237" aria-hidden="true" tabindex="-1"></a><span class="co">          document.body.appendChild(lightbox);</span></span>
<span id="cb14-238"><a href="#cb14-238" aria-hidden="true" tabindex="-1"></a><span class="co">          </span></span>
<span id="cb14-239"><a href="#cb14-239" aria-hidden="true" tabindex="-1"></a><span class="co">          const lightboxImg = lightbox.querySelector('.figure-lightbox-img');</span></span>
<span id="cb14-240"><a href="#cb14-240" aria-hidden="true" tabindex="-1"></a><span class="co">          const lightboxClose = lightbox.querySelector('.figure-lightbox-close');</span></span>
<span id="cb14-241"><a href="#cb14-241" aria-hidden="true" tabindex="-1"></a><span class="co">          </span></span>
<span id="cb14-242"><a href="#cb14-242" aria-hidden="true" tabindex="-1"></a><span class="co">          // Make all figure images clickable</span></span>
<span id="cb14-243"><a href="#cb14-243" aria-hidden="true" tabindex="-1"></a><span class="co">          document.querySelectorAll('.cell-output-display .figure-img').forEach(img =&gt; {</span></span>
<span id="cb14-244"><a href="#cb14-244" aria-hidden="true" tabindex="-1"></a><span class="co">            img.style.cursor = 'pointer';</span></span>
<span id="cb14-245"><a href="#cb14-245" aria-hidden="true" tabindex="-1"></a><span class="co">            img.setAttribute('title', 'Click to enlarge');</span></span>
<span id="cb14-246"><a href="#cb14-246" aria-hidden="true" tabindex="-1"></a><span class="co">            </span></span>
<span id="cb14-247"><a href="#cb14-247" aria-hidden="true" tabindex="-1"></a><span class="co">            img.addEventListener('click', function(e) {</span></span>
<span id="cb14-248"><a href="#cb14-248" aria-hidden="true" tabindex="-1"></a><span class="co">              e.stopPropagation();</span></span>
<span id="cb14-249"><a href="#cb14-249" aria-hidden="true" tabindex="-1"></a><span class="co">              lightboxImg.src = this.src;</span></span>
<span id="cb14-250"><a href="#cb14-250" aria-hidden="true" tabindex="-1"></a><span class="co">              lightboxImg.alt = this.alt || 'Enlarged figure';</span></span>
<span id="cb14-251"><a href="#cb14-251" aria-hidden="true" tabindex="-1"></a><span class="co">              lightbox.classList.add('active');</span></span>
<span id="cb14-252"><a href="#cb14-252" aria-hidden="true" tabindex="-1"></a><span class="co">              document.body.style.overflow = 'hidden';</span></span>
<span id="cb14-253"><a href="#cb14-253" aria-hidden="true" tabindex="-1"></a><span class="co">            });</span></span>
<span id="cb14-254"><a href="#cb14-254" aria-hidden="true" tabindex="-1"></a><span class="co">          });</span></span>
<span id="cb14-255"><a href="#cb14-255" aria-hidden="true" tabindex="-1"></a><span class="co">          </span></span>
<span id="cb14-256"><a href="#cb14-256" aria-hidden="true" tabindex="-1"></a><span class="co">          // Close lightbox</span></span>
<span id="cb14-257"><a href="#cb14-257" aria-hidden="true" tabindex="-1"></a><span class="co">          function closeLightbox() {</span></span>
<span id="cb14-258"><a href="#cb14-258" aria-hidden="true" tabindex="-1"></a><span class="co">            lightbox.classList.remove('active');</span></span>
<span id="cb14-259"><a href="#cb14-259" aria-hidden="true" tabindex="-1"></a><span class="co">            document.body.style.overflow = '';</span></span>
<span id="cb14-260"><a href="#cb14-260" aria-hidden="true" tabindex="-1"></a><span class="co">          }</span></span>
<span id="cb14-261"><a href="#cb14-261" aria-hidden="true" tabindex="-1"></a><span class="co">          </span></span>
<span id="cb14-262"><a href="#cb14-262" aria-hidden="true" tabindex="-1"></a><span class="co">          lightboxClose.addEventListener('click', closeLightbox);</span></span>
<span id="cb14-263"><a href="#cb14-263" aria-hidden="true" tabindex="-1"></a><span class="co">          </span></span>
<span id="cb14-264"><a href="#cb14-264" aria-hidden="true" tabindex="-1"></a><span class="co">          lightbox.addEventListener('click', function(e) {</span></span>
<span id="cb14-265"><a href="#cb14-265" aria-hidden="true" tabindex="-1"></a><span class="co">            if (e.target === lightbox) {</span></span>
<span id="cb14-266"><a href="#cb14-266" aria-hidden="true" tabindex="-1"></a><span class="co">              closeLightbox();</span></span>
<span id="cb14-267"><a href="#cb14-267" aria-hidden="true" tabindex="-1"></a><span class="co">            }</span></span>
<span id="cb14-268"><a href="#cb14-268" aria-hidden="true" tabindex="-1"></a><span class="co">          });</span></span>
<span id="cb14-269"><a href="#cb14-269" aria-hidden="true" tabindex="-1"></a><span class="co">          </span></span>
<span id="cb14-270"><a href="#cb14-270" aria-hidden="true" tabindex="-1"></a><span class="co">          // Close on Escape key</span></span>
<span id="cb14-271"><a href="#cb14-271" aria-hidden="true" tabindex="-1"></a><span class="co">          document.addEventListener('keydown', function(e) {</span></span>
<span id="cb14-272"><a href="#cb14-272" aria-hidden="true" tabindex="-1"></a><span class="co">            if (e.key === 'Escape' &amp;&amp; lightbox.classList.contains('active')) {</span></span>
<span id="cb14-273"><a href="#cb14-273" aria-hidden="true" tabindex="-1"></a><span class="co">              closeLightbox();</span></span>
<span id="cb14-274"><a href="#cb14-274" aria-hidden="true" tabindex="-1"></a><span class="co">            }</span></span>
<span id="cb14-275"><a href="#cb14-275" aria-hidden="true" tabindex="-1"></a><span class="co">          });</span></span>
<span id="cb14-276"><a href="#cb14-276" aria-hidden="true" tabindex="-1"></a><span class="co">        });</span></span>
<span id="cb14-277"><a href="#cb14-277" aria-hidden="true" tabindex="-1"></a><span class="co">        &lt;/script&gt;</span></span>
<span id="cb14-278"><a href="#cb14-278" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb14-279"><a href="#cb14-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-280"><a href="#cb14-280" aria-hidden="true" tabindex="-1"></a><span class="fu">## Why this pipeline exists</span></span>
<span id="cb14-281"><a href="#cb14-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-282"><a href="#cb14-282" aria-hidden="true" tabindex="-1"></a>This pipeline quantifies how climate change altered the probability and intensity of extreme rainfall events. It implements standard attribution methods (Fraction of Attributable Risk and Probability Ratio) using ERA5 reanalysis data.</span>
<span id="cb14-283"><a href="#cb14-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-284"><a href="#cb14-284" aria-hidden="true" tabindex="-1"></a>**Code Execution:** All code cells are executed when the page is rendered. The code and its output are shown together, making it easy to see what each step does.</span>
<span id="cb14-285"><a href="#cb14-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-286"><a href="#cb14-286" aria-hidden="true" tabindex="-1"></a>**What this does:**</span>
<span id="cb14-287"><a href="#cb14-287" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Analyzes precipitation extremes (not flood impacts directly)</span>
<span id="cb14-288"><a href="#cb14-288" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Calculates attribution metrics with uncertainty quantification</span>
<span id="cb14-289"><a href="#cb14-289" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Works for any region, date range, and event definition</span>
<span id="cb14-290"><a href="#cb14-290" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Reproducible and inspectable</span>
<span id="cb14-291"><a href="#cb14-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-292"><a href="#cb14-292" aria-hidden="true" tabindex="-1"></a>**What this doesn't do:**</span>
<span id="cb14-293"><a href="#cb14-293" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Model actual flood impacts (runoff, infrastructure vulnerability)</span>
<span id="cb14-294"><a href="#cb14-294" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Provide causal attribution (this is statistical attribution)</span>
<span id="cb14-295"><a href="#cb14-295" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Account for all regional/local factors</span>
<span id="cb14-296"><a href="#cb14-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-297"><a href="#cb14-297" aria-hidden="true" tabindex="-1"></a>This is an intermediate object: a working tool that makes explicit choices and limitations.</span>
<span id="cb14-298"><a href="#cb14-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-299"><a href="#cb14-299" aria-hidden="true" tabindex="-1"></a><span class="fu">## Introduction: Extreme Event Attribution</span></span>
<span id="cb14-300"><a href="#cb14-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-301"><a href="#cb14-301" aria-hidden="true" tabindex="-1"></a>Extreme event attribution asks: *"How did climate change alter the probability or intensity of this specific event?"*</span>
<span id="cb14-302"><a href="#cb14-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-303"><a href="#cb14-303" aria-hidden="true" tabindex="-1"></a>Two common metrics:</span>
<span id="cb14-304"><a href="#cb14-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-305"><a href="#cb14-305" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Fraction of Attributable Risk (FAR)**: The fraction of risk that can be attributed to climate change</span>
<span id="cb14-306"><a href="#cb14-306" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>FAR = 1 - (P_historical / P_recent)</span>
<span id="cb14-307"><a href="#cb14-307" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Range: -∞ to 1 (1 = fully attributable, 0 = no change, negative = less likely)</span>
<span id="cb14-308"><a href="#cb14-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-309"><a href="#cb14-309" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Probability Ratio (PR)**: How many times more likely the event became</span>
<span id="cb14-310"><a href="#cb14-310" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>PR = P_recent / P_historical</span>
<span id="cb14-311"><a href="#cb14-311" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Range: 0 to ∞ (1 = no change, &gt;1 = more likely, &lt;1 = less likely)</span>
<span id="cb14-312"><a href="#cb14-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-313"><a href="#cb14-313" aria-hidden="true" tabindex="-1"></a>Both metrics compare probabilities of exceeding a threshold in a historical baseline period versus a recent period.</span>
<span id="cb14-314"><a href="#cb14-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-315"><a href="#cb14-315" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data Requirements</span></span>
<span id="cb14-316"><a href="#cb14-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-317"><a href="#cb14-317" aria-hidden="true" tabindex="-1"></a>This pipeline uses **ERA5 reanalysis** precipitation data. ERA5 provides:</span>
<span id="cb14-318"><a href="#cb14-318" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Global coverage from 1950 to present</span>
<span id="cb14-319"><a href="#cb14-319" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Hourly or daily temporal resolution</span>
<span id="cb14-320"><a href="#cb14-320" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>~31km spatial resolution</span>
<span id="cb14-321"><a href="#cb14-321" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Variable: <span class="in">`total_precipitation`</span> (accumulated over hour, in meters)</span>
<span id="cb14-322"><a href="#cb14-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-323"><a href="#cb14-323" aria-hidden="true" tabindex="-1"></a>**To use this pipeline, you need:**</span>
<span id="cb14-324"><a href="#cb14-324" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>ERA5 data downloaded (via CDS API or pre-downloaded files)</span>
<span id="cb14-325"><a href="#cb14-325" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Or modify the data loading functions to use your own data source</span>
<span id="cb14-326"><a href="#cb14-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-327"><a href="#cb14-327" aria-hidden="true" tabindex="-1"></a>**Data download:**</span>
<span id="cb14-328"><a href="#cb14-328" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">CDS API</span><span class="co">](https://cds.climate.copernicus.eu/)</span> (requires registration)</span>
<span id="cb14-329"><a href="#cb14-329" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Variable: <span class="in">`total_precipitation`</span></span>
<span id="cb14-330"><a href="#cb14-330" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Product: <span class="in">`reanalysis-era5-single-levels`</span></span>
<span id="cb14-331"><a href="#cb14-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-332"><a href="#cb14-332" aria-hidden="true" tabindex="-1"></a><span class="fu">## Example 1: 2021 Western Europe Floods</span></span>
<span id="cb14-333"><a href="#cb14-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-334"><a href="#cb14-334" aria-hidden="true" tabindex="-1"></a>The July 2021 floods in Germany, Belgium, and Netherlands were caused by extreme rainfall. Let's analyze the attribution of this event.</span>
<span id="cb14-335"><a href="#cb14-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-336"><a href="#cb14-336" aria-hidden="true" tabindex="-1"></a><span class="fu">### Define the event</span></span>
<span id="cb14-337"><a href="#cb14-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-340"><a href="#cb14-340" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb14-341"><a href="#cb14-341" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb14-342"><a href="#cb14-342" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb14-343"><a href="#cb14-343" aria-hidden="true" tabindex="-1"></a><span class="co"># Add project root to Python path  </span></span>
<span id="cb14-344"><a href="#cb14-344" aria-hidden="true" tabindex="-1"></a>project_root <span class="op">=</span> Path.cwd() <span class="cf">if</span> Path(<span class="st">'src'</span>).exists() <span class="cf">else</span> Path.cwd().parent</span>
<span id="cb14-345"><a href="#cb14-345" aria-hidden="true" tabindex="-1"></a>sys.path.insert(<span class="dv">0</span>, <span class="bu">str</span>(project_root))</span>
<span id="cb14-346"><a href="#cb14-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-347"><a href="#cb14-347" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> src.attribution.event_definitions <span class="im">import</span> define_rainfall_event</span>
<span id="cb14-348"><a href="#cb14-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-349"><a href="#cb14-349" aria-hidden="true" tabindex="-1"></a><span class="co"># Event definition: July 12-15, 2021, Western Europe</span></span>
<span id="cb14-350"><a href="#cb14-350" aria-hidden="true" tabindex="-1"></a><span class="co"># Cumulative rainfall &gt;150mm over 2-3 days</span></span>
<span id="cb14-351"><a href="#cb14-351" aria-hidden="true" tabindex="-1"></a>event_2021 <span class="op">=</span> define_rainfall_event(</span>
<span id="cb14-352"><a href="#cb14-352" aria-hidden="true" tabindex="-1"></a>    region<span class="op">=</span>{<span class="st">'lat'</span>: (<span class="fl">48.0</span>, <span class="fl">52.0</span>), <span class="st">'lon'</span>: (<span class="fl">4.0</span>, <span class="fl">9.0</span>)},  <span class="co"># Germany/Belgium region</span></span>
<span id="cb14-353"><a href="#cb14-353" aria-hidden="true" tabindex="-1"></a>    date_range<span class="op">=</span>(<span class="st">'2021-07-12'</span>, <span class="st">'2021-07-15'</span>),</span>
<span id="cb14-354"><a href="#cb14-354" aria-hidden="true" tabindex="-1"></a>    threshold<span class="op">=</span><span class="fl">150.0</span>,  <span class="co"># mm</span></span>
<span id="cb14-355"><a href="#cb14-355" aria-hidden="true" tabindex="-1"></a>    metric<span class="op">=</span><span class="st">'cumulative'</span>,</span>
<span id="cb14-356"><a href="#cb14-356" aria-hidden="true" tabindex="-1"></a>    duration<span class="op">=</span><span class="dv">3</span>,  <span class="co"># days</span></span>
<span id="cb14-357"><a href="#cb14-357" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-358"><a href="#cb14-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-359"><a href="#cb14-359" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Event: </span><span class="sc">{</span>event_2021<span class="sc">.</span>date_range[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> to </span><span class="sc">{</span>event_2021<span class="sc">.</span>date_range[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb14-360"><a href="#cb14-360" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Region: </span><span class="sc">{</span>event_2021<span class="sc">.</span>region<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb14-361"><a href="#cb14-361" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Threshold: </span><span class="sc">{</span>event_2021<span class="sc">.</span>threshold<span class="sc">}</span><span class="ss"> mm over </span><span class="sc">{</span>event_2021<span class="sc">.</span>duration<span class="sc">}</span><span class="ss"> days"</span>)</span>
<span id="cb14-362"><a href="#cb14-362" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-363"><a href="#cb14-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-364"><a href="#cb14-364" aria-hidden="true" tabindex="-1"></a><span class="fu">### Load ERA5 data</span></span>
<span id="cb14-365"><a href="#cb14-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-366"><a href="#cb14-366" aria-hidden="true" tabindex="-1"></a>**Note:** This example assumes you have ERA5 data available. In practice, you would:</span>
<span id="cb14-367"><a href="#cb14-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-368"><a href="#cb14-368" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Download ERA5 data via CDS API, or</span>
<span id="cb14-369"><a href="#cb14-369" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Use pre-downloaded NetCDF files, or</span>
<span id="cb14-370"><a href="#cb14-370" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Use a data service that provides ERA5 access</span>
<span id="cb14-371"><a href="#cb14-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-372"><a href="#cb14-372" aria-hidden="true" tabindex="-1"></a>For demonstration, we'll show the structure with synthetic data:</span>
<span id="cb14-373"><a href="#cb14-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-376"><a href="#cb14-376" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb14-377"><a href="#cb14-377" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb14-378"><a href="#cb14-378" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb14-379"><a href="#cb14-379" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime, timedelta</span>
<span id="cb14-380"><a href="#cb14-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-381"><a href="#cb14-381" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate synthetic ERA5-like data for demonstration</span></span>
<span id="cb14-382"><a href="#cb14-382" aria-hidden="true" tabindex="-1"></a><span class="co"># In practice, use: load_era5_precipitation() from src.attribution.data_loading</span></span>
<span id="cb14-383"><a href="#cb14-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-384"><a href="#cb14-384" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">42</span>)</span>
<span id="cb14-385"><a href="#cb14-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-386"><a href="#cb14-386" aria-hidden="true" tabindex="-1"></a><span class="co"># Create date ranges</span></span>
<span id="cb14-387"><a href="#cb14-387" aria-hidden="true" tabindex="-1"></a>baseline_dates <span class="op">=</span> pd.date_range(<span class="st">'1950-01-01'</span>, <span class="st">'1980-12-31'</span>, freq<span class="op">=</span><span class="st">'D'</span>)</span>
<span id="cb14-388"><a href="#cb14-388" aria-hidden="true" tabindex="-1"></a>recent_dates <span class="op">=</span> pd.date_range(<span class="st">'1990-01-01'</span>, <span class="st">'2023-12-31'</span>, freq<span class="op">=</span><span class="st">'D'</span>)</span>
<span id="cb14-389"><a href="#cb14-389" aria-hidden="true" tabindex="-1"></a>event_dates <span class="op">=</span> pd.date_range(<span class="st">'2021-07-12'</span>, <span class="st">'2021-07-15'</span>, freq<span class="op">=</span><span class="st">'D'</span>)</span>
<span id="cb14-390"><a href="#cb14-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-391"><a href="#cb14-391" aria-hidden="true" tabindex="-1"></a><span class="co"># Synthetic precipitation (gamma distribution, realistic for Europe)</span></span>
<span id="cb14-392"><a href="#cb14-392" aria-hidden="true" tabindex="-1"></a><span class="co"># Baseline: lower mean, recent: higher mean (climate change signal)</span></span>
<span id="cb14-393"><a href="#cb14-393" aria-hidden="true" tabindex="-1"></a>baseline_precip <span class="op">=</span> np.random.gamma(shape<span class="op">=</span><span class="dv">2</span>, scale<span class="op">=</span><span class="dv">5</span>, size<span class="op">=</span><span class="bu">len</span>(baseline_dates))</span>
<span id="cb14-394"><a href="#cb14-394" aria-hidden="true" tabindex="-1"></a>recent_precip <span class="op">=</span> np.random.gamma(shape<span class="op">=</span><span class="dv">2</span>, scale<span class="op">=</span><span class="dv">6</span>, size<span class="op">=</span><span class="bu">len</span>(recent_dates))</span>
<span id="cb14-395"><a href="#cb14-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-396"><a href="#cb14-396" aria-hidden="true" tabindex="-1"></a><span class="co"># Add extreme event in 2021</span></span>
<span id="cb14-397"><a href="#cb14-397" aria-hidden="true" tabindex="-1"></a>event_precip <span class="op">=</span> np.array([<span class="dv">45</span>, <span class="dv">85</span>, <span class="dv">70</span>, <span class="dv">30</span>])  <span class="co"># mm per day, totals 230mm over 3 days</span></span>
<span id="cb14-398"><a href="#cb14-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-399"><a href="#cb14-399" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine into DataFrames</span></span>
<span id="cb14-400"><a href="#cb14-400" aria-hidden="true" tabindex="-1"></a>baseline_data <span class="op">=</span> pd.DataFrame({</span>
<span id="cb14-401"><a href="#cb14-401" aria-hidden="true" tabindex="-1"></a>    <span class="st">'date'</span>: baseline_dates,</span>
<span id="cb14-402"><a href="#cb14-402" aria-hidden="true" tabindex="-1"></a>    <span class="st">'precipitation_mm'</span>: baseline_precip</span>
<span id="cb14-403"><a href="#cb14-403" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb14-404"><a href="#cb14-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-405"><a href="#cb14-405" aria-hidden="true" tabindex="-1"></a>recent_data <span class="op">=</span> pd.DataFrame({</span>
<span id="cb14-406"><a href="#cb14-406" aria-hidden="true" tabindex="-1"></a>    <span class="st">'date'</span>: recent_dates,</span>
<span id="cb14-407"><a href="#cb14-407" aria-hidden="true" tabindex="-1"></a>    <span class="st">'precipitation_mm'</span>: recent_precip</span>
<span id="cb14-408"><a href="#cb14-408" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb14-409"><a href="#cb14-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-410"><a href="#cb14-410" aria-hidden="true" tabindex="-1"></a><span class="co"># Insert event into recent data</span></span>
<span id="cb14-411"><a href="#cb14-411" aria-hidden="true" tabindex="-1"></a>event_mask <span class="op">=</span> recent_data[<span class="st">'date'</span>].isin(event_dates)</span>
<span id="cb14-412"><a href="#cb14-412" aria-hidden="true" tabindex="-1"></a>recent_data.loc[event_mask, <span class="st">'precipitation_mm'</span>] <span class="op">=</span> event_precip</span>
<span id="cb14-413"><a href="#cb14-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-414"><a href="#cb14-414" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Data loaded:"</span>)</span>
<span id="cb14-415"><a href="#cb14-415" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Baseline period: </span><span class="sc">{</span><span class="bu">len</span>(baseline_data)<span class="sc">}</span><span class="ss"> days"</span>)</span>
<span id="cb14-416"><a href="#cb14-416" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Recent period: </span><span class="sc">{</span><span class="bu">len</span>(recent_data)<span class="sc">}</span><span class="ss"> days"</span>)</span>
<span id="cb14-417"><a href="#cb14-417" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Baseline stats:"</span>)</span>
<span id="cb14-418"><a href="#cb14-418" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(baseline_data[<span class="st">'precipitation_mm'</span>].describe())</span>
<span id="cb14-419"><a href="#cb14-419" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Recent stats:"</span>)</span>
<span id="cb14-420"><a href="#cb14-420" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(recent_data[<span class="st">'precipitation_mm'</span>].describe())</span>
<span id="cb14-421"><a href="#cb14-421" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-422"><a href="#cb14-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-423"><a href="#cb14-423" aria-hidden="true" tabindex="-1"></a><span class="fu">### Detect the event</span></span>
<span id="cb14-424"><a href="#cb14-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-427"><a href="#cb14-427" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb14-428"><a href="#cb14-428" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb14-429"><a href="#cb14-429" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb14-430"><a href="#cb14-430" aria-hidden="true" tabindex="-1"></a><span class="co"># Add project root to Python path  </span></span>
<span id="cb14-431"><a href="#cb14-431" aria-hidden="true" tabindex="-1"></a>project_root <span class="op">=</span> Path.cwd() <span class="cf">if</span> Path(<span class="st">'src'</span>).exists() <span class="cf">else</span> Path.cwd().parent</span>
<span id="cb14-432"><a href="#cb14-432" aria-hidden="true" tabindex="-1"></a>sys.path.insert(<span class="dv">0</span>, <span class="bu">str</span>(project_root))</span>
<span id="cb14-433"><a href="#cb14-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-434"><a href="#cb14-434" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> src.attribution.event_definitions <span class="im">import</span> detect_rainfall_events, extract_event_data</span>
<span id="cb14-435"><a href="#cb14-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-436"><a href="#cb14-436" aria-hidden="true" tabindex="-1"></a><span class="co"># Detect all events matching criteria in recent period</span></span>
<span id="cb14-437"><a href="#cb14-437" aria-hidden="true" tabindex="-1"></a>recent_with_events <span class="op">=</span> detect_rainfall_events(</span>
<span id="cb14-438"><a href="#cb14-438" aria-hidden="true" tabindex="-1"></a>    recent_data,</span>
<span id="cb14-439"><a href="#cb14-439" aria-hidden="true" tabindex="-1"></a>    threshold<span class="op">=</span><span class="fl">150.0</span>,</span>
<span id="cb14-440"><a href="#cb14-440" aria-hidden="true" tabindex="-1"></a>    min_duration<span class="op">=</span><span class="dv">3</span>,</span>
<span id="cb14-441"><a href="#cb14-441" aria-hidden="true" tabindex="-1"></a>    metric<span class="op">=</span><span class="st">'cumulative'</span>,</span>
<span id="cb14-442"><a href="#cb14-442" aria-hidden="true" tabindex="-1"></a>    duration<span class="op">=</span><span class="dv">3</span>,</span>
<span id="cb14-443"><a href="#cb14-443" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-444"><a href="#cb14-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-445"><a href="#cb14-445" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the specific 2021 event</span></span>
<span id="cb14-446"><a href="#cb14-446" aria-hidden="true" tabindex="-1"></a>event_data <span class="op">=</span> extract_event_data(recent_data, event_2021)</span>
<span id="cb14-447"><a href="#cb14-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-448"><a href="#cb14-448" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"2021 Event details:"</span>)</span>
<span id="cb14-449"><a href="#cb14-449" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(event_data[[<span class="st">'date'</span>, <span class="st">'precipitation_mm'</span>]])</span>
<span id="cb14-450"><a href="#cb14-450" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Cumulative rainfall: </span><span class="sc">{</span>event_data[<span class="st">'precipitation_mm'</span>]<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.1f}</span><span class="ss"> mm"</span>)</span>
<span id="cb14-451"><a href="#cb14-451" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Event threshold: </span><span class="sc">{</span>event_2021<span class="sc">.</span>threshold<span class="sc">}</span><span class="ss"> mm"</span>)</span>
<span id="cb14-452"><a href="#cb14-452" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Event exceeded threshold: </span><span class="sc">{</span>event_data[<span class="st">'precipitation_mm'</span>]<span class="sc">.</span><span class="bu">sum</span>() <span class="op">&gt;=</span> event_2021<span class="sc">.</span>threshold<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb14-453"><a href="#cb14-453" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-454"><a href="#cb14-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-455"><a href="#cb14-455" aria-hidden="true" tabindex="-1"></a><span class="fu">### Calculate attribution</span></span>
<span id="cb14-456"><a href="#cb14-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-459"><a href="#cb14-459" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb14-460"><a href="#cb14-460" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb14-461"><a href="#cb14-461" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb14-462"><a href="#cb14-462" aria-hidden="true" tabindex="-1"></a><span class="co"># Add project root to Python path  </span></span>
<span id="cb14-463"><a href="#cb14-463" aria-hidden="true" tabindex="-1"></a>project_root <span class="op">=</span> Path.cwd() <span class="cf">if</span> Path(<span class="st">'src'</span>).exists() <span class="cf">else</span> Path.cwd().parent</span>
<span id="cb14-464"><a href="#cb14-464" aria-hidden="true" tabindex="-1"></a>sys.path.insert(<span class="dv">0</span>, <span class="bu">str</span>(project_root))</span>
<span id="cb14-465"><a href="#cb14-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-466"><a href="#cb14-466" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> src.attribution.attribution_methods <span class="im">import</span> bootstrap_attribution</span>
<span id="cb14-467"><a href="#cb14-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-468"><a href="#cb14-468" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate attribution with bootstrap confidence intervals</span></span>
<span id="cb14-469"><a href="#cb14-469" aria-hidden="true" tabindex="-1"></a>attribution_results <span class="op">=</span> bootstrap_attribution(</span>
<span id="cb14-470"><a href="#cb14-470" aria-hidden="true" tabindex="-1"></a>    historical_data<span class="op">=</span>baseline_data[<span class="st">'precipitation_mm'</span>],</span>
<span id="cb14-471"><a href="#cb14-471" aria-hidden="true" tabindex="-1"></a>    recent_data<span class="op">=</span>recent_data[<span class="st">'precipitation_mm'</span>],</span>
<span id="cb14-472"><a href="#cb14-472" aria-hidden="true" tabindex="-1"></a>    event_threshold<span class="op">=</span><span class="fl">150.0</span>,  <span class="co"># 150mm cumulative over 3 days</span></span>
<span id="cb14-473"><a href="#cb14-473" aria-hidden="true" tabindex="-1"></a>    n_bootstrap<span class="op">=</span><span class="dv">1000</span>,</span>
<span id="cb14-474"><a href="#cb14-474" aria-hidden="true" tabindex="-1"></a>    distribution_type<span class="op">=</span><span class="st">'gamma'</span>,</span>
<span id="cb14-475"><a href="#cb14-475" aria-hidden="true" tabindex="-1"></a>    random_seed<span class="op">=</span><span class="dv">42</span>,</span>
<span id="cb14-476"><a href="#cb14-476" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-477"><a href="#cb14-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-478"><a href="#cb14-478" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Attribution Results:"</span>)</span>
<span id="cb14-479"><a href="#cb14-479" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Fraction of Attributable Risk (FAR): </span><span class="sc">{</span>attribution_results[<span class="st">'far'</span>]<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb14-480"><a href="#cb14-480" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  95% CI: [</span><span class="sc">{</span>attribution_results[<span class="st">'far_ci_lower'</span>]<span class="sc">:.3f}</span><span class="ss">, </span><span class="sc">{</span>attribution_results[<span class="st">'far_ci_upper'</span>]<span class="sc">:.3f}</span><span class="ss">]"</span>)</span>
<span id="cb14-481"><a href="#cb14-481" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Probability Ratio (PR): </span><span class="sc">{</span>attribution_results[<span class="st">'pr'</span>]<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb14-482"><a href="#cb14-482" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  95% CI: [</span><span class="sc">{</span>attribution_results[<span class="st">'pr_ci_lower'</span>]<span class="sc">:.3f}</span><span class="ss">, </span><span class="sc">{</span>attribution_results[<span class="st">'pr_ci_upper'</span>]<span class="sc">:.3f}</span><span class="ss">]"</span>)</span>
<span id="cb14-483"><a href="#cb14-483" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Historical probability: </span><span class="sc">{</span>attribution_results[<span class="st">'p_historical'</span>]<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb14-484"><a href="#cb14-484" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Recent probability: </span><span class="sc">{</span>attribution_results[<span class="st">'p_recent'</span>]<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb14-485"><a href="#cb14-485" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-486"><a href="#cb14-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-487"><a href="#cb14-487" aria-hidden="true" tabindex="-1"></a><span class="fu">### Visualize results</span></span>
<span id="cb14-488"><a href="#cb14-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-491"><a href="#cb14-491" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb14-492"><a href="#cb14-492" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb14-493"><a href="#cb14-493" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb14-494"><a href="#cb14-494" aria-hidden="true" tabindex="-1"></a><span class="co"># Add project root to Python path  </span></span>
<span id="cb14-495"><a href="#cb14-495" aria-hidden="true" tabindex="-1"></a>project_root <span class="op">=</span> Path.cwd() <span class="cf">if</span> Path(<span class="st">'src'</span>).exists() <span class="cf">else</span> Path.cwd().parent</span>
<span id="cb14-496"><a href="#cb14-496" aria-hidden="true" tabindex="-1"></a>sys.path.insert(<span class="dv">0</span>, <span class="bu">str</span>(project_root))</span>
<span id="cb14-497"><a href="#cb14-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-498"><a href="#cb14-498" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb14-499"><a href="#cb14-499" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> src.attribution.visualization <span class="im">import</span> (</span>
<span id="cb14-500"><a href="#cb14-500" aria-hidden="true" tabindex="-1"></a>    plot_precipitation_timeseries,</span>
<span id="cb14-501"><a href="#cb14-501" aria-hidden="true" tabindex="-1"></a>    plot_distribution_comparison,</span>
<span id="cb14-502"><a href="#cb14-502" aria-hidden="true" tabindex="-1"></a>    plot_attribution_results,</span>
<span id="cb14-503"><a href="#cb14-503" aria-hidden="true" tabindex="-1"></a>    plot_cumulative_rainfall,</span>
<span id="cb14-504"><a href="#cb14-504" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-505"><a href="#cb14-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-506"><a href="#cb14-506" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine data for time series plot</span></span>
<span id="cb14-507"><a href="#cb14-507" aria-hidden="true" tabindex="-1"></a>all_data <span class="op">=</span> pd.concat([</span>
<span id="cb14-508"><a href="#cb14-508" aria-hidden="true" tabindex="-1"></a>    baseline_data.assign(period<span class="op">=</span><span class="st">'baseline'</span>),</span>
<span id="cb14-509"><a href="#cb14-509" aria-hidden="true" tabindex="-1"></a>    recent_data.assign(period<span class="op">=</span><span class="st">'recent'</span>)</span>
<span id="cb14-510"><a href="#cb14-510" aria-hidden="true" tabindex="-1"></a>], ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb14-511"><a href="#cb14-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-512"><a href="#cb14-512" aria-hidden="true" tabindex="-1"></a><span class="co"># Time series with event highlighted</span></span>
<span id="cb14-513"><a href="#cb14-513" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">12</span>))</span>
<span id="cb14-514"><a href="#cb14-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-515"><a href="#cb14-515" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Time series</span></span>
<span id="cb14-516"><a href="#cb14-516" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> axes[<span class="dv">0</span>, <span class="dv">0</span>]</span>
<span id="cb14-517"><a href="#cb14-517" aria-hidden="true" tabindex="-1"></a>plot_precipitation_timeseries(</span>
<span id="cb14-518"><a href="#cb14-518" aria-hidden="true" tabindex="-1"></a>    all_data,</span>
<span id="cb14-519"><a href="#cb14-519" aria-hidden="true" tabindex="-1"></a>    event_2021,</span>
<span id="cb14-520"><a href="#cb14-520" aria-hidden="true" tabindex="-1"></a>    baseline_period<span class="op">=</span>(<span class="st">'1950-01-01'</span>, <span class="st">'1980-12-31'</span>),</span>
<span id="cb14-521"><a href="#cb14-521" aria-hidden="true" tabindex="-1"></a>    recent_period<span class="op">=</span>(<span class="st">'1990-01-01'</span>, <span class="st">'2023-12-31'</span>),</span>
<span id="cb14-522"><a href="#cb14-522" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax1,</span>
<span id="cb14-523"><a href="#cb14-523" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-524"><a href="#cb14-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-525"><a href="#cb14-525" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Distribution comparison</span></span>
<span id="cb14-526"><a href="#cb14-526" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> axes[<span class="dv">0</span>, <span class="dv">1</span>]</span>
<span id="cb14-527"><a href="#cb14-527" aria-hidden="true" tabindex="-1"></a>plot_distribution_comparison(</span>
<span id="cb14-528"><a href="#cb14-528" aria-hidden="true" tabindex="-1"></a>    baseline_data[<span class="st">'precipitation_mm'</span>],</span>
<span id="cb14-529"><a href="#cb14-529" aria-hidden="true" tabindex="-1"></a>    recent_data[<span class="st">'precipitation_mm'</span>],</span>
<span id="cb14-530"><a href="#cb14-530" aria-hidden="true" tabindex="-1"></a>    event_threshold<span class="op">=</span><span class="fl">150.0</span>,</span>
<span id="cb14-531"><a href="#cb14-531" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax2,</span>
<span id="cb14-532"><a href="#cb14-532" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-533"><a href="#cb14-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-534"><a href="#cb14-534" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Attribution results</span></span>
<span id="cb14-535"><a href="#cb14-535" aria-hidden="true" tabindex="-1"></a>ax3 <span class="op">=</span> axes[<span class="dv">1</span>, <span class="dv">0</span>]</span>
<span id="cb14-536"><a href="#cb14-536" aria-hidden="true" tabindex="-1"></a>plot_attribution_results(</span>
<span id="cb14-537"><a href="#cb14-537" aria-hidden="true" tabindex="-1"></a>    attribution_results[<span class="st">'far'</span>],</span>
<span id="cb14-538"><a href="#cb14-538" aria-hidden="true" tabindex="-1"></a>    attribution_results[<span class="st">'pr'</span>],</span>
<span id="cb14-539"><a href="#cb14-539" aria-hidden="true" tabindex="-1"></a>    confidence_intervals<span class="op">=</span>{</span>
<span id="cb14-540"><a href="#cb14-540" aria-hidden="true" tabindex="-1"></a>        <span class="st">'far_ci_lower'</span>: attribution_results[<span class="st">'far_ci_lower'</span>],</span>
<span id="cb14-541"><a href="#cb14-541" aria-hidden="true" tabindex="-1"></a>        <span class="st">'far_ci_upper'</span>: attribution_results[<span class="st">'far_ci_upper'</span>],</span>
<span id="cb14-542"><a href="#cb14-542" aria-hidden="true" tabindex="-1"></a>        <span class="st">'pr_ci_lower'</span>: attribution_results[<span class="st">'pr_ci_lower'</span>],</span>
<span id="cb14-543"><a href="#cb14-543" aria-hidden="true" tabindex="-1"></a>        <span class="st">'pr_ci_upper'</span>: attribution_results[<span class="st">'pr_ci_upper'</span>],</span>
<span id="cb14-544"><a href="#cb14-544" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb14-545"><a href="#cb14-545" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax3,</span>
<span id="cb14-546"><a href="#cb14-546" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-547"><a href="#cb14-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-548"><a href="#cb14-548" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Cumulative rainfall for event</span></span>
<span id="cb14-549"><a href="#cb14-549" aria-hidden="true" tabindex="-1"></a>ax4 <span class="op">=</span> axes[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb14-550"><a href="#cb14-550" aria-hidden="true" tabindex="-1"></a>plot_cumulative_rainfall(event_data, event_2021, ax<span class="op">=</span>ax4)</span>
<span id="cb14-551"><a href="#cb14-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-552"><a href="#cb14-552" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb14-553"><a href="#cb14-553" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb14-554"><a href="#cb14-554" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-555"><a href="#cb14-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-556"><a href="#cb14-556" aria-hidden="true" tabindex="-1"></a><span class="fu">### Interpretation</span></span>
<span id="cb14-557"><a href="#cb14-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-560"><a href="#cb14-560" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb14-561"><a href="#cb14-561" aria-hidden="true" tabindex="-1"></a><span class="co"># Display interpretation</span></span>
<span id="cb14-562"><a href="#cb14-562" aria-hidden="true" tabindex="-1"></a>far_pct <span class="op">=</span> attribution_results[<span class="st">'far'</span>] <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb14-563"><a href="#cb14-563" aria-hidden="true" tabindex="-1"></a>pr_rounded <span class="op">=</span> <span class="bu">round</span>(attribution_results[<span class="st">'pr'</span>])</span>
<span id="cb14-564"><a href="#cb14-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-565"><a href="#cb14-565" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Based on the attribution analysis:"</span>)</span>
<span id="cb14-566"><a href="#cb14-566" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">FAR = </span><span class="sc">{</span>attribution_results[<span class="st">'far'</span>]<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb14-567"><a href="#cb14-567" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"This means approximately </span><span class="sc">{</span>far_pct<span class="sc">:.1f}</span><span class="ss">% of the risk of this event"</span>)</span>
<span id="cb14-568"><a href="#cb14-568" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"can be attributed to climate change."</span>)</span>
<span id="cb14-569"><a href="#cb14-569" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">PR = </span><span class="sc">{</span>attribution_results[<span class="st">'pr'</span>]<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb14-570"><a href="#cb14-570" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"The event is approximately </span><span class="sc">{</span>pr_rounded<span class="sc">}</span><span class="ss">x more likely in the recent period"</span>)</span>
<span id="cb14-571"><a href="#cb14-571" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"compared to the historical baseline."</span>)</span>
<span id="cb14-572"><a href="#cb14-572" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-573"><a href="#cb14-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-574"><a href="#cb14-574" aria-hidden="true" tabindex="-1"></a>**Note:** These are synthetic results for demonstration. Real attribution requires:</span>
<span id="cb14-575"><a href="#cb14-575" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Actual ERA5 data</span>
<span id="cb14-576"><a href="#cb14-576" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Careful selection of baseline and recent periods</span>
<span id="cb14-577"><a href="#cb14-577" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Consideration of seasonal patterns</span>
<span id="cb14-578"><a href="#cb14-578" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Validation against observational data</span>
<span id="cb14-579"><a href="#cb14-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-580"><a href="#cb14-580" aria-hidden="true" tabindex="-1"></a><span class="fu">## Example 2: User-Defined Event</span></span>
<span id="cb14-581"><a href="#cb14-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-582"><a href="#cb14-582" aria-hidden="true" tabindex="-1"></a>The pipeline is generalizable. Here's how to analyze any rainfall event:</span>
<span id="cb14-583"><a href="#cb14-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-586"><a href="#cb14-586" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb14-587"><a href="#cb14-587" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb14-588"><a href="#cb14-588" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb14-589"><a href="#cb14-589" aria-hidden="true" tabindex="-1"></a><span class="co"># Add project root to Python path  </span></span>
<span id="cb14-590"><a href="#cb14-590" aria-hidden="true" tabindex="-1"></a>project_root <span class="op">=</span> Path.cwd() <span class="cf">if</span> Path(<span class="st">'src'</span>).exists() <span class="cf">else</span> Path.cwd().parent</span>
<span id="cb14-591"><a href="#cb14-591" aria-hidden="true" tabindex="-1"></a>sys.path.insert(<span class="dv">0</span>, <span class="bu">str</span>(project_root))</span>
<span id="cb14-592"><a href="#cb14-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-593"><a href="#cb14-593" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> src.attribution.event_definitions <span class="im">import</span> define_rainfall_event</span>
<span id="cb14-594"><a href="#cb14-594" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> src.attribution.data_loading <span class="im">import</span> get_historical_baseline, get_recent_period</span>
<span id="cb14-595"><a href="#cb14-595" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> src.attribution.attribution_methods <span class="im">import</span> bootstrap_attribution</span>
<span id="cb14-596"><a href="#cb14-596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-597"><a href="#cb14-597" aria-hidden="true" tabindex="-1"></a><span class="co"># Define your event</span></span>
<span id="cb14-598"><a href="#cb14-598" aria-hidden="true" tabindex="-1"></a>my_event <span class="op">=</span> define_rainfall_event(</span>
<span id="cb14-599"><a href="#cb14-599" aria-hidden="true" tabindex="-1"></a>    region<span class="op">=</span>{<span class="st">'lat'</span>: (<span class="fl">40.0</span>, <span class="fl">50.0</span>), <span class="st">'lon'</span>: (<span class="op">-</span><span class="fl">10.0</span>, <span class="fl">5.0</span>)},  <span class="co"># Your region</span></span>
<span id="cb14-600"><a href="#cb14-600" aria-hidden="true" tabindex="-1"></a>    date_range<span class="op">=</span>(<span class="st">'2023-06-01'</span>, <span class="st">'2023-06-05'</span>),  <span class="co"># Your dates</span></span>
<span id="cb14-601"><a href="#cb14-601" aria-hidden="true" tabindex="-1"></a>    threshold<span class="op">=</span><span class="fl">100.0</span>,  <span class="co"># Your threshold (mm)</span></span>
<span id="cb14-602"><a href="#cb14-602" aria-hidden="true" tabindex="-1"></a>    metric<span class="op">=</span><span class="st">'cumulative'</span>,  <span class="co"># or 'intensity', 'duration'</span></span>
<span id="cb14-603"><a href="#cb14-603" aria-hidden="true" tabindex="-1"></a>    duration<span class="op">=</span><span class="dv">5</span>,  <span class="co"># days</span></span>
<span id="cb14-604"><a href="#cb14-604" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-605"><a href="#cb14-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-606"><a href="#cb14-606" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data (replace with actual data loading)</span></span>
<span id="cb14-607"><a href="#cb14-607" aria-hidden="true" tabindex="-1"></a><span class="co"># baseline = get_historical_baseline(my_event.region, '1950-01-01', '1980-12-31')</span></span>
<span id="cb14-608"><a href="#cb14-608" aria-hidden="true" tabindex="-1"></a><span class="co"># recent = get_recent_period(my_event.region, '1990-01-01', '2023-12-31')</span></span>
<span id="cb14-609"><a href="#cb14-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-610"><a href="#cb14-610" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate attribution</span></span>
<span id="cb14-611"><a href="#cb14-611" aria-hidden="true" tabindex="-1"></a><span class="co"># results = bootstrap_attribution(</span></span>
<span id="cb14-612"><a href="#cb14-612" aria-hidden="true" tabindex="-1"></a><span class="co">#     baseline['precipitation_mm'],</span></span>
<span id="cb14-613"><a href="#cb14-613" aria-hidden="true" tabindex="-1"></a><span class="co">#     recent['precipitation_mm'],</span></span>
<span id="cb14-614"><a href="#cb14-614" aria-hidden="true" tabindex="-1"></a><span class="co">#     my_event.threshold,</span></span>
<span id="cb14-615"><a href="#cb14-615" aria-hidden="true" tabindex="-1"></a><span class="co">#     n_bootstrap=1000,</span></span>
<span id="cb14-616"><a href="#cb14-616" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb14-617"><a href="#cb14-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-618"><a href="#cb14-618" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Event defined. Next steps:"</span>)</span>
<span id="cb14-619"><a href="#cb14-619" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"1. Load ERA5 data for your region"</span>)</span>
<span id="cb14-620"><a href="#cb14-620" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"2. Run attribution analysis"</span>)</span>
<span id="cb14-621"><a href="#cb14-621" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"3. Visualize results"</span>)</span>
<span id="cb14-622"><a href="#cb14-622" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-623"><a href="#cb14-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-624"><a href="#cb14-624" aria-hidden="true" tabindex="-1"></a><span class="fu">## Methodology Details</span></span>
<span id="cb14-625"><a href="#cb14-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-626"><a href="#cb14-626" aria-hidden="true" tabindex="-1"></a><span class="fu">### Statistical Approach</span></span>
<span id="cb14-627"><a href="#cb14-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-628"><a href="#cb14-628" aria-hidden="true" tabindex="-1"></a>**Distribution Fitting:**</span>
<span id="cb14-629"><a href="#cb14-629" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Precipitation data is typically right-skewed with many zero values</span>
<span id="cb14-630"><a href="#cb14-630" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We fit gamma distributions (common for precipitation)</span>
<span id="cb14-631"><a href="#cb14-631" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Alternative: log-normal or GEV (for extremes)</span>
<span id="cb14-632"><a href="#cb14-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-633"><a href="#cb14-633" aria-hidden="true" tabindex="-1"></a>**Bootstrap Confidence Intervals:**</span>
<span id="cb14-634"><a href="#cb14-634" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Resample data with replacement (1000 iterations)</span>
<span id="cb14-635"><a href="#cb14-635" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Calculate FAR and PR for each bootstrap sample</span>
<span id="cb14-636"><a href="#cb14-636" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>95% CI from percentiles (2.5th, 97.5th)</span>
<span id="cb14-637"><a href="#cb14-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-638"><a href="#cb14-638" aria-hidden="true" tabindex="-1"></a>**Seasonality:**</span>
<span id="cb14-639"><a href="#cb14-639" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Precipitation has strong seasonal patterns</span>
<span id="cb14-640"><a href="#cb14-640" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>For robust attribution, compare same seasons across periods</span>
<span id="cb14-641"><a href="#cb14-641" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This pipeline can be extended to handle seasonality</span>
<span id="cb14-642"><a href="#cb14-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-643"><a href="#cb14-643" aria-hidden="true" tabindex="-1"></a><span class="fu">### Limitations</span></span>
<span id="cb14-644"><a href="#cb14-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-645"><a href="#cb14-645" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Precipitation vs Floods**: This analyzes rainfall extremes, not actual flood impacts. Floods depend on:</span>
<span id="cb14-646"><a href="#cb14-646" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Runoff and drainage</span>
<span id="cb14-647"><a href="#cb14-647" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Soil moisture and saturation</span>
<span id="cb14-648"><a href="#cb14-648" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Infrastructure and land use</span>
<span id="cb14-649"><a href="#cb14-649" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>River discharge and capacity</span>
<span id="cb14-650"><a href="#cb14-650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-651"><a href="#cb14-651" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Reanalysis Data**: ERA5 is a model-based reanalysis, not pure observations. It may have biases, especially for:</span>
<span id="cb14-652"><a href="#cb14-652" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Extreme events</span>
<span id="cb14-653"><a href="#cb14-653" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Mountainous regions</span>
<span id="cb14-654"><a href="#cb14-654" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Coastal areas</span>
<span id="cb14-655"><a href="#cb14-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-656"><a href="#cb14-656" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Non-Stationarity**: Assumes distributions are stationary within each period. Climate change may introduce trends even within "recent" period.</span>
<span id="cb14-657"><a href="#cb14-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-658"><a href="#cb14-658" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**Regional Specificity**: Results are for the defined region. Local factors (urbanization, land use changes) are not accounted for.</span>
<span id="cb14-659"><a href="#cb14-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-660"><a href="#cb14-660" aria-hidden="true" tabindex="-1"></a><span class="fu">## Extensions and Future Work</span></span>
<span id="cb14-661"><a href="#cb14-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-662"><a href="#cb14-662" aria-hidden="true" tabindex="-1"></a>**Possible extensions:**</span>
<span id="cb14-663"><a href="#cb14-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-664"><a href="#cb14-664" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Add observational data**: Compare ERA5 with station observations</span>
<span id="cb14-665"><a href="#cb14-665" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**CMIP6 integration**: Use climate model ensembles for counterfactual analysis</span>
<span id="cb14-666"><a href="#cb14-666" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Compound events**: Include antecedent soil moisture, temperature</span>
<span id="cb14-667"><a href="#cb14-667" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**Spatial analysis**: Map attribution results across regions</span>
<span id="cb14-668"><a href="#cb14-668" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>**Seasonal attribution**: Separate analysis by season</span>
<span id="cb14-669"><a href="#cb14-669" aria-hidden="true" tabindex="-1"></a><span class="ss">6. </span>**Flood impact modeling**: Connect precipitation to actual flood risk</span>
<span id="cb14-670"><a href="#cb14-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-671"><a href="#cb14-671" aria-hidden="true" tabindex="-1"></a>**References:**</span>
<span id="cb14-672"><a href="#cb14-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-673"><a href="#cb14-673" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Stott et al. (2016). "Attribution of extreme weather and climate-related events." *WIREs Climate Change*</span>
<span id="cb14-674"><a href="#cb14-674" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>National Academies (2016). *Attribution of Extreme Weather Events in the Context of Climate Change*</span>
<span id="cb14-675"><a href="#cb14-675" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>World Weather Attribution: <span class="co">[</span><span class="ot">worldweatherattribution.org</span><span class="co">](https://www.worldweatherattribution.org/)</span></span>
<span id="cb14-676"><a href="#cb14-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-677"><a href="#cb14-677" aria-hidden="true" tabindex="-1"></a><span class="fu">## Integration with Other Content</span></span>
<span id="cb14-678"><a href="#cb14-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-679"><a href="#cb14-679" aria-hidden="true" tabindex="-1"></a>This pipeline connects to:</span>
<span id="cb14-680"><a href="#cb14-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-681"><a href="#cb14-681" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Risk Series Part 2</span><span class="co">](/notes/risk-series-2.html)</span> - Data sources for climate risk</span>
<span id="cb14-682"><a href="#cb14-682" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Monte Carlo Basics</span><span class="co">](/notes/climate/monte-carlo-basics.html)</span> - Bootstrap methods used here</span>
<span id="cb14-683"><a href="#cb14-683" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Heatwave Analysis</span><span class="co">](/work/heatwave-prices-de-lu.html)</span> - Similar event definition patterns</span>
<span id="cb14-684"><a href="#cb14-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-685"><a href="#cb14-685" aria-hidden="true" tabindex="-1"></a>::: {.backlinks}</span>
<span id="cb14-686"><a href="#cb14-686" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Related</span></span>
<span id="cb14-687"><a href="#cb14-687" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Risk Modelling Series</span><span class="co">](/notes/risk-series-1.html)</span> - Foundations of risk modeling</span>
<span id="cb14-688"><a href="#cb14-688" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Monte Carlo Basics</span><span class="co">](/notes/climate/monte-carlo-basics.html)</span> - Statistical methods</span>
<span id="cb14-689"><a href="#cb14-689" aria-hidden="true" tabindex="-1"></a>:::</span>
</code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>© Timm Walker</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/recurrentanalytics/quarto_website/blob/main/work/flood-attribution-pipeline.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li></ul></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




<script src="../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>