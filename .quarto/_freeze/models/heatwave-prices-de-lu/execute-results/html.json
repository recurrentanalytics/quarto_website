{
  "hash": "2f202dcd317a91bf63d90cfbc5291ae7",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"Heatwaves and Day-Ahead Prices: DE-LU, Summer 2019\"\ndate: 2025-12-12\ncategories: [energy, extremes, time-series]\n---\n\n## Why this note exists\n\nThis is a deliberately small empirical note. It documents one operational definition of a heatwave and traces how that definition propagates through a data pipeline, culminating in descriptive comparisons of day-ahead electricity prices during heatwave versus non-heatwave periods.\n\nThis is not a causal analysis. No identification strategy is claimed, and the pipeline is meant to be inspectable rather than \"correct\" in any final sense.\n\n## Data\n\nPublic datasets from Open Power System Data (OPSD):\n\n- DE-LU day-ahead prices from `time_series_60min_singleindex.csv`\n- German temperature from `weather_data.csv`\n\nThe code below expects those CSVs in `data/raw/`. Download from:\n\n- [Time series](https://data.open-power-system-data.org/time_series/)\n- [Weather data](https://data.open-power-system-data.org/weather_data/)\n\n## Build processed inputs (hourly parquet)\n\n::: {#28e131bc .cell execution_count=1}\n``` {.python .cell-code}\nimport sys\nimport os\nsys.path.insert(0, os.path.abspath('.'))\n\nimport pandas as pd\n\nfrom src.data_download import save_prices_from_opsd, save_weather_de_from_opsd\n\nSTART = \"2015-01-01\"\nEND_PRICES  = \"2020-07-01\"\nEND_WEATHER = \"2020-01-01\"\n\n# Try to load data, but handle missing files gracefully\ntry:\n    save_prices_from_opsd(start=START, end=END_PRICES)\n    save_weather_de_from_opsd(start=START, end=END_WEATHER)\n    \n    prices  = pd.read_parquet(\"data/processed/prices_de_lu_clean.parquet\")\n    weather = pd.read_parquet(\"data/processed/weather_de_agg.parquet\")\n    \n    print(\"Data loaded successfully:\")\n    print(prices.head())\n    print(weather.head())\nexcept FileNotFoundError as e:\n    print(f\"Data files not found: {e}\")\n    print(\"\\nTo run this analysis, download the required data files:\")\n    print(\"- Time series: https://data.open-power-system-data.org/time_series/\")\n    print(\"- Weather data: https://data.open-power-system-data.org/weather_data/\")\n    print(\"\\nPlace the CSV files in data/raw/ and re-run this notebook.\")\n    # Create empty dataframes so subsequent code doesn't fail\n    prices = pd.DataFrame()\n    weather = pd.DataFrame()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nData files not found: File not found at data/raw/time_series_60min_singleindex.csv. Download from: https://data.open-power-system-data.org/time_series/latest/\n\nTo run this analysis, download the required data files:\n- Time series: https://data.open-power-system-data.org/time_series/\n- Weather data: https://data.open-power-system-data.org/weather_data/\n\nPlace the CSV files in data/raw/ and re-run this notebook.\n```\n:::\n:::\n\n\n## Heatwave definition\n\nOperational definition used here (chosen for clarity, not optimality):\n\n* daily maximum temperature ≥ 30°C\n* at least 3 consecutive days\n\nThis is one modelling choice among many. The point is to make it explicit and inspect its implications.\n\n## Flag heatwaves and merge with prices\n\n::: {#700331b2 .cell execution_count=2}\n``` {.python .cell-code}\nimport matplotlib.pyplot as plt\n\nfrom src.heatwave_defs import (\n    restrict_common_period,\n    compute_daily_max_temp,\n    flag_heatwaves,\n    expand_heatwave_flag_to_hourly,\n    merge_price_and_weather,\n)\n\n# Check if data is available\nif prices.empty or weather.empty:\n    print(\"Skipping analysis: data files not available.\")\n    print(\"Please download the required data files to run this analysis.\")\n    prices_c = pd.DataFrame()\n    weather_c = pd.DataFrame()\n    daily_flags = pd.DataFrame()\n    merged = pd.DataFrame()\nelse:\n    prices_c, weather_c = restrict_common_period(prices, weather)\n    \n    daily_temp  = compute_daily_max_temp(weather_c)\n    daily_flags = flag_heatwaves(daily_temp, threshold=30.0, min_duration=3)\n    \n    # Attach daily flag back to hourly weather and merge with hourly prices\n    weather_hw = expand_heatwave_flag_to_hourly(weather_c, daily_flags)\n    merged = merge_price_and_weather(prices_c, weather_hw)\n    \n    print(\"Heatwave analysis completed:\")\n    print(merged.head())\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSkipping analysis: data files not available.\nPlease download the required data files to run this analysis.\n```\n:::\n:::\n\n\n## Temperature with heatwave days highlighted (Summer 2019)\n\n::: {#dfa0dae9 .cell execution_count=3}\n``` {.python .cell-code}\nif daily_flags.empty:\n    print(\"No data available for visualization.\")\nelse:\n    hw_2019 = daily_flags[\"2019-06-01\":\"2019-08-31\"]\n    \n    fig, ax = plt.subplots(figsize=(12, 4))\n    ax.plot(hw_2019.index, hw_2019[\"t2m_daily_max_c\"], label=\"Daily max temp\")\n    ax.scatter(\n        hw_2019.index[hw_2019[\"is_heatwave_day\"]],\n        hw_2019[\"t2m_daily_max_c\"][hw_2019[\"is_heatwave_day\"]],\n        s=35,\n        label=\"Heatwave days\",\n    )\n    ax.set_ylabel(\"°C\")\n    ax.set_title(\"Daily max temperature with heatwave days highlighted (Summer 2019)\")\n    ax.legend()\n    plt.show()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nNo data available for visualization.\n```\n:::\n:::\n\n\n## Summer 2019: prices and temperature (heatwave days shaded)\n\n::: {#aed0b156 .cell execution_count=4}\n``` {.python .cell-code}\nif merged.empty:\n    print(\"No data available for visualization.\")\nelse:\n    summer = merged.set_index(\"datetime_utc\")[\"2019-06-01\":\"2019-08-31\"]\n    \n    fig, ax1 = plt.subplots(figsize=(12, 5))\n    ax2 = ax1.twinx()\n    \n    ax1.plot(summer.index, summer[\"price_eur_mwh\"], label=\"Price (EUR/MWh)\")\n    ax2.plot(summer.index, summer[\"t2m_mean_c\"], alpha=0.7, linestyle=\"--\", label=\"Temperature (°C)\")\n    \n    # Shade heatwave days\n    for day in summer.index.normalize().unique():\n        day_mask = (summer.index.normalize() == day)\n        if summer.loc[day_mask, \"is_heatwave_day\"].any():\n            ax1.axvspan(day, day + pd.Timedelta(days=1), alpha=0.12)\n    \n    ax1.set_ylabel(\"Price [EUR/MWh]\")\n    ax2.set_ylabel(\"Temperature [°C]\")\n    ax1.set_title(\"Summer 2019: DE-LU day-ahead prices and DE temperature (heatwave days shaded)\")\n    fig.tight_layout()\n    plt.show()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nNo data available for visualization.\n```\n:::\n:::\n\n\n## Peak hours: price distributions on heatwave vs non-heatwave days\n\n::: {#9b440df8 .cell execution_count=5}\n``` {.python .cell-code}\nif merged.empty:\n    print(\"No data available for analysis.\")\n    summary = pd.DataFrame()\nelse:\n    peak = merged[(merged[\"hour\"] >= 8) & (merged[\"hour\"] <= 20)].copy()\n    \n    hw = peak[peak[\"is_heatwave_day\"]]\n    normal = peak[~peak[\"is_heatwave_day\"]]\n    \n    summary = pd.DataFrame({\n        \"normal_peak_hours\": normal[\"price_eur_mwh\"].describe(),\n        \"heatwave_peak_hours\": hw[\"price_eur_mwh\"].describe(),\n    })\n    print(summary)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nNo data available for analysis.\n```\n:::\n:::\n\n\n::: {#4ce3a899 .cell execution_count=6}\n``` {.python .cell-code}\nif merged.empty:\n    print(\"No data available for visualization.\")\nelse:\n    peak = merged[(merged[\"hour\"] >= 8) & (merged[\"hour\"] <= 20)].copy()\n    hw = peak[peak[\"is_heatwave_day\"]]\n    normal = peak[~peak[\"is_heatwave_day\"]]\n    \n    fig, ax = plt.subplots(figsize=(8, 5))\n    \n    ax.hist(normal[\"price_eur_mwh\"], bins=60, alpha=0.6, density=True, label=\"Normal days (peak hours)\")\n    ax.hist(hw[\"price_eur_mwh\"],     bins=60, alpha=0.6, density=True, label=\"Heatwave days (peak hours)\")\n    \n    ax.set_xlabel(\"Day-ahead price (EUR/MWh)\")\n    ax.set_ylabel(\"Density\")\n    ax.set_title(\"DE-LU prices: heatwave vs normal days (2015–2019, peak hours)\")\n    ax.legend()\n    plt.show()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nNo data available for visualization.\n```\n:::\n:::\n\n\n## Limitations and extensions\n\nThis note is intentionally descriptive. It does not claim causality and does not control for drivers such as load, renewables, outages, fuels, or cross-border flows.\n\nNatural extensions include:\n\n* alternative heatwave definitions (percentiles, regionalised thresholds)\n* adding load and renewable generation as covariates\n* multi-year comparisons focusing on the stability of patterns across summers\n\n::: {.backlinks}\n#### Related\n- [Risk Modelling Part 2: Data](/notes/risk-series-2.html) - Data sources for climate risk\n- [ERA5 Demo](/models/era5-demo.html) - Working with reanalysis data\n:::\n\n",
    "supporting": [
      "heatwave-prices-de-lu_files"
    ],
    "filters": [],
    "includes": {}
  }
}